(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4860,4305],{7179:function(r,m,h){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deviceBoards",function(){return h(67977)}])},67977:function(r,m,h){"use strict";h.r(m),h.d(m,{default:function(){return w}});var u=h(52322),f=h(32172),g=h(97729),y=h.n(g);function w(r){let m=f.Z["deviceBoards/**"].component;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(y(),{children:(0,u.jsx)("title",{children:"Protofy - Device Boards"})}),(0,u.jsx)(m,{...r})]})}},54283:function(r,m,h){"use strict";h.d(m,{$:function(){return I},J:function(){return S}});var u=h(94801),f=h(55858),g=h(53596);let y=(0,g.j)();function w(r){let m;let h=/(\w+):("[^"]+"|\S+)/g,u={},f=r;for(;null!==(m=h.exec(r));){let r=m[1].toLowerCase(),h=m[2].replace(/"/g,"").toLowerCase();u[r]=h,f=f.replace(m[0],"")}return{parsed:u,searchWithoutTags:f=f.trim()}}class S{get(r,m){var h;return null!==(h=this.data[r])&&void 0!==h?h:m}getObjectSchema(){return this.objectSchema}getModelName(){return this.modelName}getLocation(){let r=this.objectSchema.is("location").getFields();if(!r.length)throw"Model error: "+this.getModelName()+" doesn't have location information";let m=r[0],h=this.objectSchema.getFieldKeyDefinition(m,"latKey"),u=this.objectSchema.getFieldKeyDefinition(m,"lonKey");if(this.data[m])return{lat:this.data[m][h],lon:this.data[m][u]}}getId(){return this.data[this.idField]}getNotificationsTopic(r){return"notifications/".concat(this.getModelName(),"/").concat(r,"/").concat(this.getId())}getNotificationsPayload(){return this.serialize()}setId(r,m){return new this.constructor({...m||this.data,[this.idField]:r},this.session,this.modelName)}isVisible(){return!this.isDeleted()}isDeleted(){return!!this.data._deleted}list(r,m,h){if(!r)return this.read();{let{parsed:m,searchWithoutTags:h}=w(r);for(let[r,h]of Object.entries(m))if(!this.data.hasOwnProperty(r)||this.data[r]!=h){y.debug({data:this.data[r]},"discarded: ".concat(JSON.stringify(this.data[r])));return}let f=this.objectSchema.is("search").getFields();for(var u=0;u<f.length;u++)if((this.data[f[u]]+"").toLowerCase().includes(h.toLowerCase()))return this.read()}}async listTransformed(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,f=this.list(r,h,u);if(f)return await this.getObjectSchema().apply("list",f,m)}create(r){let m=this.getData(r);return y.debug({transformed:m},"Creating object: ".concat(JSON.stringify(m))),new this.constructor(m,this.session,this.modelName).validate()}async createTransformed(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=await this.getObjectSchema().apply("create",{...this.data},r);return this.create(m)}read(r){return{...this.data}}async readTransformed(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=arguments.length>1?arguments[1]:void 0,h=await this.getObjectSchema().apply("read",this.read(m),r);return h}update(r,m){return r.setId(this.getId(),{...m||r.data})}async updateTransformed(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=await this.getObjectSchema().apply("update",{...r.data},m,{...this.data});return this.update(r,h)}delete(r){return new this.constructor({_deleted:!0,...r||this.data},this.session,this.modelName)}async deleteTransformed(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},m=await this.getObjectSchema().apply("delete",{...this.data},r);return this.delete(m)}validate(){return this.schema.parse(this.data),this}serialize(){return JSON.stringify(this.data)}static getApiOptions(){throw Error("Derived class must implement getApiOptions")}static _newInstance(r,m){throw Error("Derived class must implement _newInstance.")}static unserialize(r,m){return this._newInstance(JSON.parse(r),m)}static load(r,m){return this._newInstance(r,m)}static sort(r,m,h){return r.sort((r,u)=>r[m]>u[m]?"asc"===h?1:-1:r[m]<u[m]?"asc"===h?-1:1:0)}getData(r){return{...this.getObjectSchema().applyGenerators(null!=r?r:this.data)}}constructor(r,m,h,g){var y,w;this.data=r,this.session=null!=h?h:(0,u.ed)(),this.schema=m,this.objectSchema=f.U.load(this.schema),this.modelName=null!==(y=null==g?void 0:g.toLowerCase())&&void 0!==y?y:"unknown";let S=this.objectSchema.is("id");S.getFields().length>1&&(S=S.isNot("fallbackId")),this.idField=null!==(w=S.getFirst("id"))&&void 0!==w?w:"id"}}class I extends S{static _newInstance(r,m){throw Error("Derived class must implement _newInstance.")}static createDerived(r,m,h,u){class f extends I{static _newInstance(r,m){return new f(r,m)}static getApiOptions(){return{name:h,prefix:u}}constructor(h,u){super(h,m,u,r.substring(0,r.length-5).toLowerCase())}}return f.schemaInstance=m,Object.defineProperty(f,"name",{value:r,writable:!1}),f}constructor(r,m,h,u){super(r,m,h,u)}}},55858:function(r,m,h){"use strict";h.d(m,{U:function(){return f}});var u=h(34406);class f{getFields(){return Object.keys(this.shape)}getFieldKeyDefinition(r,m){return this.shape[r]?this.shape[r]._def[m]:void 0}applyGenerators(r){let m={...r};return Object.keys(this.shape).forEach(h=>{if(this.shape[h]._def.generate){let u=this.shape[h]._def.generate;(!r[h]||u.force)&&(m[h]="function"==typeof u.generator?u.generator(r):u.generator)}}),m}async apply(r,m,h,f){let g={...m},y=this.is("events"),w=Object.keys(y.shape);for(var S=0;S<w.length;S++){let m=w[S],E=y.shape[m],P=void 0!==u&&u.versions&&u.versions.node,A=E._def.events.filter(m=>m.eventName==r&&(!m.eventContext||"client"==m.eventContext&&!P||"server"==m.eventContext&&P));for(var I=0;I<A.length;I++){let r=A[I];h[r.eventHandler]&&(g=await h[r.eventHandler](m,r,g,f))}}return g}getLayout(r){let m=[[]],h=0;return Object.keys(this.shape).forEach(u=>{let f=this.shape[u];m[h].length==r&&(m.push([]),h++),m[h].push({...f,name:u})}),m}getFirst(r){return Object.keys(this.shape).find(m=>{if(this.shape[m]._def[r])return m})}isDisplay(r){let m={};return Object.keys(this.shape).forEach(h=>{(!this.shape[h]._def.display||this.shape[h]._def.display.includes("*")||this.shape[h]._def.display.includes(r))&&(m[h]=this.shape[h])}),new f(m)}is(r){let m={};return Object.keys(this.shape).forEach(h=>{this.shape[h]._def[r]&&(m[h]=this.shape[h])}),new f(m)}isNot(r){let m={};return Object.keys(this.shape).forEach(h=>{this.shape[h]._def[r]||(m[h]=this.shape[h])}),new f(m)}isAfter(r){let m={};return Object.keys(this.shape).forEach(h=>{var u;(null===(u=this.shape[h]._def)||void 0===u?void 0:u.after)&&this.shape[h]._def.after==r&&(m[h]=this.shape[h])}),new f(m)}isBefore(r){let m={};return Object.keys(this.shape).forEach(h=>{var u;(null===(u=this.shape[h]._def)||void 0===u?void 0:u.before)&&this.shape[h]._def.before==r&&(m[h]=this.shape[h])}),new f(m)}merge(r){let m={};return Object.keys(this.shape).forEach(h=>{let u=r.isBefore(h);(m={...m,...u.shape})[h]=this.shape[h];let f=r.isAfter(h);m={...m,...f.shape}}),new f(m)}static load(r){return new f(r.shape)}constructor(r){this.shape=r}}},32172:function(r,m,h){"use strict";h.d(m,{Z:function(){return eA}});var u=h(52322),f=h(97729),g=h.n(f),y=h(6429),w=h(17793),S=h(1888),I=h(5632),E=h(25237),P=h.n(E),A=h(64509);let T=P()(()=>h.e(9481).then(h.bind(h,29481)),{loadableGenerated:{webpack:()=>[29481]},ssr:!1});function C(r){let{workspace:m,deviceDefinition:h,data:f,pageSession:S}=r,E=(0,I.useRouter)();(0,y.kP)(S);let{name:P}=E.query;return(0,u.jsxs)(A.US,{children:[(0,u.jsx)(g(),{children:(0,u.jsx)("title",{children:"Protofy - Admin Panel"})}),(0,u.jsx)(w.bR,{workspace:m,children:(0,u.jsx)(T,{deviceDefinition:h})})]})}let D=[{name:"Empty device",board:{name:"Protofy ESP32 devBoard",core:{id:"1",name:"esp32",sdks:["esphome"],config:{}},ports:[{number:1,side:"left",name:"3V3",type:"P",analog:!1,description:"3V3 Power supply",maxVoltage:3.3,rtc:!1},{number:2,side:"left",name:"EN",type:"I",analog:!1,description:"CHIP_PU, RESET",maxVoltage:3.3,rtc:!1},{number:3,side:"left",name:"36",type:"I",analog:!0,description:"GPIO36, ADC1_CH0, S_VP",maxVoltage:3.3,rtc:!0},{number:4,side:"left",name:"39",type:"I",analog:!0,description:"GPIO39, ADC1_CH3, S_VN",maxVoltage:3.3,rtc:!0},{number:5,side:"left",name:"34",type:"I",analog:!0,description:"GPIO34, ADC1_CH6, VDET_1",maxVoltage:3.3,rtc:!0},{number:6,side:"left",name:"35",type:"I",analog:!0,description:"GPIO35, ADC1_CH7, VDET_2",maxVoltage:3.3,rtc:!0},{number:7,side:"left",name:"32",type:"IO",analog:!0,description:"GPIO32, ADC1_CH4, TOUCH_CH9, XTAL_32K_P",maxVoltage:3.3,rtc:!0},{number:8,side:"left",name:"33",type:"IO",analog:!0,description:"GPIO33, ADC1_CH5, TOUCH_CH8, XTAL_32K_N",maxVoltage:3.3,rtc:!0},{number:9,side:"left",name:"25",type:"IO",analog:!0,description:"GPIO25, ADC1_CH8, DAC_1",maxVoltage:3.3,rtc:!0},{number:10,side:"left",name:"26",type:"IO",analog:!0,description:"GPIO26, ADC2_CH9, DAC_2",maxVoltage:3.3,rtc:!0},{number:11,side:"left",name:"27",type:"IO",analog:!0,description:"GPIO27, ADC2_CH7, TOUCH_CH7",maxVoltage:3.3,rtc:!0},{number:12,side:"left",name:"14",type:"IO",analog:!0,description:"GPIO14, ADC2_CH6, TOUCH_CH6, MTMS",maxVoltage:3.3,rtc:!0},{number:13,side:"left",name:"12",type:"IO",analog:!0,description:"GPIO12, ADC2_CH5, TOUCH_CH5, MTDI",maxVoltage:3.3,rtc:!0},{number:14,side:"left",name:"GND",type:"G",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:15,side:"left",name:"13",type:"IO",analog:!0,description:"GPIO13, ADC2_CH4, TOUCH_CH4, MTCK",maxVoltage:3.3,rtc:!0},{number:16,side:"left",name:"9",type:"IO",analog:!1,description:"GPIO9, D2",maxVoltage:3.3,rtc:!1},{number:17,side:"left",name:"10",type:"IO",analog:!1,description:"GPIO10, D3",maxVoltage:3.3,rtc:!1},{number:18,side:"left",name:"11",type:"IO",analog:!1,description:"GPIO11, CMD",maxVoltage:3.3,rtc:!1},{number:19,side:"left",name:"5V",type:"P",analog:!1,description:"5V Power supply",maxVoltage:5,rtc:!1},{number:1,side:"right",name:"GND",type:"G",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:2,side:"right",name:"23",type:"IO",analog:!1,description:"GPIO23",maxVoltage:3.3,rtc:!1},{number:3,side:"right",name:"22",type:"IO",analog:!1,description:"GPIO22",maxVoltage:3.3,rtc:!1},{number:4,side:"right",name:"TX",type:"IO",analog:!1,description:"GPIO1, U0TXD",maxVoltage:3.3,rtc:!1},{number:5,side:"right",name:"RX",type:"IO",analog:!1,description:"GPIO3, U0RXD",maxVoltage:3.3,rtc:!1},{number:6,side:"right",name:"21",type:"IO",analog:!1,description:"GPIO21",maxVoltage:3.3,rtc:!1},{number:7,side:"right",name:"GND",type:"GND",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:8,side:"right",name:"19",type:"IO",analog:!1,description:"GPIO19",maxVoltage:3.3,rtc:!1},{number:9,side:"right",name:"18",type:"IO",analog:!1,description:"GPIO18",maxVoltage:3.3,rtc:!1},{number:10,side:"right",name:"5",type:"IO",analog:!1,description:"GPIO5",maxVoltage:3.3,rtc:!1},{number:11,side:"right",name:"17",type:"IO",analog:!1,description:"GPIO17",maxVoltage:3.3,rtc:!1},{number:12,side:"right",name:"16",type:"IO",analog:!1,description:"GPIO16",maxVoltage:3.3,rtc:!1},{number:13,side:"right",name:"4",type:"IO",analog:!0,description:"GPIO4, ADC2_CH0, TOUCH_CH0",maxVoltage:3.3,rtc:!0},{number:14,side:"right",name:"0",type:"IO",analog:!0,description:"GPIO0, ADC2_CH1, TOUCH_CH1, Boot",maxVoltage:3.3,rtc:!0},{number:15,side:"right",name:"2",type:"IO",analog:!0,description:"GPIO2, ADC2_CH2, TOUCH_CH2",maxVoltage:3.3,rtc:!0},{number:16,side:"right",name:"15",type:"IO",analog:!0,description:"GPIO15, ADC2_CH3, TOUCH_CH3, MTDO",maxVoltage:3.3,rtc:!0},{number:17,side:"right",name:"8",type:"IO",analog:!1,description:"GPIO8, D1",maxVoltage:3.3,rtc:!1},{number:18,side:"right",name:"7",type:"IO",analog:!1,description:"GPIO7, D0",maxVoltage:3.3,rtc:!1},{number:19,side:"right",name:"CLK",type:"IO",analog:!1,description:"GPIO6, CLK",maxVoltage:3.3,rtc:!1}],config:{}},sdk:{name:"esphome"},subsystems:{},config:{mqttServer:{broker:"bo-firmware.protofy.xyz",port:1883,username:null,password:null,clientId:null,websocketEndpoint:"/ws",websocketProtocol:"ws"}},sdkConfig:{board:"esp32dev",framework:{type:"arduino"}}}],O=(0,S.F7)(async r=>(0,y.NA)(r,["admin"],{deviceDefinition:D}));var N=h(41585),R=h(57909),F=h(32627),M=h(30195),L=h(75370),q=h(54283);let G=L.V_.object({name:M.z.string().hint("ESP32, AT-MEGA2560  ARMv7, Protofy, ...").static().id(),sdks:M.z.array(M.z.string()).hint("esphome, platformio, wled, javascript, ...").hidden(),config:M.z.record(M.z.string(),M.z.string()).generate(()=>({}))}),z=q.$.createDerived("DeviceCoreModel",G);var U=h(6289),B=h(26887),H=h(48115),Z=h(40214),V=h(13997),$=h(50897),W=h(79562),K=h(6364);let X=L.V_.object({id:M.z.string().generate((0,K.Z)()).id(),name:M.z.string().hint("MicroPython, Platformio...").static()}),J=q.$.createDerived("DeviceSdkModel",X);var Y=h(2784);let Q={name:F.V,sdk:R.S},ee="/adminapi/v1/devicecores",et="/adminapi/v1/devicesdks?all=1";var en={component:r=>{var m;let{pageState:h,initialItems:f,itemData:g,pageSession:y,extraData:w}=r,[S,I]=(0,Y.useState)(null!==(m=null==w?void 0:w.sdks)&&void 0!==m?m:(0,U.E)("pending"));return(0,B.a)(r=>{H.bl.get({url:et},r)},I,null==w?void 0:w.cores),(0,u.jsx)(Z.D,{title:"Device Cores",pageSession:y,children:(0,u.jsx)(V.V,{integratedChat:!0,itemData:g,rowIcon:N.x,sourceUrl:ee,initialItems:f,numColumnsForm:1,entityName:"devicecores",name:"core",onAdd:r=>r,onEdit:r=>r,columns:$.Z.columns($.Z.column("name","name",!0),$.Z.column("sdk","sdk",!0,r=>{var m;return(0,u.jsx)("div",{style:{gap:"5px",display:"flex",flexDirection:"row"},children:null===(m=r.sdks)||void 0===m?void 0:m.map(r=>(0,u.jsx)(W.A,{text:r,color:"$gray5"}))})})),extraFieldsForms:{sdks:M.z.array(M.z.union([M.z.literal(""),M.z.literal("")])).generateOptions(()=>S.isLoaded?S.data.items.map(r=>J.load(r).getData()).map(r=>r.name):[]).after("name").display()},model:z,pageState:h,icons:Q,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,S.eq)(ee,["admin"],{},async()=>({sdks:await H.bl.get(et)}))},ei=h(66132);let ea=L.V_.object({name:M.z.string().hint("ESP32S3, CHUWI, Arduino UNO...").static().id(),core:M.z.string().hidden(),ports:M.z.array(M.z.record(M.z.string(),M.z.any())),config:M.z.record(M.z.string(),M.z.any())}),es=q.$.createDerived("DeviceBoardModel",ea),er={name:F.V,core:R.S},eo="/adminapi/v1/deviceboards",el="/adminapi/v1/devicecores?all=1";var ec={component:r=>{var m;let{pageState:h,initialItems:f,itemData:g,pageSession:y,extraData:w}=r,[S,I]=(0,Y.useState)(null!==(m=null==w?void 0:w.cores)&&void 0!==m?m:(0,U.E)("pending"));return(0,B.a)(r=>{H.bl.get({url:el},r)},I,null==w?void 0:w.cores),(0,u.jsx)(Z.D,{title:"Device Boards",pageSession:y,children:(0,u.jsx)(V.V,{integratedChat:!0,entityName:"deviceboards",itemData:g,rowIcon:ei.b,sourceUrl:eo,initialItems:f,numColumnsForm:1,name:"board",onAdd:r=>r,onEdit:r=>r,columns:$.Z.columns($.Z.column("name","name",!0),$.Z.column("core","core",!0,r=>(0,u.jsx)(W.A,{text:r.core,color:"$gray5"})),$.Z.column("ports","ports",!0,r=>(0,u.jsx)(W.A,{text:Object.keys(r.ports).length,color:"$gray5"}))),extraFieldsForms:{core:M.z.union(S.isLoaded?S.data.items.map(r=>M.z.literal(z.load(r).getId())):[]).after("name")},model:es,pageState:h,icons:er,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,S.eq)(eo,["admin"],{},async()=>({cores:await H.bl.get(el)}))},ed=h(40198),em=h(74705),eh=h(51813),ep=h(62962),e_=h(16399),eu=h(28554),ef=h(92301);let eg="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _fs-1 _fg-1 _miw-10037 ",eb={name:F.V,board:ei.b},ex="/adminapi/v1/devicedefinitions",ey="/adminapi/v1/deviceboards?all=1",ev="/adminapi/v1/devicecores?all=1";var ew={component:r=>{var m,h;let{workspace:f,pageState:g,initialItems:y,itemData:w,pageSession:S,extraData:E}=r,[P,A]=Y.useState(!1),[T,C]=Y.useState(!1),{resolvedTheme:D}=(0,e_.P)(),O={components:'[\n "mydevice",\n "esp32dev",\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n];\n\n'},[N,R]=(0,Y.useState)(O.components),[F,L]=Y.useState({}),q=(0,I.useRouter)(),G=(r,m)=>{F.setData({components:r,sdkConfig:{board:"esp32dev",framework:{type:"arduino"}}})},[K,X]=(0,Y.useState)(null!==(m=null==E?void 0:E.boards)&&void 0!==m?m:(0,U.E)("pending"));(0,B.a)(r=>{H.bl.get({url:ey},r)},X,null==E?void 0:E.deviceDefinitions);let J=K.isLoaded?K.data.items.map(r=>es.load(r).getData()):[],[Q,ee]=(0,Y.useState)(null!==(h=null==E?void 0:E.cores)&&void 0!==h?h:(0,U.E)("pending"));(0,B.a)(r=>{H.bl.get({url:ev},r)},ee,null==E?void 0:E.cores);let et=Q.isLoaded?Q.data.items.map(r=>z.load(r).getData()):[];return(0,u.jsxs)(Z.D,{title:"Device Definitions",workspace:f,pageSession:S,children:[(0,u.jsx)(eh.a,{open:P,setOpen:r=>{A(r)},hideAccept:!0,style:{width:"80%",height:"80%",padding:"0px",overflow:"hidden"},children:(0,u.jsx)("div",{className:eg,children:(0,u.jsx)(eu.Z,{style:{width:"100%"},disableDots:!0,onSave:T?r=>{console.log("ON SAVE: ",r),G(r,"a")}:null,hideBaseComponents:!0,disableStart:!0,getFirstNode:r=>r.find(r=>"ArrayLiteralExpression"==r.type),showActionsBar:T,mode:"device",customComponents:(0,ef.B)(q.pathname,q.query),bridgeNode:!1,setSourceCode:r=>{console.log("set new sourcecode from flows: ",r),R(r)},sourceCode:N,themeMode:D,config:{masks:(0,ef.W)(q.pathname,q.query),layers:[]},bgColor:"transparent",dataNotify:r=>{r.notifyId},positions:[],disableSideBar:!0,display:!0,flowId:"flows-editor"},"flow")})}),(0,u.jsx)(V.V,{integratedChat:!0,entityName:"devicedefinitions",itemData:w,rowIcon:ed.p,sourceUrl:ex,initialItems:y,numColumnsForm:1,name:"Definition",onAdd:r=>(console.log("DATA (onAdd): ",r),r),onEdit:r=>(console.log("DATA (onEdit): ",r),r),columns:$.Z.columns($.Z.column("name","name",!0),$.Z.column("board","board",!0,r=>(0,u.jsx)(W.A,{text:r.board,color:"$gray5"})),$.Z.column("sdk","sdk",!0,r=>(0,u.jsx)(W.A,{text:r.sdk,color:"$gray5"})),$.Z.column("config","config",!1,r=>(0,u.jsx)(ep.Z,{onPress:async m=>{console.log("row from Edit: ",r),C(!1),A(!0),R(r.config.components)},children:"View"}))),extraFieldsForms:{board:M.z.union(J.map(r=>M.z.literal(r.name))).after("name"),sdk:M.z.union([M.z.any(),M.z.any()]).dependsOn("board").generateOptions(r=>{if(r.board){let m=J.find(m=>m.name===r.board);return et.find(r=>r.name===m.core).sdks}return[]}).after("name")},model:em.q,pageState:g,icons:eb,dataTableGridProps:{itemMinWidth:300,spacing:20},customFields:{config:{component:(r,m,h,f)=>(console.log("inputs: ",{path:r,data:m,setData:h,mode:f}),"preview"==f)?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)(ep.Z,{onPress:u=>{A(!0),C(!0),"add"==f?R(O.components):R(m.components),L({path:r,data:m,setData:h,mode:f}),console.log("inputs: ",{path:r,data:m,setData:h,mode:f})},children:"Edit"}),hideLabel:!1}}})]})},getServerSideProps:(0,S.eq)(ex,["admin"],{},async()=>({boards:await H.bl.get(ey),cores:await H.bl.get(ev)}))};h(76649);var eS=h(65704),eI=h(32878);let eE={name:F.V,sdk:R.S},ej="/adminapi/v1/devicesdks";var eP={component:r=>{let{pageState:m,initialItems:h,itemData:f,pageSession:g}=r;return(0,u.jsx)(Z.D,{title:"Device Sdks",pageSession:g,children:(0,u.jsx)(V.V,{integratedChat:!0,entityName:"devicesdks",itemData:f,rowIcon:eI.E,sourceUrl:ej,initialItems:h,numColumnsForm:1,name:"Sdk",onAdd:r=>r,onEdit:r=>r,columns:$.Z.columns($.Z.column("id","id",!0),$.Z.column("name","name",!0)),model:J,pageState:m,icons:eE,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,S.eq)(ej,["admin"])},eA={"device-test/**":{component:C,getServerSideProps:O},"devices/**":eS.Z,"deviceSdks/**":eP,"deviceCores/**":en,"deviceBoards/**":ec,"deviceDefinitions/**":ew}},74705:function(r,m,h){"use strict";h.d(m,{q:function(){return w}});var u=h(30195),f=h(75370),g=h(54283);let y=f.V_.object({name:u.z.string().hint("Protofy screen controller...").static().id(),board:u.z.string().hidden(),sdk:u.z.string().hidden(),subsystems:u.z.record(u.z.string(),u.z.any()).optional(),config:u.z.record(u.z.string(),u.z.any())}),w=g.$.createDerived("DeviceDefinitionModel",y)},11010:function(r,m,h){"use strict";let u;h.d(m,{$:function(){return P},K:function(){return A}});var f=h(3089),g=h(58895),y=h(5436),w=h(71155),S=h(36076);let I="https://firmware.protofy.xyz/api/v1",E=async r=>{await r.device.setSignals({dataTerminalReady:!1,requestToSend:!0}),await r.device.setSignals({dataTerminalReady:!1,requestToSend:!1})},P=async()=>{let r=!0;try{u=await navigator.serial.requestPort()}catch(m){return m.name,r}if(!u)return r;try{await u.open({baudRate:115200})}catch(m){return r}},A=async r=>{let m,h;r({message:'Please hold "Boot" button of your ESP32 board.'});let P=new f.J(u),A=new g.p(P,115200,void 0);await u.close(),window.esploader=A;try{await A.main_fn()}catch(m){throw console.error(m),r({message:"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL.",details:{error:w.g.FAILED_INITIALIZING,details:m}}),await E(P),await P.disconnect(),"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL."}if(console.log("chipFamily: ",h=A.chip.CHIP_NAME),!A.chip.ROM_TEXT)throw r({message:"Chip ".concat(h," is not supported"),details:{error:w.g.NOT_SUPPORTED,details:"Chip ".concat(h," is not supported")}}),await E(P),await P.disconnect(),"Chip ".concat(h," is not supported");if(r({message:"Initialized. Found ".concat(h),details:{done:!0}}),!(m=S.I.builds.find(r=>r.chipFamily===h)))throw r({message:"Your ".concat(h," board is not supported."),details:{error:w.g.NOT_SUPPORTED,details:h}}),await E(P),await P.disconnect(),"Your ".concat(h," board is not supported.");r({message:"Preparing installation...",details:{done:!1}});let T=m.parts.map(async r=>{let m=I+"/device/download?configuration=test.yaml&type=firmware-factory.bin",h=await fetch(m);if(!h.ok)throw Error("Downlading firmware ".concat(m," failed: ").concat(h.status));let u=new FileReader,f=await h.blob();return new Promise(r=>{u.addEventListener("load",()=>r(u.result)),u.readAsBinaryString(f)})}),C=[],D=0;for(let h=0;h<T.length;h++)try{let r=await T[h];C.push({data:r,address:m.parts[h].offset}),D+=r.length}catch(m){r({message:m.message,details:{error:w.g.FAILED_FIRMWARE_DOWNLOAD,details:m.message}}),await E(P),await P.disconnect();return}r({message:"Installation prepared",details:{done:!0}}),r({message:"Erasing device...",details:{done:!1}}),await A.erase_flash(),r({message:"Device erased",details:{done:!0}}),r({message:"Writing progress: 0%",details:{bytesTotal:D,bytesWritten:0,percentage:0}});let O=0;try{await A.write_flash(C,"keep","keep","keep",!1,!0,(m,h,u)=>{let f=h/u*C[m].data.length,g=Math.floor((O+f)/D*100);if(h===u){O+=f;return}r({message:"Writing progress: ".concat(g,"%"),details:{bytesTotal:D,bytesWritten:O+h,percentage:g}})})}catch(m){r({message:m.message,details:{error:w.g.WRITE_FAILED,details:m}}),await E(P),await P.disconnect();return}r({message:"Writing complete",details:{bytesTotal:D,bytesWritten:O,percentage:100}}),await (0,y._)(100),console.log("HARD RESET"),await E(P),console.log("DISCONNECT"),await P.disconnect(),r({message:"All done!"})}},65704:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(52322),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2784),_tamagui_lucide_icons_dist_esm_icons_book_open__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(40198),_tamagui_lucide_icons_dist_esm_icons_tag__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(32627),_tamagui_lucide_icons_dist_esm_icons_router__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(15230),_devicesSchemas__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(1940),protolib__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(48115),protolib__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(26887),protolib__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(40214),protolib__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(13997),protolib__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(50897),protolib__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(62962),protolib__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(91838),protolib__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1888),protolib_base__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(30195),_deviceDefinitions__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(74705),_devicesUtils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(11010),mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(39684),protodevice_src_DeviceModal__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(6873),protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4400),protodevice_src_nodes_utils_subsystem__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(21621),_my_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(75296),protolib_base__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(6289);let _cn5="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-20px _mr-0px _mb-0px _ml-20px _ff-299667014 _fow-233016233 _ls-167744152 _fos-229441313 _lh-222976666 _ussel-auto font_body ",_cn4="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _pr-1481558214 _pl-1481558214 _pb-1316330238 _fg-1 ",_cn3="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",_cn2="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-1481558152 _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",_cn="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _h-10037 ",MqttTest=r=>{let{onSetStage:m,onSetModalFeedback:h}=r,{message:u}=(0,mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__.mU)(["device/compile"]),[f,g]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{console.log("Compile Message: ",u);try{if(null==u?void 0:u.message){let r=JSON.parse(null==u?void 0:u.message.toString());"exit"==r.event&&0==r.code?(g([]),console.log("Succesfully compiled"),m("upload")):"exit"==r.event&&0!=r.code&&(console.error("Error compiling",f),h({message:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:_cn,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn2,children:"Error compiling code."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn3,children:"Please check your flow configuration."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_my_ui__WEBPACK_IMPORTED_MODULE_3__.K,{textAlign:"left",f:1,mt:"$2",mb:"$5",children:f.map(r=>r.data).join("")})]}),details:{error:!0}})),g([...f,r])}}catch(r){console.log(r)}},[u]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{})},DevicesIcons={name:_tamagui_lucide_icons_dist_esm_icons_tag__WEBPACK_IMPORTED_MODULE_4__.V,deviceDefinition:_tamagui_lucide_icons_dist_esm_icons_book_open__WEBPACK_IMPORTED_MODULE_5__.p},callText=async(r,m,h,u)=>{var f={method:m,headers:{"Content-Type":"text/plain;charset=UTF-8"}};h&&(f.body=h);let g="?";-1!=r.indexOf("?")&&(g="&");var y=r+(u?g+"token="+u:"");return console.log("Deff URL: ",y),fetch(y,f).then(function(r){return 200==r.status?"ok":(console.log(r.status),r.ok,r)})},sourceUrl="/adminapi/v1/devices",definitionsSourceUrl="/adminapi/v1/deviceDefinitions?all=1";__webpack_exports__.Z={component:param=>{var _extraData_deviceDefinitions;let{pageState,initialItems,itemData,pageSession,extraData}=param;Object.keys(protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__.Z).forEach(r=>window[r]=protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__.Z[r]);let[showModal,setShowModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[modalFeedback,setModalFeedback]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[stage,setStage]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),yamlRef=react__WEBPACK_IMPORTED_MODULE_1__.useRef(),flashDevice=async(deviceName,deviceDefinitionId)=>{console.log("Flash device: ",{deviceName,deviceDefinitionId});let response=await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get("/adminapi/v1/deviceDefinitions/"+deviceDefinitionId);if(response.isError){alert(response.error);return}let deviceDefinition=response.data,response1=await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get("/adminapi/v1/deviceBoards/"+deviceDefinition.board);if(response1.isError){alert(response1.error);return}console.log("---------deviceDefinition----------",deviceDefinition),deviceDefinition.board=response1.data;let jsCode=deviceDefinition.config.components,deviceCode="device("+jsCode+")";console.log("-------DEVICE CODE------------",deviceCode);let deviceObj=eval(deviceCode.replace(/;/g,"")),componentsTree=deviceObj.getComponentsTree(deviceName,deviceDefinition),yaml=deviceObj.dump("yaml"),subsystems=deviceObj.getSubsystemsTree(deviceName,deviceDefinition),deviceObject=await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get("/adminapi/v1/devices/"+deviceName);if(deviceObject.isError){alert(deviceObject.error);return}deviceObject.data.subsystem=subsystems,protolib__WEBPACK_IMPORTED_MODULE_7__.bl.post("/adminapi/v1/devices/"+deviceName,deviceObject.data),console.log("ComponentsTree: ",componentsTree),console.log("Subsystems: ",subsystems),yamlRef.current=yaml,setShowModal(!0);try{setStage("yaml")}catch(e){console.error("error writting firmware: ",e)}},sendMessage=async r=>{await fetch("https://firmware.protofy.xyz/api/v1/device/compile")},compile=async()=>{setModalFeedback({message:"Compiling firmware...",details:{error:!1}});let r={type:"spawn",configuration:"test.yaml"};sendMessage(JSON.stringify(r))},flashCb=r=>{console.log(r),setModalFeedback(m=>m=r)},onSelectPort=async()=>{let r=await (0,_devicesUtils__WEBPACK_IMPORTED_MODULE_8__.$)();r||setStage("write")},saveYaml=async r=>{console.log("Save Yaml"),console.log(await callText("https://firmware.protofy.xyz/api/v1/device/edit?configuration=test.yaml","POST",r))};(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{let r=async()=>{if("yaml"==stage)await saveYaml(yamlRef.current),setStage("compile");else if("compile"==stage)console.log("stage - compile"),await compile();else if("write"==stage)try{await (0,_devicesUtils__WEBPACK_IMPORTED_MODULE_8__.K)(flashCb),setStage("idle")}catch(r){flashCb({message:"Error writing the device. Check that the USB connection and serial port are correctly configured.",details:{error:!0}})}else if("upload"==stage){let r=navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("Opera");r?(setModalFeedback({message:"Connect your device and click select to chose the port. ",details:{error:!1}}),console.log("chormium based true")):(console.log("chormium based very false"),setModalFeedback({message:"You need Chrome, Opera or Edge to upload the code to the device.",details:{error:!0}}))}};r()},[stage]);let[deviceDefinitions,setDeviceDefinitions]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!==(_extraData_deviceDefinitions=null==extraData?void 0:extraData.deviceDefinitions)&&void 0!==_extraData_deviceDefinitions?_extraData_deviceDefinitions:(0,protolib_base__WEBPACK_IMPORTED_MODULE_9__.E)("pending"));return(0,protolib__WEBPACK_IMPORTED_MODULE_10__.a)(r=>{protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get({url:definitionsSourceUrl},r)},setDeviceDefinitions,null==extraData?void 0:extraData.deviceDefinitions),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(protolib__WEBPACK_IMPORTED_MODULE_11__.D,{title:"Devices",pageSession:pageSession,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__.wR,{brokerUrl:"wss://firmware.protofy.xyz/ws",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protodevice_src_DeviceModal__WEBPACK_IMPORTED_MODULE_12__.Z,{stage:stage,onCancel:()=>setShowModal(!1),onSelect:onSelectPort,modalFeedback:modalFeedback,showModal:showModal}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(MqttTest,{onSetStage:r=>setStage(r),onSetModalFeedback:r=>setModalFeedback(r)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protolib__WEBPACK_IMPORTED_MODULE_13__.V,{integratedChat:!0,itemData:itemData,rowIcon:_tamagui_lucide_icons_dist_esm_icons_router__WEBPACK_IMPORTED_MODULE_14__.F,sourceUrl:sourceUrl,initialItems:initialItems,numColumnsForm:1,name:"device",onAdd:r=>r,onEdit:r=>r,columns:protolib__WEBPACK_IMPORTED_MODULE_15__.Z.columns(protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("name","name",!0),protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("device definition","deviceDefinition",!0),protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("config","config",!1,r=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protolib__WEBPACK_IMPORTED_MODULE_16__.Z,{onPress:m=>{flashDevice(r.name,r.deviceDefinition)},children:"Upload"}))),extraFieldsForms:{deviceDefinition:protolib_base__WEBPACK_IMPORTED_MODULE_17__.z.union(deviceDefinitions.isLoaded?deviceDefinitions.data.items.map(r=>protolib_base__WEBPACK_IMPORTED_MODULE_17__.z.literal(_deviceDefinitions__WEBPACK_IMPORTED_MODULE_18__.q.load(r).getId())):[]).after("name")},model:_devicesSchemas__WEBPACK_IMPORTED_MODULE_19__.O7,pageState:pageState,icons:DevicesIcons,dataTableGridProps:{itemMinHeight:320,itemMinWidth:320,spacing:20,onSelectItem:()=>{},getBody:(r,m)=>{var h,u=[];return null===(h=r.subsystem)||void 0===h||h.forEach(m=>{u.push((0,protodevice_src_nodes_utils_subsystem__WEBPACK_IMPORTED_MODULE_20__.Z)(m,r.name))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:_cn4,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(protolib__WEBPACK_IMPORTED_MODULE_21__.I,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn5,children:r.name}),u]})})}}})]})},getServerSideProps:(0,protolib__WEBPACK_IMPORTED_MODULE_22__.eq)(sourceUrl,["admin"],{},async()=>({initialDeviceDefinitions:await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get(definitionsSourceUrl)}))},__webpack_require__(8638)},1940:function(r,m,h){"use strict";h.d(m,{Hj:function(){return S},O7:function(){return w}});var u=h(30195),f=h(75370),g=h(54283);let y=f.V_.object({name:u.z.string().hint("Device name").static().regex(/^[a-z0-9A-Z]+$/,"Only lower case chars or numbers").id().search(),deviceDefinition:u.z.string().hidden(),substitutions:u.z.record(u.z.string().optional(),u.z.any().optional()).optional(),subsystem:u.z.record(u.z.string(),u.z.any()).optional(),data:u.z.array(u.z.record(u.z.string(),u.z.any())).optional(),location:u.z.object({lat:u.z.string(),long:u.z.string()}).optional().location("lat","long")}),w=g.$.createDerived("DevicesModel",y),S=function(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"devices/"+r+m}},10347:function(r,m,h){"use strict";h.d(m,{t:function(){return g}});var u=h(52322),f=h(2784);let g=(0,f.createContext)({active:0,setActive:r=>{}}),y=f.forwardRef((r,m)=>{let{initialState:h=0,children:y}=r,[w,S]=(0,f.useState)(h);return(0,u.jsx)(g.Provider,{value:{active:w,setActive:S},children:y})});m.Z=y},91681:function(r,m,h){"use strict";var u=h(52322),f=h(2784),g=h(10347),y=h(17277);let w=f.forwardRef((r,m)=>{let{activeId:h,onSetActive:w=r=>{},...S}=r,{active:I,setActive:E}=(0,f.useContext)(g.t);return(0,u.jsx)(y.Z,{onPress:()=>{w(h),E(h)},theme:h===I?"active":null,chromeless:h!==I,...S})});m.Z=w},61667:function(r,m,h){"use strict";var u=h(52322),f=h(2784),g=h(10347),y=h(52026);let w=f.forwardRef((r,m)=>{let{activeId:h,fast:w=!1,children:S,...I}=r,{active:E}=(0,f.useContext)(g.t),P=E==h;return w?(0,f.useMemo)(()=>(0,u.jsx)(y.Stack,{ref:m,position:"absolute",top:P?0:-1e4,...I,children:S}),[P]):P?(0,u.jsx)(y.Stack,{...I,ref:m,children:S}):null});m.Z=w},62962:function(r,m,h){"use strict";var u=h(52322),f=h(66306),g=h(52026),y=h(2784);let w=y.forwardRef((r,m)=>{let{textColor:h,fontFamily:y="$silkscreen",...w}=r;return(0,u.jsx)(f.zx,{ref:m,borderRadius:"$10",size:"$3",elevate:!0,space:"$3",...w,children:(0,u.jsx)(g.Text,{color:h,fontFamily:y,display:"flex",alignItems:"center",children:w.children})})});m.Z=w},50897:function(r,m,h){"use strict";h.d(m,{Z:function(){return S}});var u=h(52322);h(2784);var f=h(25237),g=h.n(f);let y=g()(()=>Promise.all([h.e(7788),h.e(2881)]).then(h.bind(h,90704)).then(r=>r.default),{loadableGenerated:{webpack:()=>[90704]},ssr:!1}),w=g()(()=>h.e(4210).then(h.bind(h,4210)).then(r=>r.default),{loadableGenerated:{webpack:()=>[4210]},ssr:!1}),S={component:r=>{let{pagination:m,conditionalRowStyles:h,rowsPerPage:f,columns:g,rows:S,onRowPress:I,handlePerRowsChange:E,handlePageChange:P,totalRows:A,currentPage:T,handleSort:C}=r,D={columns:g,data:S};return(0,u.jsx)(w,{print:!1,export:!1,filter:!1,...D,children:(0,u.jsx)(y,{conditionalRowStyles:h,responsive:!0,striped:!0,pointerOnHover:!0,columns:g,data:S,defaultSortField:"created",defaultSortAsc:!1,onRowClicked:I,onChangeRowsPerPage:E,onChangePage:P,paginationTotalRows:A,paginationDefaultPage:T,pagination:m,paginationServer:!0,sortServer:!0,paginationPerPage:f,onSort:C,paginationRowsPerPageOptions:[10,15,20,25,50,100,500,1e3]})})},column:function(r,m,h,u,f){let g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return{name:r,selector:m,sortable:h,cell:u,grow:f,minWidth:g}},columns:function(){for(var r=arguments.length,m=Array(r),h=0;h<r;h++)m[h]=arguments[h];return m}}},13997:function(r,m,h){"use strict";h.d(m,{V:function(){return e2},p:function(){return e0}});var u=h(52322),f=h(8939),g=h(89929),y=h(66306),w=h(48115),S=h(2784),I=h(39684),E=h(26887);let P=!0,A=(r,m,h,u)=>{let[f,g]=(0,S.useState)(r);(0,E.a)(r=>m(r),g,f);let{message:y}=(0,I.mU)(h);return console.log("subscribed to topic for changes: ",h),(0,S.useEffect)(()=>{if(y&&y.message){let r="string"==typeof y.message?y.message:JSON.stringify(y.message),h=JSON.parse(r),[,,f]=y.topic.split("/");P||g(r=>{let m=r.data||{},g=m.items||[];switch(f){case"create":return{...r,data:{...m,items:[h,...g]}};case"delete":let y=g.filter(r=>u.load(r).getId()!==u.load(h).getId());return{...r,data:{...m,items:y}};case"update":let w=g.map(r=>u.load(r).getId()===u.load(h).getId()?h:r);return{...r,data:{...m,items:w}};default:return r}}),m(g)}},[y]),[f,g]};var T=h(52026),C=h(99553),D=h(24066),O=h(6289),N=h(40914),R=h(94484);let F="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-bold _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",M="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center _jc-center ",L=r=>{let{index:m,data:h,width:f}=r,g=h.element.data,y=h.model.load(g),w=(0,R.d5)();return h.getCard?h.getCard(g,f):(0,u.jsx)(N.q,{height:h.itemHeight,cursor:"pointer",topBarOutSideScrollArea:!1,backgroundColor:"$color1",elevation:"$0",hoverStyle:{o:.8,backgroundColor:"$"+w.tint+"1",elevation:"$1"},borderWidth:1,pointerEvents:"none",pointerEventsControls:"none",onPress:()=>h.onSelectItem(y),...h.getPicture?{image:h.getPicture(g,f),hasPicture:!0}:{},children:h.getBody?h.getBody(g,f):(0,u.jsx)(T.Stack,{mb:"$4",width:f,children:(0,u.jsx)(D.G,{initialData:h.element,name:y.getId(),spinnerSize:75,loadingText:(0,u.jsxs)("div",{className:M,children:["Loading data...",(0,u.jsx)("p",{className:F})]}),objectId:y.getId(),sourceUrl:h.sourceUrl+"/"+y.getId(),mode:"preview",model:h.model,extraFields:h.extraFields,icons:h.icons,customFields:h.customFields,columnWidth:f-h.contentMargin,onDelete:h.onDelete,deleteable:h.deleteable,extraMenuActions:h.extraMenuActions})},g.key)})},q=r=>{let{overScanBy:m=5,gridElementCard:h,itemMinWidth:f=400,itemHeight:g,rightGap:y=30,contentMargin:w=50,onSelectItem:I=r=>{},extraMenuActions:E,spacing:P=20,getPicture:A,getBody:D,getCard:N,model:R,items:F,sourceUrl:M,customFields:q,onDelete:G,deleteable:z,extraFields:U,icons:B,children:H,...Z}=r,V=(0,S.useRef)(null),$=F.map((r,m)=>({id:"item_"+m,element:(0,O.E)("loaded",r),model:R,sourceUrl:M,customFields:q,extraFields:U,icons:B,itemMinWidth:f,getPicture:A,getBody:D,getCard:N,spacing:P,contentMargin:w,onSelectItem:I,onDelete:G,deleteable:z,itemHeight:g,extraMenuActions:E}));return(0,u.jsxs)(T.Stack,{f:1,ref:V,...Z,children:[(0,u.jsx)(C.rj,{overScanBy:m,rightGap:y,containerRef:V,spacing:P,data:$,card:null!=h?h:L,itemMinWidth:f},$.length),H]})};h(18190);var G=h(43260);let z=r=>{let{index:m,data:h,width:f}=r,g=h.element,y=h.model.load(g),w=h.onDelete;return(0,u.jsx)(T.Stack,{width:f,children:(0,u.jsx)(G.I,{compact:!0,innerContainerProps:{mb:"$3",mt:"$5",mx:"$3"},onDelete:w,json:g,name:y.getId(),isTemplate:!1})},g.key)},U=r=>{var m,h;let{itemMinWidth:f=400,rightGap:g=30,contentMargin:y=40,spacing:w=20,...I}=r,E=(0,S.useRef)(null),{items:P,model:A}=(0,S.useContext)(e0),D=null==P?void 0:null===(h=P.data)||void 0===h?void 0:null===(m=h.items)||void 0===m?void 0:m.map((r,m)=>({id:"item_"+m,element:r,model:A,onDelete:I.onDelete}));return(0,u.jsx)(T.Stack,{ml:"$5",ref:E,f:1,...I,children:(0,u.jsx)(C.rj,{rightGap:g,containerRef:E,spacing:w,data:D,card:z,itemMinWidth:f},D.length)})};var B=h(41473),H=h(2715),Z=h(16399),V=h(91838),$=h(10836);let W="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016233 _ls-167744152 _fos-229441313 _lh-222976666 _ussel-auto _ta-center font_body ",K="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-1316330269 _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016233 _ls-167744152 _fos-229441313 _lh-222976666 _ussel-auto _ta-center font_body ",X="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-137137640 ",J="  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px ",Y="  is_H2 _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-1316330269 _mr-0px _mb-0px _ml-0px _tt-230633015 _ff-299667014 _fow-233016295 _ls-167744214 _fos-229441375 _lh-222976728 _ussel-auto font_heading ",Q=r=>{let{...m}=r,{resolvedTheme:h}=(0,Z.P)(),g=(0,S.useRef)(null),y=(0,S.useContext)(e0),{tint:w}=(0,R.d5)(),[I,E]=(0,S.useState)({location:{lat:"",lon:""}}),P=y.items.data.items.map(r=>{let m=y.model.load(r);return{modelItem:m,location:m.getLocation()}}).filter(r=>r.location);return(0,S.useMemo)(()=>P.map((r,m)=>(0,u.jsx)(H.Jx,{color:"var(--"+w+"10)",longitude:r.location.lon,latitude:r.location.lat,anchor:"bottom",onClick:m=>{m.originalEvent.stopPropagation(),E(r)}},"marker-".concat(m))),[y.items.data.items,w]),(0,u.jsx)(T.Stack,{ref:g,f:1,...m,children:(0,u.jsx)(f.FA,{flex:1,alignItems:"center",justifyContent:"center",space:"$4",mt:"$-10",children:(0,u.jsxs)($.Z,{children:[(0,u.jsx)(B.u,{size:"$7"}),(0,u.jsxs)("h2",{className:Y,children:[(0,u.jsx)("span",{className:J,children:"Missing "}),(0,u.jsx)(V.I,{children:(0,u.jsx)("span",{className:X,children:"API Key"})})]}),(0,u.jsx)("p",{className:K,children:"Map rendering is unavailable without a Mapbox access token."}),(0,u.jsx)(V.I,{children:(0,u.jsxs)("p",{className:W,children:["Please visit ",(0,u.jsx)("a",{style:{fontWeight:"bold",color:"var(--color10)"},href:"https://www.mapbox.com",target:"_blank",rel:"noopener noreferrer",children:"Mapbox"})," to create your token and enable map features."]})})]})})})};h(51185);var ee=h(96666),et=h(10347),en=h(51813),ei=h(65126),ea=h(91681),es=h(53726),er=h(68604),eo=h(81815),el=h(99062),ec=h(57909),ed=h(57441),em=h(40641),eh=h(62624),ep=h(42738),e_=h(30195),eu=h(53763),ef=h(9393),eg=h(57643),eb=h(82695),ex=h(26879),ey=h(50897),ev=h(1963),ew=h(61773),eS=h(96455);let eI="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _o-0d0t846 _ml-1481558214 _t-6px ",eE="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mt-1481558214 ",ej="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-1481558152 _o-0d0t846 ",eP="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mt-1481558214 _ml-1481558152 _o-0d0t846 ",eA="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",eT="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _pt-1481558276 _fw-wrap ",eC=r=>{var m,h,f;let{sourceUrl:g,onDelete:y=()=>{},deleteable:w=()=>{},extraMenuActions:I=[],enableAddToInitialData:E}=r,{items:P,model:A,selected:C,setSelected:D,state:O,push:N,replace:R,mergePush:F,tableColumns:M,rowIcon:L,onSelectItem:q}=(0,S.useContext)(e0),G=[{when:r=>C.some(m=>m.id===A.load(r).getId()),style:{backgroundColor:"var(--color4)"},"&:hover":{backgroundColor:"var(--color4)"}}],z=A.load({}),U=z.getObjectSchema().isDisplay("table"),B=["ZodString","ZodNumber","ZodBoolean"],H=null!=M?M:ey.Z.columns(...Object.keys(U.shape).filter(r=>{var m;return B.includes(null===(m=U.shape[r]._def)||void 0===m?void 0:m.typeName)}).map(r=>{var m;return ey.Z.column(null!==(f=null===(m=U.shape[r]._def)||void 0===m?void 0:m.label)&&void 0!==f?f:r,r,!0)}));return(0,u.jsx)("div",{className:eT,children:(0,u.jsx)(V.I,{children:(0,u.jsx)(ey.Z.component,{pagination:!1,conditionalRowStyles:G,rowsPerPage:O.itemsPerPage?O.itemsPerPage:25,handleSort:(r,m)=>F({orderBy:r.selector,orderDirection:m}),handlePerRowsChange:r=>N("itemsPerPage",r),handlePageChange:r=>N("page",parseInt(r,10)-1),currentPage:(isNaN(parseInt(O.page,10))?0:parseInt(O.page,10))+1,totalRows:null==P?void 0:null===(m=P.data)||void 0===m?void 0:m.total,columns:[ey.Z.column((0,u.jsx)(T.Theme,{reset:!0,children:(0,u.jsxs)("div",{className:eA,children:[(0,u.jsx)("div",{className:eP,children:(0,u.jsx)(ex.XZ,{focusStyle:{outlineWidth:0},checked:C.length>1,onPress:r=>{if(C.length)D([]);else{var m,h;console.log("selection all: ",null==P?void 0:null===(m=P.data)||void 0===m?void 0:m.items),D(null==P?void 0:null===(h=P.data)||void 0===h?void 0:h.items)}},children:(0,u.jsx)(ex.XZ.Indicator,{children:(0,u.jsx)(ev.G,{})})})}),C.length>1&&(0,u.jsx)(eS.o,{enableAddToInitialData:E,type:"bulk",mt:"1px",ml:"-5px",element:C,sourceUrl:g,deleteable:w,onDelete:y,extraMenuActions:I})]})}),"",!1,r=>(0,u.jsx)(T.Theme,{reset:!0,children:(0,u.jsxs)("div",{className:ej,children:[(0,u.jsx)("div",{className:eE,children:(0,u.jsx)(ex.XZ,{focusStyle:{outlineWidth:0},onPress:()=>{let m=r=>A.load(r).getId(),h=m(r),u=C.some(r=>m(r)===h);u?D(C.filter(r=>m(r)!==h)):D([...C,r])},checked:C.some(m=>A.load(m).getId()===A.load(r).getId()),children:(0,u.jsx)(ex.XZ.Indicator,{children:(0,u.jsx)(ew.J,{})})})}),(0,u.jsx)(eS.o,{enableAddToInitialData:E,type:"item",ml:"-5px",mt:"1px",element:A.load(r),sourceUrl:g+"/"+A.load(r).getId(),deleteable:w,onDelete:y,extraMenuActions:I}),L&&(0,u.jsx)(V.I,{children:(0,u.jsx)("div",{className:eI,children:S.createElement(L,{size:"$1",color:"$color7"})})})]})}),!0,L?"115px":"75px"),...H],rows:null==P?void 0:null===(h=P.data)||void 0===h?void 0:h.items,onRowPress:r=>q?q(A.load(r)):R("item",A.load(r).getId())})})})};h(1435);var eD=h(61667),eO=h(48859),ek=h(95753),eN=h(46835),eR=h(71932),eF=h(5632);let eM="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ",eL="  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-1481558152 _miw-1481558152 _fs-0 _pe-none _w-1481558152 _h-1481558152 ",eq="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fos-14px _col-137137640 ",eG="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-1316330238 _ai-center ",ez="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-1481558214 ",eU="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center _ml-1481558152 ",eB="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center ",eH="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fos-229441251 _col-137137671 ",eZ="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",eV="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _l--12px _fg-1 _ai-center ",e$="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _pt-1481558152 _pr-1316330300 _pl-1316330300 _mb-1481558276 ",eW="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-bold _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",eK="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center _jc-center ",eX="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1316330238 ",eJ="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _jc-center _ai-center ",eY="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1316330238 ",eQ="  _ai-stretch _dsp-flex _fd-column _bxs-border-box _pos-relative _mih-0px _miw-0px  _h-10037 _fg-1 _fs-1 _fb-auto ",e0=(0,S.createContext)({items:(0,O.E)("pending"),model:null,selected:[],setSelected:r=>null,onSelectItem:void 0,state:{},push:()=>null,mergePush:()=>null,removePush:()=>null,replace:()=>null,tableColumns:[],rowIcon:null,sourceUrl:""}),e2=(0,S.forwardRef)((r,m)=>{let{onSelectItem:h,itemData:I,rowIcon:E,disableViewSelector:P=!1,initialItems:T,sourceUrl:C,numColumnsForm:N=1,name:R,pluralName:F,entityName:M,hideAdd:L=!1,enableAddToInitialData:G=!1,pageState:z,icons:B={},model:H,extraFields:Z={},columns:W,onEdit:K=r=>r,onDelete:X=r=>r,onAdd:J=r=>r,views:Y,extraViews:ex=[],openMode:ey="edit",disableToggleMode:ev,customFields:ew={},dataTableRawProps:eI={},dataTableListProps:eE={},dataTableGridProps:ej={},dataMapProps:eP={},extraFieldsForms:eA={},extraFieldsFormsEdit:eT={},extraFieldsFormsAdd:e2={},customFieldsForms:e3={},defaultView:e5="list",disableViews:e4=[],toolBarContent:e6=null,onAddButton:e7,extraMenuActions:e9=[],deleteable:e8=()=>!0,objectProps:te={},refreshOnHotReload:tt=!1}=r,tn=null!==(tC=null!=M?M:F)&&void 0!==tC?tC:R+"s",{query:ti}=(0,eF.useRouter)(),[ta,ts]=(0,S.useState)(null!=z?z:ti),tr=async r=>{let m=await w.bl.get({url:C,...ta});r(m)},[tl,tc]=A(T,tr,"notifications/"+H.load({}).getModelName()+"/#",H),[td,tm]=(0,S.useState)(null!=T?T:(0,O.E)("pending")),[th,tp]=(0,S.useState)(!1),{push:t_,mergePush:tu,removePush:tf,replace:tg}=(0,eb.N)(ta),[tb,tx]=(0,S.useState)([]),[ty,tv]=(0,S.useState)(I),{search:tw,setSearch:tS,setSearchName:tI}=(0,S.useContext)(eN.c),tE=e9&&e9.some(r=>r.menus&&r.menus.includes("global"));(0,eb.v)(ts),(0,S.useEffect)(()=>{},[]),(0,S.useEffect)(()=>{tl&&tl.isLoaded&&tm(tl)},[tl]),(0,eg.rf)(()=>{tw?t_("search",tw,!1):tf("search")},[tw]),(0,S.useEffect)(()=>{tI(tn)}),(0,eg.rf)(()=>{tr(tc)},[ta.orderBy+"_"+ta.itemsPerPage+"_"+ta.page+"_"+ta.search+"_"+ta.orderDirection]);let tj=(0,eu.Py)();var tP,tA,tT,tC,tD,tO,tk,tN=[{name:"list",icon:el.a,component:eC,props:{sourceUrl:C,deleteable:e8,onDelete:async r=>{if(Array.isArray(tb)&&tb.length&&C){let r=tb.map(r=>w.bl.get("".concat(C,"/").concat(H.load(r).getId(),"/delete")));await Promise.all(r),tx([])}else C&&await w.bl.get("".concat(r,"/delete"));X({sourceUrl:r,selected:tb})},enableAddToInitialData:G,extraMenuActions:e9,...eE}},{name:"grid",icon:eo.J,component:q,props:{mt:"$8",model:H,items:null==tl?void 0:null===(tP=tl.data)||void 0===tP?void 0:tP.items,sourceUrl:C,customFields:ew,extraFields:Z,icons:B,ml:"$5",deleteable:e8,onDelete:async r=>{await w.bl.get(r+"/delete"),X({sourceUrl:r,selected:tb})},onSelectItem:h||(r=>tg("item",r.getId())),extraMenuActions:e9,...ej}},{name:"raw",icon:ec.S,component:U,props:{mt:"$8",onDelete:async r=>{await w.bl.get("".concat(C,"/").concat(r,"/delete")),X({sourceUrl:C,selected:tb,key:r})},...eI}}];let tR={name:"map",icon:ep.$,component:Q,props:{mt:"$3",onDelete:async r=>{await w.bl.get("".concat(C,"/").concat(r,"/delete"))},...eP}},tF=H.load({}).getObjectSchema().is("location");tF.getFields().length&&(tN=[...tN,tR]);let tM=(null!=Y?Y:[...tN,...ex]).filter(r=>!e4.includes(r.name)),tL=-1!=tM.findIndex(r=>r.name==ta.view)?tM.findIndex(r=>r.name==ta.view):tM.findIndex(r=>r.name==e5),tq=r=>{let m=r.split("/");return m.pop()},tG=td&&td.isLoaded?Math.ceil((null===(tA=td.data)||void 0===tA?void 0:tA.total)/(null===(tT=td.data)||void 0===tT?void 0:tT.itemsPerPage)):0;return tl&&tl.isError?(0,u.jsxs)($.Z,{children:["Error: ",tl.error&&tl.error.error?tl.error.error:tl.error]}):(ta.editFile,(0,u.jsx)(ee.Z,{atom:td,children:(0,u.jsx)("div",{ref:m,className:eQ,children:(0,u.jsx)(e0.Provider,{value:{items:td,sourceUrl:C,model:H,selected:tb,setSelected:tx,onSelectItem:h,state:ta,push:t_,mergePush:tu,removePush:tf,replace:tg,tableColumns:W,rowIcon:E},children:(0,u.jsxs)(et.Z,{initialState:-1==tL?0:tL,children:[ta.editFile&&(0,u.jsx)(eO.l,{id:"file-widget-"+tq(null!==(tD=ta.editFile)&&void 0!==tD?tD:"").split(".")[0],isFull:!1,hideCloseIcon:!1,isModified:!0,setIsModified:()=>{},icons:[(0,u.jsx)(ek.q,{onPress:()=>{tf("editFile")},children:(0,u.jsx)(ed.X,{color:"var(--color)",size:"$1"})})],currentFileName:tq(null!==(tO=ta.editFile)&&void 0!==tO?tO:""),currentFile:ta.editFile}),(0,u.jsx)(en.a,{integratedChat:!0,p:"$2",pt:"$5",pl:"$5",setOpen:tp,open:th,hideAccept:!0,description:"",children:(0,u.jsx)(f.FA,{f:1,jc:"center",ai:"center",id:"admin-dataview-create-dlg",children:(0,u.jsx)(g.p,{maxHeight:"90vh",children:(0,u.jsx)("div",{className:eY,children:(0,u.jsx)(D.G,{id:"admin-eo",name:R,numColumns:N,mode:"add",onSave:async(r,m)=>{try{let r=H.load(m),h=tl.data.items.find(m=>m.id===r.getId());if(h)throw{error:"This id already exists"};let u=await w.bl.post(C,J(r.create().getData()));if(u.isError)throw u.error;tp(!1),tj.show(R+" created",{message:r.getId()})}catch(r){throw console.log("original error: ",r,r.flatten()),(0,O.E)("error",null,r instanceof e_.z.ZodError?r.flatten():r)}},model:H,extraFields:{...Z,...eA,...e2},icons:B,customFields:{...ew,...e3},...te})})})})}),(0,u.jsx)(en.a,{integratedChat:!0,p:"$1",pt:"$5",pl:"$5",hideAccept:!0,acceptCaption:"Save",setOpen:r=>{tv(void 0),tf("item")},open:ta.item,description:"",children:(0,u.jsx)("div",{className:eJ,children:(0,u.jsx)(g.p,{maxHeight:"90vh",children:(0,u.jsx)("div",{className:eX,children:(0,u.jsx)(D.G,{disableToggleMode:ev,initialData:ty,name:R,spinnerSize:75,loadingText:(0,u.jsxs)("div",{className:eK,children:["Loading data for ",R,(0,u.jsx)("p",{className:eW,children:ta.item})]}),objectId:ta.item,sourceUrl:C+"/"+ta.item,numColumns:N,mode:ey,onSave:async(r,m)=>{try{tv(void 0);let h=H.load(m).getId(),u=await w.bl.post(C+"/"+h,K(H.load(r).update(H.load(m)).getData()));if(u.isError)throw u.error;let{item:f,...g}=ta;ts(g),tj.show(R+" updated",{message:"Saved new settings for: "+h})}catch(r){throw(0,O.E)("error",null,r instanceof e_.z.ZodError?r.flatten():r)}},model:H,extraFields:{...Z,...eA,...eT},icons:B,customFields:{...ew,...e3},...te})})})})}),!ta.editFile&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("div",{className:e$,children:[(0,u.jsxs)("div",{className:eV,children:[(0,u.jsx)("p",{className:eZ,children:(0,u.jsx)("span",{className:eH,children:F?F.charAt(0).toUpperCase()+F.slice(1):R.charAt(0).toUpperCase()+R.slice(1)+"s"})}),tE?(0,u.jsx)(V.I,{children:(0,u.jsx)(eS.o,{type:"global",sourceUrl:"",hideDeleteButton:!0,element:"",extraMenuActions:e9})}):(0,u.jsx)(u.Fragment,{}),e6]}),(0,u.jsxs)("div",{className:eB,children:[(0,u.jsx)("div",{className:eU,children:td.isLoaded&&(0,u.jsx)("div",{className:ez,children:(0,u.jsxs)("div",{className:eG,children:[(0,u.jsx)("div",{className:eG,children:(0,u.jsxs)("span",{className:eq,children:[td.data.itemsPerPage*td.data.page+1,"-",Math.min(td.data.total,td.data.itemsPerPage*(td.data.page+1))," of ",td.data.total]})}),(0,u.jsxs)(V.I,{children:[(0,u.jsx)(eR.z,{Icon:em.s,onPress:r=>{r.stopPropagation(),td.data.page>0&&t_("page",td.data.page-1)},ml:"$3",disabled:!(td.data.page>0)}),(0,u.jsx)("span",{className:eL}),(0,u.jsx)(eR.z,{Icon:eh._,onPress:r=>{r.stopPropagation(),td.data.page<tG-1&&t_("page",td.data.page+1)},ml:"$3",disabled:!(td.data.page<tG-1)})]})]})})}),(0,u.jsxs)("div",{className:eU,children:[!P&&(0,u.jsx)(ei.Z,{marginRight:"$3",children:tM.map((r,m)=>(0,u.jsx)(ea.Z,{onSetActive:()=>t_("view",r.name),activeId:m,children:S.createElement(r.icon,{size:"$1",strokeWidth:1})},m))}),!L&&(0,u.jsx)(V.I,{children:(0,u.jsx)(y.zx,{id:"admin-dataview-add-btn",hoverStyle:{o:1},o:.7,circular:!0,onPress:()=>{e7?e7():tp(!0)},chromeless:!0,children:(0,u.jsx)(er.v,{color:"$color10"})})})]})]})]}),tl&&tl.isError&&(0,u.jsx)(es.q,{children:(0,u.jsx)("p",{className:eZ,children:(0,ef.e)(tl.error)})}),(0,u.jsx)("div",{className:eM,children:(0,u.jsx)(ee.Z,{atom:td,children:tM.map((r,m)=>(0,u.jsx)(eD.Z,{height:"100%",activeId:m,children:S.createElement(r.component,tk={...r.props})},m))})})]})]})})})}))});h(41234)},24066:function(r,m,h){"use strict";h.d(m,{G:function(){return e7}});var u=h(52322),f=h(80939),g=h(66306),y=h(8939),w=h(84291),S=h(45734),I=h(59928),E=h(36907),P=h(52026),A=h(60545),T=h(89560),C=h(32627),D=h(60166),O=h(57441),N=h(7324),R=h(99062),F=h(57909),M=h(91838),L=h(51813),q=h(48715),G=h(4273);let z="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _fs-0 _ai-flex-end _miw-40px _t--8px ",U="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ";function B(r){let{showLabel:m=!0,containerProps:h,defaultValue:f,children:g,...w}=r;return(0,u.jsxs)(y.sL,{f:1,...h,children:[(0,u.jsx)("div",{className:U,children:(0,u.jsxs)(G.iR,{f:1,defaultValue:[50],min:0,max:100,step:1,...w,children:[(0,u.jsx)(G.iR.Track,{f:1,children:(0,u.jsx)(G.iR.TrackActive,{})}),(0,u.jsx)(G.iR.Thumb,{index:0,size:"$1",circular:!0,elevate:!0}),g]})}),m&&(0,u.jsx)("div",{className:z,children:w.value})]})}h(5006);var H=h(6289),Z=h(26887),V=h(48115),$=h(99553),W=h(10836),K=h(96666),X=h(53726),J=h(2784),Y=h(9393),Q=h(55858),ee=h(75370),et=h(57643),en=h(94484),ei=h(96455);let ea="  is_Paragraph _bg-0hover-744986709 _cur-0hover-pointer _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-675002279 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto _pr-10px _pl-10px _pt-7px _pb-7px _btlr-4px _btrr-4px _bbrr-4px _bblr-4px font_body ",es="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ussel-auto   _cur-0hover-pointer _pr-10px _pl-10px _pt-7px _pb-7px _btlr-4px _btrr-4px _bbrr-4px _bblr-4px _fos-229441220 _col-675002279 _ff-299667014 _fow-233016140 _ls-167744059 _lh-222976573 _bg-549765356 font_body ",er="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-791969557 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto _pr-7px _pl-7px _pt-4px _pb-4px _btlr-4px _btrr-4px _bbrr-4px _bblr-4px font_body ",eo="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body  _pr-7px _pl-7px _pt-4px _pb-4px _bg-549765356 _btlr-4px _btrr-4px _bbrr-4px _bblr-4px _col-white ",el="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fw-wrap _h-797770429 _ox-hidden _oy-hidden _fg-1 _gap-1481558245 ",ec="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  _bg-115898854 _w-10037 _h-797770429 _jc-441309761 _ai-center _pr-10px _pl-10px _pt-7px _pb-7px _btlr-6px _btrr-6px _bbrr-6px _bblr-6px _outlineColor-791969495 _outlineWidth-1px _outlineStyle-solid _btc-791969495 _brc-791969495 _bbc-791969495 _blc-791969495 _cur-pointer ";function ed(r){let{choices:m,defaultSelections:h=[],onSetSelections:f,maxHeight:g="150px"}=r,w=(0,J.useRef)(null),[S,I]=(0,J.useState)(!1),[E,P]=(0,J.useState)(h),A=(r,h)=>{let u=m[m.indexOf(h)];if(E.includes(u)){let r=E.filter(r=>r!==u);f(r),P(r)}else{let r=E.concat(u);f(r),P(r)}};return(0,u.jsx)(M.I,{children:(0,u.jsxs)("div",{ref:w,onClick:()=>I(r=>!r),className:ec,children:[(0,u.jsx)("div",{className:el,children:E.length>0?E.map((r,m)=>(0,u.jsx)("p",{onClick:m=>A(m,r),className:eo,children:r},m)):(0,u.jsx)("p",{className:er,children:"Select"})}),(0,u.jsx)(D._,{}),S?(0,u.jsx)(y.FA,{zIndex:999,position:"absolute",top:"130%",left:"0%",width:"100%",backgroundColor:"$gray1",paddingHorizontal:"7px",paddingVertical:"7px",borderRadius:4,outlineColor:"$gray6",outlineWidth:1,outlineStyle:"solid",borderColor:"$borderColor",maxHeight:g,gap:"$1.5",overflow:"scroll",children:m.map((r,m)=>E.includes(r)?(0,u.jsx)("p",{onClick:m=>A(m,r),className:es,children:r},m):(0,u.jsx)("p",{onClick:m=>A(m,r),className:ea,children:r}))}):null]})})}h(94611);var em=h(70396);let eh="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _mt-1316330145 _pt-1481558214 _pr-1481558214 _pb-1316330238 _pl-1481558214 _w-10037 _fg-1 _als-center ",ep="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",e_=" _mt-1316330300",eu=" _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _w-10037 _fg-1  _ai-center _jc-center  ",ef="  _o-0active-0d0t846 _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  _cur-pointer ",eg="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-137137671 ",eb="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-549765294 ",ex="  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-bold _fos-40px ",ey=" _fg-1 _fs-1 _fb-auto",ev=" _fg-0 _fs-1 _fb-auto",ew=" _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  _mr-1316330238  ",eS="  is_H3 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-549765294 _tt-230632984 _ff-299667014 _fow-233016264 _ls-167744183 _fos-229441344 _lh-222976697 _ussel-auto font_heading ",eI="  is_H3 _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _tt-230632984 _ff-299667014 _fow-233016264 _ls-167744183 _fos-229441344 _lh-222976697 _ussel-auto font_heading ",eE="  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center ",ej="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _w-10037 ",eP="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _t-1316333121 ",eA="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ",eT="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _mt-1316330145 ",eC="  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-1316330176 _miw-1316330176 _fs-1 _w-1316330176 _h-1316330176 _pe-none _fg-1 ",eD="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-1481558214 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",eO=" _mt-1316330238",ek=" _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  ",eN="  _pos-absolute _r-1316330269 _t-6px",eR=" _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-1481558214 _t-13px _btlr-1307610029 _btrr-1307610029 _bbrr-1307610029 _bblr-1307610029 _pt-1481558214 _pr-1481558214 _pb-1481558214 _pl-1481558214 _als-flex-start _cur-pointer  _bg-0hover-312414245 _o-0active-0d0t746  ",eF="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1481558214 _t-20px ",eM=" _mt-1481558400",eL=" _mt-1481558214",eq=" _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  _ml-1481558276  ",eG="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",ez="  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-1481558276 _miw-1481558276 _fs-0 _pe-none _w-1481558276 _h-1481558276 ",eU="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1481558214 ",eB=" _ml-1481558400",eH=" _ml-1316330238",eZ=" _ai-stretch _dsp-flex _fd-column _bxs-border-box _pos-relative _mih-0px _miw-0px  _gap-1481558214 _fg-1 _fs-1 _fb-auto  ",eV="  is_Fieldset",e$=r=>r&&r[0].toUpperCase()+r.slice(1),eW={color:"var(--color9)",size:"$1",strokeWidth:1},eK=r=>{var m;let{ele:h,i:g,icon:y,children:w,inArray:S=!1}=r;return(0,u.jsxs)("fieldset",{className:(0,em.concatClassName)(eV+(eZ+(g?eH:eB))),children:[!S&&(0,u.jsxs)(f.__,{fontWeight:"bold",children:[(0,u.jsx)(M.I,{children:(0,u.jsx)("div",{className:eU,children:J.createElement(y,eW)})}),null!==(m=h._def.label)&&void 0!==m?m:h.name]}),S&&(0,u.jsx)("span",{className:ez}),w]},g)},eX={ZodString:"",ZodNumber:"0",ZodBoolean:!0,default:""},eJ=r=>eX.hasOwnProperty(r)?eX[r]:"ZodArray"==r?[]:"ZodObject"==r?{}:eX.default,eY=r=>{var m;let{ele:h,elementDef:f,icon:y,path:w,arrData:S,getElement:I,setFormData:E,data:P,setData:A,mode:C,customFields:D}=r;return(0,u.jsxs)(e3,{ele:h,title:" ("+S.length+")",icon:F.S,path:w,children:[(0,u.jsx)("div",{className:eG,children:S.map((r,m)=>(0,u.jsxs)("div",{className:(0,em.concatClassName)(""+(eq+(m?eL:eM))),children:["ZodObject"!=f.type._def.typeName&&(0,u.jsx)(M.I,{children:(0,u.jsx)("div",{className:eF,children:"edit"==C||"add"==C?(0,u.jsx)(T.z,{...eW}):(0,u.jsx)(N.$,{...eW})})}),I({ele:{...f.type._def,_def:f.type._def,name:m},icon:y,i:0,x:0,data:P,setData:A,mode:C,customFields:D,path:[...w,h.name],inArray:!0,arrayName:h.name}),("edit"==C||"add"==C)&&(0,u.jsx)("div",{onClick:()=>{S.splice(m,1),E(h.name,[...S])},className:(0,em.concatClassName)(""+(eR+("ZodObject"!=f.type._def.typeName?" ":eN))),children:(0,u.jsx)(O.X,{color:"var(--red7)",strokeWidth:2,size:20})})]},m))}),("edit"==C||"add"==C)&&(0,u.jsxs)(g.zx,{mt:"$4",onPress:()=>{let r="ZodLazy"==h._def.typeName?h._def.getter()._def:h._def;"ZodOptional"==r.typeName?r.innerType._def.type._def.typeName:r.type._def.typeName,E(h.name,[...S,eJ(f.type._def.typeName)])},children:["Add",null!==(m=h._def.label)&&void 0!==m?m:h.name]})]})},eQ=r=>{let{ele:m,elementDef:h,icon:f,path:g,data:y,setData:w,mode:S,customFields:I,inArray:E,arrayName:P,getFormData:A}=r;return(0,u.jsx)(e3,{simple:!0,ele:m,title:E?m._def.keyName?A(m._def.keyName,[...g,m.name]):P+" #"+(m.name+1):m.name,icon:R.a,path:g,children:(0,u.jsx)("div",{className:eG,children:Object.keys(h.shape()).map((r,E)=>{let P=h.shape();return(0,u.jsx)("div",{className:(0,em.concatClassName)(""+(ek+(E?eO:eM))),children:e5({ele:{...P[r],name:r},icon:f,i:0,x:0,data:y,setData:w,mode:S,customFields:I,path:[...g,m.name]})},E)})})})},e0=r=>{let{ele:m,icon:h,i:f,inArray:g,eleArray:y,formData:w,generatedOptions:S,setFormData:I}=r,E=["ZodNumber","ZodString","ZodLiteral"],P=y.map(r=>E.includes(r.typeName)?String(r.value):JSON.stringify(r.value));return(0,u.jsx)(eK,{ele:m,icon:h,i:f,inArray:g,children:(0,u.jsx)(ed,{choices:S.length?S:P,defaultSelections:w,onSetSelections:r=>I(m.name,r)})})},e2=r=>{let{ele:m,inArray:h,recordData:f,elementDef:S,icon:I,data:E,setData:P,mode:A,customFields:T,path:C,setFormData:D}=r,[O,N]=(0,J.useState)(!1),[F,M]=(0,J.useState)(""),q=(0,J.useRef)(null),[G,z]=(0,J.useContext)(e6);function U(r,m){let h=m.substring(0,m.lastIndexOf("/")+1),u=r.filter(r=>!r.startsWith(h)||r===h);return u.push(m),u}(0,J.useEffect)(()=>{if(O){let r=setTimeout(()=>{var r;null===(r=q.current)||void 0===r||r.focus()},100);return()=>clearTimeout(r)}},[O]);let B=async()=>{let r=eJ(m._def.valueType._def.typeName),h=[...C,m.name,F].join("/");N(!1),M(""),z(U(G,h)),D(m.name,{...f,[F]:r})};return(0,u.jsxs)(e3,{ele:m,title:h?" #"+(m.name+1):"...",icon:R.a,path:C,children:[(0,u.jsx)("div",{className:eG,children:f?Object.keys(f).map((r,h)=>(0,u.jsx)("div",{className:(0,em.concatClassName)(""+(eq+(h?eL:eM))),children:e5({ele:{...S.valueType,name:r},icon:I,i:0,x:0,data:E,setData:P,mode:A,customFields:T,path:[...C,m.name]})},h)):null}),(0,u.jsx)(L.a,{acceptCaption:"Add field",setOpen:N,open:O,onAccept:B,title:"Add new field",description:"",children:(0,u.jsx)(y.FA,{f:1,id:"eo-add-field-input",alignItems:"center",mt:"$6",justifyContent:"center",children:(0,u.jsx)(w.II,{f:1,value:F,onChangeText:r=>M(r),textAlign:"center",id:"name",placeholder:"Field name...",ref:q,onKeyPress:r=>{"Enter"===r.key&&B()}})})}),("edit"==A||"add"==A)&&(0,u.jsx)(g.zx,{id:"eo-obj-comp-btn",mt:"$5",onPress:()=>{N(!0)},children:" Add field"})]})},e3=r=>{let{ele:m,title:h,children:f,icon:g,simple:w=!1,path:E}=r,[P,A]=(0,J.useContext)(e6),T=[...E,m.name].join("/"),C=(0,u.jsx)(y.sL,{mb:"$2",id:"eo-formgroup",br:"$5",f:1,elevation:P.includes(T)?10:0,hoverStyle:{elevation:10},children:(0,u.jsx)(S.U,{value:P,onValueChange:r=>A(r),onPress:r=>r.stopPropagation(),type:"multiple",boc:"$gray6",f:1,children:(0,u.jsxs)(S.U.Item,{br:"$5",bw:1,boc:"$gray6",value:T,children:[(0,u.jsx)(S.U.Trigger,{p:0,px:8,height:43,bc:"$transparent",focusStyle:{bc:"$transparent"},br:P.includes(T)?"$0":"$5",btlr:"$5",btrr:"$5",bw:"$0",flexDirection:"row",ai:"center",children:r=>{let{open:m}=r;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(M.I,{children:w?J.createElement(g,eW):(0,u.jsx)(u.Fragment,{})}),(0,u.jsx)("p",{className:eD,children:h}),(0,u.jsx)("span",{className:eC}),(0,u.jsx)(I.b,{animation:"quick",rotate:m?"180deg":"0deg",children:(0,u.jsx)(D._,{size:"$1"})})]})}}),(0,u.jsx)(S.U.Content,{br:"$5",children:f})]})})});return w?C:(0,u.jsx)(eK,{ele:m,icon:g,i:0,children:C})},e5=r=>{var m,h,f,g,y,S;let{ele:I,icon:P,i:A,x:T,data:C,setData:D,mode:O,customFields:N={},path:R=[],inArray:F=!1,arrayName:L=""}=r,G=null!==(f=null===(h=I._def)||void 0===h?void 0:null===(m=h.innerType)||void 0===m?void 0:m._def)&&void 0!==f?f:I._def,z=(r,m)=>{let h,u;let f=C,g=f;R.forEach(r=>{Array.isArray(g)||g.hasOwnProperty(r)||(g[r]={}),h=g,u=r,g=g[r]}),g[r]=m,D({data:f})},U=(r,m)=>{let h=null!=C?C:{};for(let r of null!=m?m:R)("object"==typeof h&&h.hasOwnProperty(r)||Array.isArray(h)&&h.length>r)&&(h=h[r]);return"string"==typeof h?h:h&&h.hasOwnProperty(r)?h[r]:""},H=G.typeName;if("ZodLazy"==H){let r=G.getter();G=r._def,H=r.constructor.name,r.name=I.name,I=r}if(N.hasOwnProperty(I.name)||N.hasOwnProperty("*")){let r=N.hasOwnProperty(I.name)?N[I.name]:N["*"],m="function"==typeof r.component?r.component(R,U(I.name),r=>z(I.name,r),O,C):r.component;if(m)return r.hideLabel?m:(0,u.jsx)(eK,{ele:I,icon:P,i:A,inArray:F,children:m})}if("ZodUnion"==H&&"preview"!=O){let r=G.displayOptions?G.displayOptions:G.options.map(r=>r._def.value),m=G.options.map(r=>r._def.value);I._def.dependsOn&&C&&C[I._def.dependsOn]&&"function"==typeof I._def.generateOptions&&(m=[...r=I._def.generateOptions(C)]);let h=I._def.dependsOn,f=I._def.dependsOnValue,g=()=>h?C[h]?f?f==C[h]?(0,u.jsx)(q.E,{f:1,data:C,title:I.name,elements:r,value:r[m.indexOf(U(I.name))],setValue:h=>z(I.name,m[r.indexOf(h)])}):(0,u.jsx)(w.II,{focusStyle:{outlineWidth:1},disabled:!0,placeholder:I._def.hint?I._def.hint:"Fill "+h+" property first",bc:"$backgroundTransparent"}):(0,u.jsx)(q.E,{f:1,data:C,title:I.name,elements:r,value:r[m.indexOf(U(I.name))],setValue:h=>z(I.name,m[r.indexOf(h)])}):(0,u.jsx)(w.II,{focusStyle:{outlineWidth:1},disabled:!0,placeholder:I._def.hint?I._def.hint:"Fill "+h+" property first",bc:"$backgroundTransparent"}):(0,u.jsx)(q.E,{f:1,data:C,title:I.name,elements:r,value:r[m.indexOf(U(I.name))],setValue:h=>z(I.name,m[r.indexOf(h)])});return(0,u.jsx)(eK,{ele:I,icon:P,i:A,inArray:F,children:g()})}if("ZodNumber"==H&&"preview"!=O){if(G.checks){let r=G.checks.find(r=>"min"==r.kind),m=G.checks.find(r=>"max"==r.kind);if(r&&m)return(0,u.jsx)(eK,{ele:I,icon:P,i:A,inArray:F,children:(0,u.jsx)(M.I,{children:(0,u.jsx)("div",{className:eT,children:(0,u.jsx)(B,{onValueChange:r=>z(I.name,r),value:[null!==(g=U(I.name))&&void 0!==g?g:r.value],width:190,min:r.value,max:m.value})})})})}}else if("ZodObject"==H)return(0,u.jsx)(eQ,{ele:I,elementDef:G,icon:P,path:R,data:C,setData:D,mode:O,customFields:N,inArray:F,arrayName:L,getFormData:U});else if("ZodArray"==H){let r=U(I.name)?U(I.name):[],m=[];"function"==typeof I._def.generateOptions&&(m=I._def.generateOptions(C));let h=!I._def.innerType&&"ZodUnion"===I._def.type._def.typeName;return h?(0,u.jsx)(e0,{ele:I,icon:P,i:A,inArray:F,eleArray:I._def.type._def.options,formData:r,generatedOptions:m,setFormData:z}):(0,u.jsx)(eY,{data:C,setData:D,mode:O,ele:I,elementDef:G,icon:P,customFields:N,path:R,arrData:r||m,getElement:e5,setFormData:z})}else if("ZodRecord"==H){let r=U(I.name);return(0,u.jsx)(e2,{ele:I,inArray:F,recordData:r,elementDef:G,icon:P,data:C,setData:D,mode:O,customFields:N,path:R,setFormData:z})}else if("ZodBoolean"==H){let r=U(I.name);return(0,u.jsx)(eK,{ele:I,icon:P,i:A,inArray:F,children:(0,u.jsx)(M.I,{children:(0,u.jsx)("div",{className:eT,children:(0,u.jsx)(E.rs,{disabled:"add"!=O&&"edit"!=O,checked:r,onCheckedChange:r=>z(I.name,r),size:"$2",children:(0,u.jsx)(E.rs.Thumb,{animation:"quick"})})})})})}let Z="";return"function"!=typeof I._def.generateOptions||(Z=I._def.generateOptions(),U(I.name)||z(I.name,Z)),(0,u.jsx)(eK,{ele:I,icon:P,i:A,inArray:F,children:(0,u.jsx)("div",{className:eA,children:(0,u.jsx)(w.II,{id:"editable-object-input-"+(null==I?void 0:I.name),..."edit"!=O&&"add"!=O?{bw:0,forceStyle:"hover"}:{},focusStyle:{outlineWidth:1},disabled:"view"==O||"preview"==O||"edit"==O&&I._def.static||I._def.dependsOn&&!C[I._def.dependsOn],secureTextEntry:I._def.secret,value:Z&&!U(I.name)?Z:U(I.name),onChangeText:r=>z(I.name,"ZodNumber"==I._def.typeName?r.replace(/[^0-9.-]/g,""):r),placeholder:C?null!==(S=null!==(y=I._def.hint)&&void 0!==y?y:I._def.label)&&void 0!==S?S:"number"==typeof I.name?"...":I.name:"",autoFocus:0==T&&0==A,onBlur:()=>{if("ZodNumber"==I._def.typeName){let r=parseFloat(U(I.name));isNaN(r)||z(I.name,r)}},bc:"$backgroundTransparent"})})})},e4=r=>{let{index:m,data:h,width:f}=r;h.ele._def.size,h.ele._def.numColumns;let g=h.ele._def.size||1;return(0,u.jsx)(y.sL,{f:1,width:f*g+(g-1)*(h.columnMargin/g),children:e5({ele:h.ele,icon:h.icon,i:h.i,x:h.x,data:h.data||h.defaultData,setData:h.setData,mode:h.mode,customFields:h.customFields})},h.x)},e6=(0,J.createContext)([[],r=>{}]),e7=r=>{let{externalErrorHandling:m,error:h,setError:f,data:w,setData:S,EditIconNearTitle:I=!1,autoWidth:E=!1,columnMargin:D=30,columnWidth:N=350,extraMenuActions:R,disableToggleMode:F,name:q,initialData:G,loadingTop:z,spinnerSize:U,loadingText:B,title:ea,sourceUrl:es=null,onSave:er,mode:eo="view",model:el,icons:ec={},extraFields:ed={},numColumns:eT=1,objectId:eC,onDelete:eD=()=>{},deleteable:eO=()=>!0,customFields:ek={},...eN}=r,[eR,eF]=(0,J.useState)(null!=G?G:(0,H.E)("pending")),[eL,eq]=(0,J.useState)(eo),[ez,eU]=(0,J.useState)(""),[eB,eH]=(0,J.useState)(eR),eZ=w&&S;w&&S||(w=eB,S=eH);let[eV,eW]=(0,J.useState)(!1),[eK,eX]=(0,J.useState)();h&&f||m||(h=eK,f=eX);let[eJ,eY]=(0,J.useState)(!1),[eQ,e0]=(0,J.useState)(!1),[e2,e3]=(0,J.useState)(!1),e5=(0,J.useRef)(),[e7,e9]=(0,J.useState)([]);(0,Z.a)(r=>{"add"!=eo&&V.bl.get(es,r)},eF,G),(0,J.useEffect)(()=>{eR.data&&S(eR)},[eR]),(0,et.rf)(()=>eq(eo),[eo]),(0,et.rf)(()=>{e2?e0(!0):e3(!0)},[w]);let e8=()=>{let r=el.load(w.data),m=Q.U.load(ee.V_.object(ed)),h=r.getObjectSchema().isDisplay(eL).merge(m).getLayout(1),u={},f={};return h.forEach((r,m)=>r.forEach((r,h)=>{var g,y;let I=ec[r.name]?ec[r.name]:"edit"==eL||"add"==eL?T.z:C.V,E=null!==(g=r._def.group)&&void 0!==g?g:0;u.hasOwnProperty(E)||(u[E]=[]),r._def.hasOwnProperty("defaultValue")&&(f[r.name]=r._def.defaultValue),u[E].push({id:m+"_"+h,icon:I,i:h,x:m,ele:r,data:w.data,setData:S,mode:eL,size:null!==(y=r._def.size)&&void 0!==y?y:1,numColumns:eT,customFields:ek,columnMargin:D,defaultData:f})})),u},te=(0,J.useMemo)(e8,[ed,w,el,D,eT,eL,eo,eR]),tt=(0,J.useMemo)(()=>Object.keys(te).map((r,m)=>(0,u.jsxs)(y.sL,{ref:e5,mt:"$0",width:E?"100%":N*eT+D,f:1,children:[(0,u.jsx)("div",{className:eA,children:(0,u.jsx)($.rj,{masonry:!1,containerRef:e5,spacing:D/2,data:te[r],card:e4,itemMinWidth:N,columns:eT})}),"preview"==eL&&(0,u.jsx)("div",{className:eP,children:(0,u.jsx)(ei.o,{type:"item",sourceUrl:es,onDelete:eD,deleteable:eO,element:el.load(w.data),extraMenuActions:R})})]})),[D,te,N,eT]),{tint:tn}=(0,en.d5)();return(0,u.jsx)(e6.Provider,{value:[e7,e9],children:(0,u.jsxs)(P.Stack,{width:"100%",...eN,children:[(0,u.jsx)(L.a,{showCancel:!0,acceptCaption:"Discard",cancelCaption:"Keep editing",onAccept:async()=>{let r=await V.bl.get(es);eF(r),eq("view")},cancelTint:tn,acceptTint:"red",open:eJ,setOpen:eY,title:"Are you sure you want to leave?",description:"",children:(0,u.jsx)(W.Z,{mt:"$5",children:"All unsaved changes will be lost"})}),(0,u.jsx)(K.Z,{forceLoad:"add"==eL||w.data,waitForLoading:1e3,spinnerSize:U,loadingText:null!=B?B:"Loading "+eC,top:null!=z?z:-30,atom:w,children:(0,u.jsxs)("div",{className:ej,children:[(0,u.jsxs)("div",{className:eE,children:[(0,u.jsx)(y.sL,{mt:"preview"==eL?"$4":void 0,ml:"preview"==eL?"$4":void 0,id:"eo-dlg-title",children:(0,u.jsxs)("h3",{className:eI,children:[(0,u.jsx)(M.I,{children:(0,u.jsx)("h3",{className:eS,children:e$(eo)})})," ".concat(e$(q))]})}),ea&&(0,u.jsx)("div",{className:(0,em.concatClassName)(""+(ew+(I?ev:ey))),children:(0,u.jsxs)("span",{className:ex,children:[(0,u.jsx)(M.I,{children:(0,u.jsx)("span",{className:eb,children:e$(eL)})}),(0,u.jsxs)("span",{className:eg,children:[" ",e$(q)]})]})}),!F&&("view"==eL||"edit"==eL)&&(0,u.jsx)("div",{onClick:async()=>{"edit"==eL&&eQ?eY(!0):(eU(eL),eq("view"==eL?"edit":"view"))},className:ef,children:(0,u.jsx)(M.I,{children:(0,u.jsx)("div",{className:eG,children:"view"==eL?(0,u.jsx)(T.z,{color:"var(--color8)"}):"view"==ez?(0,u.jsx)(O.X,{color:"var(--color8)"}):null})})})]}),(0,u.jsxs)("div",{className:(0,em.concatClassName)(""+(eu+(ea?e_:eM))),children:[h&&(0,u.jsx)(X.q,{children:(0,u.jsx)("p",{className:ep,children:(0,Y.e)(h.error)})}),tt,"preview"!=eL&&(0,u.jsx)("div",{className:eh,children:("add"==eL||"edit"==eL)&&!eZ&&(0,u.jsx)(M.I,{children:(0,u.jsx)(g.zx,{f:1,onPress:async()=>{eW(!0);try{await er(eR.data,w.data),ez!=eL&&eq(ez)}catch(r){f(r),console.log("e: ",r)}eW(!1)},children:eV?(0,u.jsx)(A.$,{}):"add"==eL?"Create":"Save"})})})]})]})})]})})};h(31851)},99553:function(r,m,h){"use strict";h.d(m,{rj:function(){return T}});var u=h(52322),f=h(52026),g=h(8939),y=h(2784),w=h(23724),S=h(11667),I=h(23510);let E={width:0,height:0},P=function(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],[h,u]=(0,y.useState)(E);return(0,y.useLayoutEffect)(()=>{let{current:m}=r;if(m){let r=()=>{let r=getComputedStyle(m),h=parseFloat,f=m.clientWidth-h(r.paddingTop)-h(r.paddingBottom),g=m.clientHeight-h(r.paddingLeft)-h(r.paddingRight);u({height:g,width:f})};return r(),window.addEventListener("resize",r),window.addEventListener("orientationchange",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("orientationchange",r)}}},m.concat(r.current)),h},A=r=>{let[m,h]=(0,y.useState)(!1),[u,f]=(0,y.useState)(0);return(0,y.useLayoutEffect)(()=>{let m;let{current:h}=r;if(h){let r=h,u=()=>{m||(m=window.requestAnimationFrame(()=>{f(r.scrollTop),m=void 0}))};return r.addEventListener("scroll",u),()=>{r.removeEventListener("scroll",u),m&&window.cancelAnimationFrame(m)}}},[r.current]),(0,y.useLayoutEffect)(()=>{h(!0);let r=window.setTimeout(()=>{h(!1)},1e3/6);return()=>window.clearTimeout(r)},[u]),{scrollTop:u,isScrolling:m}},T=y.forwardRef((r,m)=>{let{overScanBy:h=5,masonry:E=!0,containerRef:T,rightGap:C=0,spacing:D,children:O,data:N,card:R,columns:F,itemMinWidth:M=200,gap:L}=r;if(f.isWeb&&N&&R){if(E&&T){var q,G;let r={current:(null===(q=T.current)||void 0===q?void 0:q.container)?null==T?void 0:null===(G=T.current)||void 0===G?void 0:G.container.firstChild:T.current},{width:m,height:u}=P(r),{scrollTop:f,isScrolling:g}=A(r),y=(0,w.G)({width:Math.max(0,m-C),columnGutter:D,columnWidth:M}),E=(0,S.y)(y);return(0,I.$)({positioner:y,scrollTop:f,isScrolling:g,height:u,items:N,overscanBy:h,resizeObserver:E,render:R})}return(0,u.jsx)(g.sL,{flexWrap:"wrap",children:N.map((r,m)=>(0,u.jsxs)(f.Stack,{m:D/2,children:[" ",y.createElement(R,{index:r.index,data:{...r},width:M})," "]},m))})}if(f.isWeb)return(0,u.jsx)("div",{ref:m,style:{gap:L,display:"grid",gridTemplateColumns:"repeat( auto-fill, minmax(".concat(M,"px, 1fr) )")},children:O});let z=y.Children.toArray(O);return(0,u.jsx)(g.sL,{alignItems:"center",justifyContent:"center",flexWrap:"wrap",children:z.map((r,m)=>r?(0,u.jsx)(g.sL,{flex:1,minWidth:M,marginRight:L,marginBottom:L,children:r},m):null)})})},96455:function(r,m,h){"use strict";h.d(m,{o:function(){return R}});var u=h(52322),f=h(8939),g=h(52026),y=h(86838),w=h(51813),S=h(2784),I=h(91838),E=h(10281),P=h(13742),A=h(71932),T=h(13997);let C="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",D="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ai-center _jc-center _pt-1481558152 _pr-1481558152 _pb-1481558152 _pl-1481558152 ",O="  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _jc-center _ai-center ",N="  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-1481558152 ",R=r=>{let{type:m,sourceUrl:h="",enableAddToInitialData:R=!1,onDelete:F,element:M,deleteable:L,extraMenuActions:q=[],hideDeleteButton:G,...z}=r,[U,B]=(0,S.useState)(!1),[H,Z]=(0,S.useState)(!1),{selected:V,setSelected:$,model:W}=(0,S.useContext)(T.p),K=r=>{let{id:m="",type:h,text:g,Icon:y,onPress:w,disabled:S}=r;return(0,u.jsxs)(f.sL,{id:m,ml:"$1",o:1,br:"$5",p:"$3",als:"flex-start",cursor:S?"default":"pointer",pressStyle:S?{}:{o:.7},hoverStyle:S?{}:{bc:"$color5"},onPress:r=>{S||(w("global"===h?"*":M,r),B(!1))},children:[(0,u.jsx)(y,{size:"$1",color:S?"var(--gray9)":"var(--color9)",strokeWidth:2}),(0,u.jsx)("span",{className:N,children:g})]})};return(0,u.jsxs)(g.Stack,{...z,children:[(0,u.jsx)(w.a,{acceptCaption:"Delete",setOpen:Z,open:H,onAccept:async r=>{await F(h),r(!1)},title:"Delete ",description:"Are you sure want to delete this item?",w:280,children:(0,u.jsx)("div",{className:O})}),(0,u.jsxs)(y.J2,{onOpenChange:B,open:U,placement:"bottom",children:[(0,u.jsx)(y.J2.Trigger,{children:(0,u.jsx)(A.z,{id:"more-btn-".concat(h.split("/").slice(-1)),Icon:E.h,onPress:r=>{r.stopPropagation(),B(!0)},ml:"$3"})}),(0,u.jsx)(y.J2.Content,{padding:0,space:0,left:"$7",top:"$2",bw:1,boc:"$borderColor",bc:"$color1",children:(0,u.jsx)(I.I,{children:(0,u.jsx)("div",{onClick:r=>r.stopPropagation(),className:D,children:(0,u.jsxs)("div",{className:C,children:[q.map((r,f)=>{var g;return(!r.menus&&"item"===m||r.menus&&(null===(g=r.menus)||void 0===g?void 0:g.includes(m)))&&r.isVisible&&r.isVisible(M)&&(0,u.jsx)(K,{id:"more-btn-".concat(h.split("/").slice(-1),"-option-").concat(f+1),type:m,text:"function"==typeof r.text?r.text(m):r.text,Icon:r.icon,onPress:r.action},f)}),!1,G?(0,u.jsx)(u.Fragment,{}):(0,u.jsx)(K,{type:m,text:"Delete",id:"more-btn-".concat(h.split("/").slice(-1),"-delete"),Icon:P.V,disabled:!L(M),onPress:(r,m)=>{m.stopPropagation(),Z(!0),B(!1)}})]})})})})]})]})};h(66286)},1888:function(r,m,h){"use strict";h.d(m,{F7:function(){return y},eq:function(){return w}});var u=h(44499),f=h(6429),g=h(48115);let y=r=>u.l.SSR?r:void 0;function w(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return y(async y=>{var w,S,I,E,P,A;let T={itemsPerPage:parseInt(y.query.itemsPerPage)?parseInt(y.query.itemsPerPage):"",page:parseInt(y.query.page,10)?parseInt(y.query.page,10):"",search:null!==(w=y.query.search)&&void 0!==w?w:"",orderBy:null!==(S=y.query.orderBy)&&void 0!==S?S:"",orderDirection:null!==(I=y.query.orderDirection)&&void 0!==I?I:"",view:null!==(E=y.query.view)&&void 0!==E?E:"",item:null!==(P=y.query.item)&&void 0!==P?P:"",editFile:null!==(A=y.query.editFile)&&void 0!==A?A:"",..."function"==typeof h?await h(y):h},C="function"==typeof r?r(y):r;return(0,f.NA)(y,m,{sourceUrl:C,initialItems:await g.bl.get({url:(0,f.VM)(C,y),...T}),itemData:y.query.item?await g.bl.get((0,f.VM)(C+"/"+y.query.item,y)):"",extraData:{..."function"==typeof u?await u(y):u},pageState:{...T}})})}},26887:function(r,m,h){"use strict";h.d(m,{a:function(){return f}});var u=h(57643);let f=(r,m,h)=>(0,u.qR)(()=>{h&&"pending"!=h.status?m(h):r(m)})},82695:function(r,m,h){"use strict";h.d(m,{N:function(){return w},v:function(){return y}});var u=h(5632),f=h(57643);let g=(r,m)=>{let{[m]:h,...u}=r;return u},y=r=>{let{query:m}=(0,u.useRouter)();(0,f.rf)(()=>{r(m)},[m])},w=r=>{let{replace:m,push:h,query:f}=(0,u.useRouter)(),y=()=>Object.keys(null!=r?r:{}).reduce((m,h)=>""!==r[h]?{...m,[h]:r[h]}:m,{});return{push:function(r,m){let u=!(arguments.length>2)||void 0===arguments[2]||arguments[2];h({query:{...f,...y(),[r]:m}},void 0,{shallow:u})},mergePush:r=>{h({query:{...f,...y(),...r}},void 0,{shallow:!0})},removePush:r=>{h({query:g(f,r)},void 0,{shallow:!0})},removeReplace:r=>{m({query:g(f,r)},void 0,{shallow:!0})},replace:(r,h)=>{m({query:{...f,...y(),[r]:h}},void 0,{shallow:!0})},mergeReplace:h=>{m({query:{...y(),...r,...h}},void 0,{shallow:!0})}}}},6873:function(r,m,h){"use strict";h.d(m,{Z:function(){return C}});var u=h(52322),f=h(2784),g={src:"/admin/_next/static/media/protofitoCompiling.7548c399.gif"},y={src:"/admin/_next/static/media/protofitoCompilingW.1d28e002.gif"},w={src:"/admin/_next/static/media/protofitoLoading.b3d41156.gif"},S={src:"/admin/_next/static/media/protofitoLoadingW.a84348f3.gif"},I={src:"/admin/_next/static/media/protofitoDancing.5a429207.gif"},E={src:"/admin/_next/static/media/protofitoDancingW.fa27d98c.gif"},P=h(51813),A=h(52026);let T=r=>{var m,h;let{stage:T,onCancel:C,onSelect:D,showModal:O,modalFeedback:N}=r,R=null==N?void 0:null===(m=N.details)||void 0===m?void 0:m.error,F=["write"].includes(T)&&!R&&!(null==N?void 0:null===(h=N.message)||void 0===h?void 0:h.includes('Please hold "Boot"'));F||["idle","compile"].includes(T);let M=(0,A.useThemeName)(),L={yaml:"Uploading yaml to the project...",compile:"Compiling firmware...",upload:"Connect your device and click select to chose the port. ",write:"Writting firmware to device. Please do not unplug your device.",idle:"Device configured successfully. You can unplug your device."},[q,G]=f.useState(L[T]),z=()=>"upload"===T&&!R&&(0,u.jsx)("div",{style:{textAlign:"center",color:R?"red":"",marginTop:R?"80px":"",marginBottom:"0px"},children:(0,u.jsxs)(u.Fragment,{children:["If you don't see your device on the menu, download device drivers on",(0,u.jsx)("a",{href:"https://www.silabs.com/documents/public/software/CP210x_Windows_Drivers.zip",target:"_blank",style:{paddingLeft:"5px"},children:"Windows"}),",",(0,u.jsx)("a",{href:"https://www.silabs.com/documents/public/software/Mac_OSX_VCP_Driver.zip",target:"_blank",style:{paddingInline:"5px"},children:"Mac"}),"or ",(0,u.jsx)("a",{href:"https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads",target:"_blank",children:"other OS"})]})}),U={compile:"1",upload:"2",write:"3",idle:"4"};return(0,u.jsx)(P.a,{open:O,hideAccept:!0,children:(0,u.jsxs)("div",{style:{height:"350px",width:"400px",position:"relative",overflow:"visible",justifyContent:"space-between",display:"flex",flexDirection:"column"},children:[(0,u.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,u.jsx)("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:"xs"},children:"[".concat(U[T],"/").concat(Object.keys(U).length,"]")}),(0,u.jsx)("div",{style:{flexGrow:1,textAlign:"center",color:R?"red":"",marginBottom:"0px",marginTop:"2"===U[T]?"100px":"0px"},children:N&&["write","compile","upload"].includes(T)?N.message:q}),(0,u.jsx)(z,{})]}),F?(0,u.jsx)("img",{alt:"protofito loading",style:{height:"160px",width:"300px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==M?w.src:S.src}):null,"idle"!=T||R?null:(0,u.jsx)("img",{alt:"protofito dancing",style:{height:"160px",width:"190px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==M?I.src:E.src}),"compile"!=T||R?null:(0,u.jsx)("img",{alt:"protofito compiling",style:{height:"160px",width:"180px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==M?g.src:y.src}),(0,u.jsxs)("div",{style:{justifyContent:"center",alignSelf:"center",display:"flex",gap:"20px"},children:["write"!=T&&"idle"!=T||R?(0,u.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"#cccccc40",borderRadius:"10px"},onClick:()=>{C()},children:"Cancel"}):(0,u.jsx)(u.Fragment,{}),"upload"==T?(0,u.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{D()},children:"Select"}):(0,u.jsx)(u.Fragment,{}),"idle"==T?(0,u.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{C()},children:"Done!"}):(0,u.jsx)(u.Fragment,{})]})]})})};var C=T},71155:function(r,m,h){"use strict";var u,f;h.d(m,{g:function(){return f}}),function(r){r.INITIALIZING="initializing",r.PREPARING="preparing",r.ERASING="erasing",r.WRITING="writing",r.FINISHED="finished",r.ERROR="error"}(u||(u={})),function(r){r.FAILED_INITIALIZING="failed_initialize",r.FAILED_MANIFEST_FETCH="fetch_manifest_failed",r.NOT_SUPPORTED="not_supported",r.FAILED_FIRMWARE_DOWNLOAD="failed_firmware_download",r.WRITE_FAILED="write_failed"}(f||(f={}))},58895:function(r,m,h){"use strict";h.d(m,{p:function(){return y}});class u extends Error{}var f=h(32845);async function g(r){switch(r){case 15736195:{let{ESP32ROM:r}=await h.e(1568).then(h.bind(h,91568));return new r}case 1763790959:case 456216687:{let{ESP32C3ROM:r}=await h.e(5867).then(h.bind(h,65867));return new r}case 9:{let{ESP32S3ROM:r}=await h.e(5963).then(h.bind(h,15963));return new r}case 1990:{let{ESP32S2ROM:r}=await h.e(2579).then(h.bind(h,2579));return new r}case 4293968129:{let{ESP8266ROM:r}=await h.e(90).then(h.bind(h,40090));return new r}default:return null}}class y{_sleep(r){return new Promise(m=>setTimeout(m,r))}write(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.terminal?m?this.terminal.writeLine(r):this.terminal.write(r):console.log(r)}error(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write("Error: ".concat(r),m)}info(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write(r,m)}debug(r){let m=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.debugLogging&&this.write("Debug: ".concat(r),m)}_short_to_bytearray(r){return new Uint8Array([255&r,r>>8&255])}_int_to_bytearray(r){return new Uint8Array([255&r,r>>8&255,r>>16&255,r>>24&255])}_bytearray_to_short(r,m){return r|m>>8}_bytearray_to_int(r,m,h,u){return r|m<<8|h<<16|u<<24}_appendBuffer(r,m){let h=new Uint8Array(r.byteLength+m.byteLength);return h.set(new Uint8Array(r),0),h.set(new Uint8Array(m),r.byteLength),h.buffer}_appendArray(r,m){let h=new Uint8Array(r.length+m.length);return h.set(r,0),h.set(m,r.length),h}ui8ToBstr(r){let m="";for(let h=0;h<r.length;h++)m+=String.fromCharCode(r[h]);return m}bstrToUi8(r){let m=new Uint8Array(r.length);for(let h=0;h<r.length;h++)m[h]=r.charCodeAt(h);return m}async flush_input(){try{await this.transport.rawRead(200)}catch(r){this.error(r.message)}}async command(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uint8Array(0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=!(arguments.length>3)||void 0===arguments[3]||arguments[3],g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;if(null!=r){let u;let f=new Uint8Array(8+m.length);for(u=0,f[0]=0,f[1]=r,f[2]=this._short_to_bytearray(m.length)[0],f[3]=this._short_to_bytearray(m.length)[1],f[4]=this._int_to_bytearray(h)[0],f[5]=this._int_to_bytearray(h)[1],f[6]=this._int_to_bytearray(h)[2],f[7]=this._int_to_bytearray(h)[3];u<m.length;u++)f[8+u]=m[u];await this.transport.write(f)}if(!f)return[0,new Uint8Array(0)];for(let m=0;m<100;m++){let m=await this.transport.read(g),h=m[0],f=m[1],y=this._bytearray_to_int(m[4],m[5],m[6],m[7]),w=m.slice(8);if(1==h){if(null==r||f==r)return[y,w];if(0!=w[0]&&w[1]==this.ROM_INVALID_RECV_MSG)throw await this.flush_input(),new u("unsupported command error")}}throw new u("invalid response")}async read_reg(r){let m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,h=this._int_to_bytearray(r),u=await this.command(this.ESP_READ_REG,h,void 0,void 0,m);return u[0]}async write_reg(r,m){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967295,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));g=this._appendArray(g,this._int_to_bytearray(h)),g=this._appendArray(g,this._int_to_bytearray(u)),f>0&&(g=this._appendArray(g,this._int_to_bytearray(this.chip.UART_DATE_REG_ADDR)),g=this._appendArray(g,this._int_to_bytearray(0)),g=this._appendArray(g,this._int_to_bytearray(0)),g=this._appendArray(g,this._int_to_bytearray(f))),await this.check_command("write target memory",this.ESP_WRITE_REG,g)}async sync(){let r;this.debug("Sync");let m=new Uint8Array(36);for(r=0,m[0]=7,m[1]=7,m[2]=18,m[3]=32;r<32;r++)m[4+r]=85;try{let r=await this.command(8,m,void 0,void 0,100);return r}catch(r){throw this.debug("Sync err "+r),r}}async _connect_attempt(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",m=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.debug("_connect_attempt "+r+" "+m),"no_reset"!==r&&(this.transport.get_pid()===this.USB_JTAG_SERIAL_PID?(await this.transport.setRTS(!1),await this.transport.setDTR(!1),await this._sleep(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(100),await this.transport.setRTS(!0),await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)):(await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),m&&await this._sleep(2e3),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(50)),await this.transport.setDTR(!1));let h=0,u=!0;for(;u;){try{let r=await this.transport.read(1e3);h+=r.length}catch(r){if(this.debug(r.message),r instanceof Error){u=!1;break}}await this._sleep(50)}for(this.transport.slip_reader_enabled=!0,h=7;h--;){try{let r=await this.sync();return this.debug(r[0].toString()),"success"}catch(r){r instanceof Error&&(m?this.info("_",!1):this.info(".",!1))}await this._sleep(50)}return"error"}async connect(){let r,m,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(this.info("Connecting...",!1),await this.transport.connect(this.rom_baudrate),r=0;r<f&&"success"!==(m=await this._connect_attempt(h,!1))&&"success"!==(m=await this._connect_attempt(h,!0));r++);if("success"!==m)throw new u("Failed to connect with the device");if(this.info("\n\r",!1),!y){let r=await this.read_reg(1073745920)>>>0;this.debug("Chip Magic "+r.toString(16));let m=await g(r);if(null===this.chip)throw new u("Unexpected CHIP magic value ".concat(r,". Failed to autodetect chip type."));this.chip=m}}async detect_chip(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.connect(r),this.info("Detecting chip type... ",!1),null!=this.chip?this.info(this.chip.CHIP_NAME):this.info("unknown!")}async check_command(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Uint8Array(0),u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;this.debug("check_command "+r);let g=await this.command(m,h,u,void 0,f);return g[1].length>4?g[1]:g[0]}async mem_begin(r,m,h,u){this.debug("mem_begin "+r+" "+m+" "+h+" "+u.toString(16));let f=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));f=this._appendArray(f,this._int_to_bytearray(h)),f=this._appendArray(f,this._int_to_bytearray(u)),await this.check_command("enter RAM download mode",this.ESP_MEM_BEGIN,f)}async mem_block(r,m){let h=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,r);let u=this.checksum(r);await this.check_command("write to target RAM",this.ESP_MEM_DATA,h,u)}async mem_finish(r){let m=0===r?1:0,h=this._appendArray(this._int_to_bytearray(m),this._int_to_bytearray(r));await this.check_command("leave RAM download mode",this.ESP_MEM_END,h,void 0,50)}async flash_spi_attach(r){let m=this._int_to_bytearray(r);await this.check_command("configure SPI flash pins",this.ESP_SPI_ATTACH,m)}async flash_begin(r,m){let h=Math.floor((r+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),u=this.chip.get_erase_size(m,r),f=new Date,g=f.getTime(),y=3e3;!1==this.IS_STUB&&(y=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,r)),this.debug("flash begin "+u+" "+h+" "+this.FLASH_WRITE_SIZE+" "+m+" "+r);let w=this._appendArray(this._int_to_bytearray(u),this._int_to_bytearray(h));w=this._appendArray(w,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),w=this._appendArray(w,this._int_to_bytearray(m)),!1==this.IS_STUB&&(w=this._appendArray(w,this._int_to_bytearray(0))),await this.check_command("enter Flash download mode",this.ESP_FLASH_BEGIN,w,void 0,y);let S=f.getTime();return 0!=r&&!1==this.IS_STUB&&this.info("Took "+(S-g)/1e3+"."+(S-g)%1e3+"s to erase flash block"),h}async flash_defl_begin(r,m,h){let u,f;let g=Math.floor((m+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),y=Math.floor((r+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),w=new Date,S=w.getTime();this.IS_STUB?(u=r,f=3e3):(u=y*this.FLASH_WRITE_SIZE,f=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,u)),this.info("Compressed "+r+" bytes to "+m+"...");let I=this._appendArray(this._int_to_bytearray(u),this._int_to_bytearray(g));I=this._appendArray(I,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),I=this._appendArray(I,this._int_to_bytearray(h)),("ESP32-S2"===this.chip.CHIP_NAME||"ESP32-S3"===this.chip.CHIP_NAME||"ESP32-C3"===this.chip.CHIP_NAME)&&!1===this.IS_STUB&&(I=this._appendArray(I,this._int_to_bytearray(0))),await this.check_command("enter compressed flash mode",this.ESP_FLASH_DEFL_BEGIN,I,void 0,f);let E=w.getTime();return 0!=r&&!1===this.IS_STUB&&this.info("Took "+(E-S)/1e3+"."+(E-S)%1e3+"s to erase flash block"),g}async flash_block(r,m,h){let u=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,r);let f=this.checksum(r);await this.check_command("write to target Flash after seq "+m,this.ESP_FLASH_DATA,u,f,h)}async flash_defl_block(r,m,h){let u=this._appendArray(this._int_to_bytearray(r.length),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,r);let f=this.checksum(r);this.debug("flash_defl_block "+r[0].toString(16)+" "+r[1].toString(16)),await this.check_command("write compressed data to flash after seq "+m,this.ESP_FLASH_DEFL_DATA,u,f,h)}async flash_finish(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=r?0:1,h=this._int_to_bytearray(m);await this.check_command("leave Flash mode",this.ESP_FLASH_END,h)}async flash_defl_finish(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],m=r?0:1,h=this._int_to_bytearray(m);await this.check_command("leave compressed flash mode",this.ESP_FLASH_DEFL_END,h)}async run_spiflash_command(r,m,h){let f,g;let y=-2147483648,w=268435456,S=134217728,I=this.chip.SPI_REG_BASE,E=I+0,P=I+this.chip.SPI_USR_OFFS,A=I+this.chip.SPI_USR1_OFFS,T=I+this.chip.SPI_USR2_OFFS,C=I+this.chip.SPI_W0_OFFS;f=null!=this.chip.SPI_MOSI_DLEN_OFFS?async(r,m)=>{let h=I+this.chip.SPI_MOSI_DLEN_OFFS,u=I+this.chip.SPI_MISO_DLEN_OFFS;r>0&&await this.write_reg(h,r-1),m>0&&await this.write_reg(u,m-1)}:async(r,m)=>{let h=A,u=17,f=8,g=0===r?0:r-1,y=0===m?0:m-1,w=y<<f|g<<u;await this.write_reg(h,w)};let D=262144,O=28;if(h>32)throw new u("Reading more than 32 bits back from a SPI flash operation is unsupported");if(m.length>64)throw new u("Writing more than 64 bytes of data with one SPI command is unsupported");let N=8*m.length,R=await this.read_reg(P),F=await this.read_reg(T),M=y;h>0&&(M|=w),N>0&&(M|=S),await f(N,h),await this.write_reg(P,M);let L=7<<O|r;if(await this.write_reg(T,L),0==N)await this.write_reg(C,0);else{if(m.length%4!=0){let r=new Uint8Array(m.length%4);m=this._appendArray(m,r)}let r=C;for(g=0;g<m.length-4;g+=4)L=this._bytearray_to_int(m[g],m[g+1],m[g+2],m[g+3]),await this.write_reg(r,L),r+=4}for(await this.write_reg(E,D),g=0;g<10&&0!=(L=await this.read_reg(E)&D);g++);if(10===g)throw new u("SPI command did not complete in time");let q=await this.read_reg(C);return await this.write_reg(P,R),await this.write_reg(T,F),q}async read_flash_id(){let r=159,m=new Uint8Array(0);return await this.run_spiflash_command(r,m,24)}async erase_flash(){this.info("Erasing flash (this may take a while)...");let r=new Date,m=r.getTime(),h=await this.check_command("erase flash",this.ESP_ERASE_FLASH,void 0,void 0,this.CHIP_ERASE_TIMEOUT);r=new Date;let u=r.getTime();return this.info("Chip erase completed successfully in "+(u-m)/1e3+"s"),h}toHex(r){return Array.prototype.map.call(r,r=>("00"+r.toString(16)).slice(-2)).join("")}async flash_md5sum(r,m){let h=this.timeout_per_mb(this.MD5_TIMEOUT_PER_MB,m),u=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(m));u=this._appendArray(u,this._int_to_bytearray(0)),u=this._appendArray(u,this._int_to_bytearray(0));let f=await this.check_command("calculate md5sum",this.ESP_SPI_FLASH_MD5,u,void 0,h);f instanceof Uint8Array&&f.length>16&&(f=f.slice(0,16));let g=this.toHex(f);return g}async run_stub(){let r;this.info("Uploading stub...");let m=atob(this.chip.ROM_TEXT),h=m.split("").map(function(r){return r.charCodeAt(0)}),f=new Uint8Array(h);h=(m=atob(this.chip.ROM_DATA)).split("").map(function(r){return r.charCodeAt(0)});let g=new Uint8Array(h),y=Math.floor((f.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);for(await this.mem_begin(f.length,y,this.ESP_RAM_BLOCK,this.chip.TEXT_START),r=0;r<y;r++){let m=r*this.ESP_RAM_BLOCK,h=m+this.ESP_RAM_BLOCK;await this.mem_block(f.slice(m,h),r)}for(y=Math.floor((g.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK),await this.mem_begin(g.length,y,this.ESP_RAM_BLOCK,this.chip.DATA_START),r=0;r<y;r++){let m=r*this.ESP_RAM_BLOCK,h=m+this.ESP_RAM_BLOCK;await this.mem_block(g.slice(m,h),r)}this.info("Running stub..."),await this.mem_finish(this.chip.ENTRY);for(let r=0;r<100;r++){let r=await this.transport.read(1e3,6);if(79===r[0]&&72===r[1]&&65===r[2]&&73===r[3])return this.info("Stub running..."),this.IS_STUB=!0,this.FLASH_WRITE_SIZE=16384,this.chip}throw new u("Failed to start stub. Unexpected response")}async change_baud(){this.info("Changing baudrate to "+this.baudrate);let r=this.IS_STUB?this.transport.baudrate:0,m=this._appendArray(this._int_to_bytearray(this.baudrate),this._int_to_bytearray(r)),h=await this.command(this.ESP_CHANGE_BAUDRATE,m);this.debug(h[0].toString()),this.info("Changed"),await this.transport.disconnect(),await this._sleep(50),await this.transport.connect(this.baudrate);try{await this.transport.rawRead(500)}catch(r){this.debug(r.message)}}async main_fn(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.detect_chip(r);let m=await this.chip.get_chip_description(this);return this.info("Chip is "+m),this.info("Features: "+await this.chip.get_chip_features(this)),this.info("Crystal is "+await this.chip.get_crystal_freq(this)+"MHz"),this.info("MAC: "+await this.chip.read_mac(this)),await this.chip.read_mac(this),void 0!==this.chip._post_connect&&await this.chip._post_connect(this),await this.run_stub(),this.rom_baudrate!==this.baudrate&&await this.change_baud(),m}parse_flash_size_arg(r){if(void 0===this.chip.FLASH_SIZES[r])throw new u("Flash size "+r+" is not supported by this chip type. Supported sizes: "+this.chip.FLASH_SIZES);return this.chip.FLASH_SIZES[r]}_update_image_flash_params(r,m,h,u,f){if(this.debug("_update_image_flash_params "+h+" "+u+" "+f),r.length<8||m!=this.chip.BOOTLOADER_FLASH_OFFSET)return r;if("keep"===h&&"keep"===u&&"keep"===f)return this.info("Not changing the image"),r;let g=parseInt(r[0]),y=parseInt(r[2]),w=parseInt(r[3]);if(g!==this.ESP_IMAGE_MAGIC)return this.info("Warning: Image file at 0x"+m.toString(16)+" doesn't look like an image file, so not changing any flash settings."),r;if("keep"!==u){let r={qio:0,qout:1,dio:2,dout:3};y=r[u]}let S=15&w;if("keep"!==f){let r={"40m":0,"26m":1,"20m":2,"80m":15};S=r[f]}let I=240&w;"keep"!==h&&(I=this.parse_flash_size_arg(h));let E=y<<8|S+I;return this.info("Flash params set to "+E.toString(16)),parseInt(r[2])!==y<<8&&(r=r.substring(0,2)+(y<<8).toString()+r.substring(3)),parseInt(r[3])!==S+I&&(r=r.substring(0,3)+(S+I).toString()+r.substring(4)),r}async write_flash(r){let m,h,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keep",y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"keep",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keep",S=arguments.length>4&&void 0!==arguments[4]&&arguments[4],I=!(arguments.length>5)||void 0===arguments[5]||arguments[5],E=arguments.length>6?arguments[6]:void 0,P=arguments.length>7?arguments[7]:void 0;if(this.debug("EspLoader program"),"keep"!==g){let m=this.flash_size_bytes(g);for(let h=0;h<r.length;h++)if(r[h].data.length+r[h].address>m)throw new u("File ".concat(h+1," doesn't fit in the available flash"))}!0===this.IS_STUB&&!0===S&&await this.erase_flash();for(let S=0;S<r.length;S++){let A;this.debug("Data Length "+r[S].data.length),m=r[S].data;let T=r[S].data.length%4;if(T>0&&(m+="\xff\xff\xff\xff".substring(4-T)),h=r[S].address,this.debug("Image Length "+m.length),0===m.length){this.debug("Warning: File is empty");continue}m=this._update_image_flash_params(m,h,g,y,w);let C=null;P&&(C=P(m),this.debug("Image MD5 "+C));let D=m.length;if(I){let r=this.bstrToUi8(m);m=this.ui8ToBstr((0,f.deflate)(r,{level:9})),A=await this.flash_defl_begin(D,m.length,h)}else A=await this.flash_begin(D,h);let O=0,N=0,R=m.length;E&&E(S,0,R);let F=new Date,M=F.getTime(),L=5e3,q=new f.Inflate({chunkSize:1}),G=0;for(q.onData=function(r){G+=r.byteLength};m.length>0;){this.debug("Write loop "+h+" "+O+" "+A),this.info("Writing at 0x"+(h+G).toString(16)+"... ("+Math.floor(100*(O+1)/A)+"%)");let r=this.bstrToUi8(m.slice(0,this.FLASH_WRITE_SIZE));if(I){let m=G;q.push(r,!1);let h=G-m,u=3e3;this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)>3e3&&(u=this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)),!1===this.IS_STUB&&(L=u),await this.flash_defl_block(r,O,L),this.IS_STUB&&(L=u)}else throw new u("Yet to handle Non Compressed writes");N+=r.length,m=m.slice(this.FLASH_WRITE_SIZE,m.length),O++,E&&E(S,N,R)}this.IS_STUB&&await this.read_reg(this.CHIP_DETECT_MAGIC_REG_ADDR,L),F=new Date;let z=F.getTime()-M;if(I&&this.info("Wrote "+D+" bytes ("+N+" compressed) at 0x"+h.toString(16)+" in "+z/1e3+" seconds."),C){let r=await this.flash_md5sum(h,D);if(new String(r).valueOf()!=new String(C).valueOf())throw this.info("File  md5: "+C),this.info("Flash md5: "+r),new u("MD5 of file does not match data in flash!");this.info("Hash of data verified.")}}this.info("Leaving..."),this.IS_STUB&&(await this.flash_begin(0,0),I?await this.flash_defl_finish():await this.flash_finish())}async flash_id(){this.debug("flash_id");let r=await this.read_flash_id();this.info("Manufacturer: "+(255&r).toString(16));let m=r>>16&255;this.info("Device: "+(r>>8&255).toString(16)+m.toString(16)),this.info("Detected flash size: "+this.DETECTED_FLASH_SIZES[m])}async hard_reset(){await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)}async soft_reset(){if(this.IS_STUB){if("ESP8266"!=this.chip.CHIP_NAME)throw new u("Soft resetting is currently only supported on ESP8266");await this.command(this.ESP_RUN_USER_CODE,void 0,void 0,!1)}else await this.flash_begin(0,0),await this.flash_finish(!1)}constructor(r,m,h,u=115200,f=!1){this.transport=r,this.baudrate=m,this.terminal=h,this.rom_baudrate=u,this.debugLogging=f,this.ESP_RAM_BLOCK=6144,this.ESP_FLASH_BEGIN=2,this.ESP_FLASH_DATA=3,this.ESP_FLASH_END=4,this.ESP_MEM_BEGIN=5,this.ESP_MEM_END=6,this.ESP_MEM_DATA=7,this.ESP_WRITE_REG=9,this.ESP_READ_REG=10,this.ESP_SPI_ATTACH=13,this.ESP_CHANGE_BAUDRATE=15,this.ESP_FLASH_DEFL_BEGIN=16,this.ESP_FLASH_DEFL_DATA=17,this.ESP_FLASH_DEFL_END=18,this.ESP_SPI_FLASH_MD5=19,this.ESP_ERASE_FLASH=208,this.ESP_ERASE_REGION=209,this.ESP_RUN_USER_CODE=211,this.ESP_IMAGE_MAGIC=233,this.ESP_CHECKSUM_MAGIC=239,this.ROM_INVALID_RECV_MSG=5,this.ERASE_REGION_TIMEOUT_PER_MB=3e4,this.ERASE_WRITE_TIMEOUT_PER_MB=4e4,this.MD5_TIMEOUT_PER_MB=8e3,this.CHIP_ERASE_TIMEOUT=12e4,this.MAX_TIMEOUT=2*this.CHIP_ERASE_TIMEOUT,this.CHIP_DETECT_MAGIC_REG_ADDR=1073745920,this.DETECTED_FLASH_SIZES={18:"256KB",19:"512KB",20:"1MB",21:"2MB",22:"4MB",23:"8MB",24:"16MB"},this.USB_JTAG_SERIAL_PID=4097,this.checksum=function(r){let m;let h=239;for(m=0;m<r.length;m++)h^=r[m];return h},this.timeout_per_mb=function(r,m){let h=r*(m/1e6);return h<3e3?3e3:h},this.flash_size_bytes=function(r){let m=-1;return -1!==r.indexOf("KB")?m=1024*parseInt(r.slice(0,r.indexOf("KB"))):-1!==r.indexOf("MB")&&(m=1048576*parseInt(r.slice(0,r.indexOf("MB")))),m},this.IS_STUB=!1,this.FLASH_WRITE_SIZE=16384,this.terminal&&this.terminal.clean(),this.info("esptool.js"),this.info("Serial port "+this.transport.get_info())}}},3089:function(r,m,h){"use strict";h.d(m,{J:function(){return u}});class u{get_info(){let r=this.device.getInfo();return r.usbVendorId&&r.usbProductId?"WebSerial VendorID 0x".concat(r.usbVendorId.toString(16)," ProductID 0x").concat(r.usbProductId.toString(16)):""}get_pid(){return this.device.getInfo().usbProductId}slip_writer(r){let m=0,h=0,u=0;for(h=0;h<r.length;h++)(192===r[h]||219===r[h])&&m++;let f=new Uint8Array(2+m+r.length);for(h=0,f[0]=192,u=1;h<r.length;h++,u++){if(192===r[h]){f[u++]=219,f[u]=220;continue}if(219===r[h]){f[u++]=219,f[u]=221;continue}f[u]=r[h]}return f[u]=192,f}async write(r){let m=this.slip_writer(r);if(this.device.writable){let r=this.device.writable.getWriter();await r.write(m),r.releaseLock()}}_appendBuffer(r,m){let h=new Uint8Array(r.byteLength+m.byteLength);return h.set(new Uint8Array(r),0),h.set(new Uint8Array(m),r.byteLength),h.buffer}slip_reader(r){let m=0,h=0,u=0,f="init";for(;m<r.length;){if("init"===f&&192==r[m]){h=m+1,f="valid_data",m++;continue}if("valid_data"===f&&192==r[m]){u=m-1,f="packet_complete";break}m++}if("packet_complete"!==f)return this.left_over=r,new Uint8Array(0);this.left_over=r.slice(u+2);let g=new Uint8Array(u-h+1),y=0;for(m=h;m<=u;m++,y++){if(219===r[m]&&220===r[m+1]){g[y]=192,m++;continue}if(219===r[m]&&221===r[m+1]){g[y]=219,m++;continue}g[y]=r[m]}let w=g.slice(0,y);return w}async read(){let r,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,u=this.left_over;if(this.left_over=new Uint8Array(0),this.slip_reader_enabled){let r=this.slip_reader(u);if(r.length>0)return r;u=this.left_over,this.left_over=new Uint8Array(0)}if(null==this.device.readable)return this.left_over;let f=this.device.readable.getReader();try{m>0&&(r=setTimeout(function(){f.cancel()},m));do{let{value:r,done:m}=await f.read();if(m)throw this.left_over=u,Error("Timeout");let h=new Uint8Array(this._appendBuffer(u.buffer,r.buffer));u=h}while(u.length<h)}finally{m>0&&clearTimeout(r),f.releaseLock()}return this.slip_reader_enabled?this.slip_reader(u):u}async rawRead(){let r,m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0!=this.left_over.length){let r=this.left_over;return this.left_over=new Uint8Array(0),r}if(!this.device.readable)return this.left_over;let h=this.device.readable.getReader();try{m>0&&(r=setTimeout(function(){h.cancel()},m));let{value:u,done:f}=await h.read();if(f)throw Error("Timeout");return u}finally{m>0&&clearTimeout(r),h.releaseLock()}}async setRTS(r){await this.device.setSignals({requestToSend:r}),await this.setDTR(this._DTR_state)}async setDTR(r){this._DTR_state=r,await this.device.setSignals({dataTerminalReady:r})}async connect(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:115200;await this.device.open({baudRate:r}),this.baudrate=r,this.left_over=new Uint8Array(0)}async sleep(r){return new Promise(m=>setTimeout(m,r))}async waitForUnlock(r){for(;this.device.readable&&this.device.readable.locked||this.device.writable&&this.device.writable.locked;)await this.sleep(r)}async disconnect(){await this.waitForUnlock(400),await this.device.close()}constructor(r){this.device=r,this.slip_reader_enabled=!1,this.left_over=new Uint8Array(0),this.baudrate=0,this._DTR_state=!1}}},4400:function(r,m,h){"use strict";h.d(m,{Z:function(){return eF}});class u{attach(r,m){let h=[{name:this.type,config:{ssid:this.ssid,password:this.password,power_save_mode:this.power_save_mode}}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}constructor(r,m,h){this.ssid=r,this.password=m,this.power_save_mode=h,this.type="wifi"}}function f(r,m,h){return new u(r,m,h)}class g{attach(r,m){this.topic_prefix="devices/"+m.esphome.name;let h=[{name:this.type,config:{broker:this.broker,topic_prefix:this.topic_prefix},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?m[r.name]={...m[r.name],...r.config}:m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,config:{prefix:this.topic_prefix,frontendEndpoint:"/ws",brokerUrl:this.broker},actions:[],monitors:[{name:"Device status",description:"Gets the status of the mqtt connection",endpoint:"/status",connectionType:"mqtt"}]}}constructor(r){this.broker=r,this.name=this.type="mqtt"}}function y(r){return new g(r)}class w{extractNestedComponents(r,m){let h=[{key:"mqtt",nestedKey:"on_message"},{key:"esphome",nestedKey:"on_boot"}];h.forEach(h=>{let{key:u,nestedKey:f}=h;r.config[f]&&(m[u]||(m[u]={}),m[u][f]||(m[u][f]=[]),Array.isArray(m[u][f])?m[u][f].push(...r.config[f]):m[u][f]={...m[u][f],...r.config[f]})})}exctractComponent(r,m){["mqtt","esphome"].includes(r.name)?this.extractNestedComponents(r,m):m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name].push(r.config)):m[r.name]=r.config}attach(r,m,h){var u,f,g,y;let w=[{name:"deep_sleep",config:{id:"ds",sleep_duration:this.sleep_duration+"s",wakeup_pin:this.wakeup_pin,wakeup_pin_mode:"KEEP_AWAKE"}}],S=[{name:"globals",config:{id:"dp_run_duration",type:"int",restore_value:"yes",initial_value:this.run_duration}},{name:"globals",config:{id:"dp_sleep_duration",type:"int",restore_value:"yes",initial_value:this.sleep_duration}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(u=m.mqtt)||void 0===u?void 0:u.topic_prefix)!==""?(null===(f=m.mqtt)||void 0===f?void 0:f.topic_prefix)+"/"+m.esphome.name:m.esphome.name,"/deep_sleep/dp_sleep_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value == 0) {\n  id(ds).prevent_deep_sleep();\n  ESP_LOGD("Deep Sleep", "Deep Sleep disabled");\n} else if (value > 0) {\n  id(ds).allow_deep_sleep();\n  id(dp_sleep_duration) = value;\n  id(ds).set_sleep_duration(value * 1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep sleep duration set to: %d", value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to: %d", id(dp_run_duration));\n} else {\n  ESP_LOGD("Deep Sleep", "Invalid sleep duration value");\n}'}}]}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(g=m.mqtt)||void 0===g?void 0:g.topic_prefix)!==""?(null===(y=m.mqtt)||void 0===y?void 0:y.topic_prefix)+"/"+m.esphome.name:m.esphome.name,"/deep_sleep/dp_run_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value > 0){\n  id(dp_run_duration) = value;\n  id(ds).set_run_duration(value*1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep run duration set to: %d",  value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to: %d",  id(dp_run_duration));       \n} else {\n  ESP_LOGD("Deep Sleep", "Invalid run duration value");\n}'}}]}},{name:"esphome",config:{on_boot:[{priority:600,then:{lambda:'ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to at boot: %d",  id(dp_run_duration));\nid(ds).set_run_duration(id(dp_run_duration)*1000);\nESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to at boot: %d",  id(dp_sleep_duration));\nid(ds).set_sleep_duration(id(dp_sleep_duration)*1000);'}}]}}];return w.forEach((r,h)=>{this.exctractComponent(r,m)}),h.filter(r=>null!==r).map(r=>r.constructor.name).includes("Mqtt")&&S.forEach((r,h)=>{this.exctractComponent(r,m)}),m}constructor(r,m,h,u){this.run_duration=r,this.sleep_duration=m,this.wakeup_pin=h,this.mqttTopicPrefix=""}}function S(r,m,h,u){return new w(r,m,h,u)}class I{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,filters:[{delayed_off:"100ms"},{delayed_on:"100ms"}]},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Button status",description:"Get binary sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m){this.name=r,this.platform=m,this.type="binary_sensor"}}function E(r){return new I(r,"gpio")}let P=h(49431);class A{createComponentsTree(r,m){var h,u={esphome:{name:r},[m.board.core]:m.config.sdkConfig,logger:{}};null===(h=this.components)||void 0===h||h.forEach((r,m)=>{console.log("\uD83D\uDE80 ~ file: Device.ts:62 ~ Device ~ this.components?.forEach ~ component:",r),r&&(u=r.attach(isNaN(parseInt(this.pinTable[m]))?this.pinTable[m]:parseInt(this.pinTable[m]),u,this.components))}),this.componentsTree=u}createSubsystemsTree(r,m){var h;this.subsystemsTree=[],null===(h=this.components)||void 0===h||h.forEach(r=>{if(r)try{this.subsystemsTree.push(r.getSubsystem())}catch(r){}})}getComponentsTree(r,m){let h=m.board.ports;return this.pinTable=[],h.forEach(r=>{["3V3","EN","36","39","CLK"].includes(r.name)||this.pinTable.push(r.name)}),this.createComponentsTree(r,m),this.componentsTree}getSubsystemsTree(r,m){return this.createSubsystemsTree(r,m),this.subsystemsTree}dump(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"yaml";return"yaml"==r?P.dump(this.componentsTree,{lineWidth:-1}):void 0}constructor(r){this.pinTable=[],this.components=r.slice(2),this.componentsTree={},this.subsystemsTree=[]}}function T(r){return new A(r)}class C{attach(r,m){var h=!1;this.effects.forEach(r=>{!0===r&&(h=!0)});let u=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,variant:this.chipset,num_leds:this.numLeds,type:this.rgb_order,method:{type:"esp32_rmt",channel:this.channel},restore_mode:this.restoreMode,default_transition_length:this.defaultTransitionLength},subsystem:this.getSubsystem()}];if(u.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),!h)return m;{let r=[];return this.effects[0]&&(r=r.concat([{pulse:null},{pulse:{name:"Fast Pulse",transition_length:"0.5s",update_interval:"0.5s"}},{pulse:{name:"Slow Pulse",update_interval:"2s"}}])),this.effects[1]&&(r=r.concat([{random:null},{random:{name:"My Slow Random Effect",transition_length:"30s",update_interval:"30s"}},{random:{name:"My Fast Random Effect",transition_length:"4s",update_interval:"5s"}}])),this.effects[2]&&(r=r.concat([{strobe:null},{strobe:{name:"Strobe Effect With Custom Values",colors:[{state:!0,brightness:"100%",red:"100%",green:"0%",blue:"0%",duration:"500ms"},{state:!1,duration:"250ms"},{state:!0,brightness:"100%",red:"0%",green:"100%",blue:"0%",duration:"500ms"}]}}])),this.effects[3]&&(r=r.concat([{flicker:null},{flicker:{name:"Flicker Effect With Custom Values",alpha:"95%",intensity:"1.5%"}}])),this.effects[4]&&(r=r.concat([{addressable_rainbow:null},{addressable_rainbow:{name:"Rainbow Effect With Custom Values",speed:10,width:50}}])),this.effects[5]&&(r=r.concat([{addressable_color_wipe:null},{addressable_color_wipe:{name:"Color Wipe Effect With Custom Values",add_led_interval:"100ms",reverse:!1,colors:[{red:"100%",green:"100%",blue:"100%",num_leds:1},{red:"0%",green:"0%",blue:"0%",num_leds:1}]}}])),this.effects[6]&&(r=r.concat([{addressable_scan:null},{addressable_scan:{name:"Scan Effect With Custom Values",move_interval:"100ms",scan_width:1}}])),this.effects[7]&&(r=r.concat([{addressable_twinkle:null},{addressable_twinkle:{name:"Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"4ms"}}])),this.effects[8]&&(r=r.concat([{addressable_random_twinkle:null},{addressable_random_twinkle:{name:"Random Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"32ms"}}])),this.effects[9]&&(r=r.concat([{addressable_fireworks:null},{addressable_fireworks:{name:"Fireworks Effect With Custom Values",update_interval:"32ms",spark_probability:"10%",use_random_color:!1,fade_out_rate:120}}])),this.effects[10]&&(r=r.concat([{addressable_flicker:null},{addressable_flicker:{name:"Adressable flicker Effect With Custom Values",update_interval:"16ms",intensity:"5%"}}])),u[0].config.effects=r,m}}getSubsystem(){return{name:this.name,type:this.type,actions:[{name:"Turn on",description:"Turns on the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:0,b:0},effect:"none",brightness:255}}},{name:"Turn off",description:"Turns off the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"OFF",color:{r:0,g:0,b:0},effect:"none",brightness:255}}},{name:"Toggle",description:"Turn on an effect on the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:255,b:255},effect:"pulse",brightness:255}}}]}}constructor(r,m,h,u,f,g,y,w,S,I,E,P,A,T,C,D,O,N,R){this.effects=[],this.name=r,this.type="light",this.platform=m,this.rgb_order=u,this.chipset=f,this.numLeds=h,this.restoreMode=g,this.defaultTransitionLength=y,this.channel=w,this.effects=[S,I,E,P,A,T,C,D,O,,N,R],this.mqttMsgs={state:"ON",color:{r:255,g:0,b:0},effect:"My Slow Random Effect",brightness:255}}}function D(r,m,h,u,f,g,y,w,S,I,E,P,A,T,D,O,N){return new C(r,"neopixelbus",m,h,u,f,g,y,w,S,I,E,P,A,T,D,O,N)}class O{attach(r){return{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n")}}constructor(r,m){this.name=r,this.platform=m}}function N(r){return new O(r,"gpio")}class R{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,restore_mode:this.restoreMode},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,config:{restoreMode:"ON"},actions:[{name:"Turn on",description:"turns on the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"ON"}},{name:"Turn off",description:"turns off the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"OFF"}},{name:"Toggle",description:"Toggles the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"TOGGLE"}}]}}constructor(r,m,h){this.name=r,this.platform=m,this.restoreMode=h,this.type="switch"}}function F(r,m){return new R(r,"gpio",m)}class M{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,pin:r,name:this.name,id:this.name,update_interval:this.updateInterval,attenuation:this.attenuation},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Get status",description:"Get sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(r,m,h,u){this.name=r,this.platform=m,this.type="sensor",this.updateInterval=h,this.attenuation=u||"auto"}}function L(r,m,h){return new M(r,"adc",m,h)}class q{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n")}}constructor(r,m){this.name=r,this.platform=m}}function G(r){return new q(r,"pulse_counter")}class z{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_json_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n      - lambda: |-\n          if (x.containsKey("pwmLevel"))  {\n            id(').concat(this.name,').set_level((float)x["pwmLevel"]);\n          }\n')},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      frequency: ").concat(this.frequency,"\n")}]}constructor(r,m,h){this.name=r,this.platform=m,this.frequency=h,this.mqttTopicPrefix=""}}function U(r,m){return new z(r,"ledc",m)}class B{attach(r){return{componentName:"binary_sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      device_class: motion\n")}}constructor(r,m){this.name=r,this.platform=m}}function H(r){return new B(r,"gpio")}class Z{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      dout_pin: ").concat(r,"\n      clk_pin: ").concat(this.clkPin,"\n      gain: ").concat(this.gain,"\n      update_interval: ").concat(this.updateInterval,"\n")}}constructor(r,m,h,u,f){this.name=r,this.platform=m,this.clkPin=h,this.updateInterval=f,this.gain=u}}function V(r,m,h,u){return new Z(r,"hx711",m,h,u)}class ${attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(r,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      update_interval: ").concat(this.updateInterval,"\n      attenuation: ").concat(this.attenuation,"\n")}}constructor(r,m,h){this.name=r,this.platform=m,this.updateInterval=h,this.attenuation="11db"}}function W(r,m){return new $(r,"adc",m)}class K{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"".concat(this.platform,"_i2c"),payload:"    update_interval: 1s\n    id: noconflict_".concat(this.name,"\n    i2c_id: ").concat(this.i2cBusId,"\n    on_tag:\n        then:\n            - mqtt.publish:\n                topic: ").concat(this.mqttTopicPrefix,"/").concat(this.platform,"_i2c/").concat(this.name,"/state\n                payload: !lambda 'return x;'\n    on_tag_removed:\n        then:\n            - mqtt.publish:\n                topic: ").concat(this.mqttTopicPrefix,"/").concat(this.platform,"_i2c/").concat(this.name,"/state\n                payload: !lambda 'return \"not:\"+x;'\n")},{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")}]}constructor(r,m,h,u){this.name=r,this.platform=m,this.i2cBusId=h,this.sclPin=u,this.mqttTopicPrefix=""}}function X(r,m){return new K(r,"pn532","bus_a",m)}class J{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      trigger_pin: ").concat(r,"\n      echo_pin: ").concat(this.echoPin,"\n      update_interval: ").concat(this.updateInterval,"\n      timeout : ").concat(this.timeout,"\n")}}constructor(r,m,h,u,f){this.name=r,this.platform=m,this.echoPin=h,this.updateInterval=u,this.timeout=f}}function Y(r,m,h,u){return new J(r,"ultrasonic",m,h,u)}class Q{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n        - lambda: |-\n            if (x=="ON")  {\n              id(').concat(this.name,").turn_on();\n            }else{\n              id(").concat(this.name,").turn_off();\n            }\n  ")},{componentName:"i2c",payload:"   sda: 21\n   scl: 22\n   scan: true\n   id: bus_a\n\n"},{componentName:this.platform,payload:"    - id: pca9685_hub1\n      frequency: 100\n\n"},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      channel: 11\n      id: ").concat(this.name,"\n      pca9685_id: 'pca9685_hub1'\n\n")}]}constructor(r,m){this.name=r,this.platform=m,this.mqttTopicPrefix=""}}function ee(r){return new Q(r,"pca9685")}class et{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{name:"on_json_message",config:{topic:"".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command"),then:{lambda:'if (x.containsKey("file2Play")){\n    id('.concat(this.platform,'file) = (int) x["file2Play"];\n    for(int i = 0; i<10 && !id(').concat(this.name,"busypin).state; i++){\n      id(").concat(this.name,').play_file((int) x["file2Play"]);\n    }\n}\nif(x.containsKey("volume")){\n    id(').concat(this.platform,'vol) = (int) x["volume"];\n    id(').concat(this.name,').set_volume((int) x["volume"]);\n}')}}},{name:"globals",config:{id:"".concat(this.platform,"file"),type:"int",restore_value:"no",initial_value:"0"}},{name:"globals",config:{id:"".concat(this.platform,"vol"),type:"int",restore_value:"no",initial_value:"30"}},{name:"uart",config:{id:"".concat(this.platform,"dfplayer"),tx_pin:r,rx_pin:this.rxPin,baud_rate:9600}},{name:this.platform,config:{uart_id:"".concat(this.platform,"dfplayer"),id:this.name,on_finished_playback:{then:{"logger.log":"Somebody press play!"}}},subsystem:{action:[{name:"Set Volume",description:"Sets de mp3 volume",endpoint:"/command",connectionType:"mqtt",payload:{type:"json",json:{volume:{type:"int",min:0,max:30}}}},{name:"Play file",description:"Plays the specified file",endpoint:"/command",connectionType:"mqtt",value:{type:"json",json:{file2Play:{type:"int",min:0,max:void 0}}}}]}},{name:"binary_sensor",config:{platform:"gpio",pin:this.busyPin,name:"".concat(this.name,"busypin"),id:"".concat(this.name,"busypin"),filters:[{invert:null},{delayed_off:"100ms"},{delayed_on:"100ms"}]}}]}constructor(r,m,h,u){this.name=r,this.platform=m,this.rxPin=h,this.busyPin=u,this.mqttTopicPrefix=""}}function en(r,m,h){return new et(r,"dfplayer",m,h)}class ei{getWifiPowerMode(){return"light"}attach(r){return[{componentName:"esp32_ble_tracker",payload:"   scan_parameters:\n        interval: 320ms # try with 300ms if you don't have LAN module\n        window: 30ms # try with 300ms if you don't have LAN module\n        continuous: true\n        active: false\n"},{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      mac_address: '").concat(this.macAddress,"'\n      id: ").concat(this.id,'\n      temperature:\n          name: "').concat(this.id,'temperature"\n   \n      moisture:\n          name: "').concat(this.id,'moisture"\n\n      illuminance:\n          name: "').concat(this.id,'illuminance"\n\n      conductivity:\n          name: "').concat(this.id,'soilconductivity"\n\n      battery_level:\n          name: "').concat(this.id,'batterylevel"\n')}]}constructor(r,m,h){this.id=r,this.platform=m,this.macAddress=h}}function ea(r,m){return new ei(r,"xiaomi_hhccjcy01",m)}class es{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"remote_transmitter",payload:"   pin: ".concat(r,"\n   carrier_duty_percent: 50%\n\n")},{componentName:"climate",payload:"  - platform: ".concat(this.platform,'\n    name: "').concat(this.name,'"\n    id: ').concat(this.name,"\n    protocol: ").concat(this.protocol,"\n    horizontal_default: ").concat(this.horizontal_default,"\n    vertical_default: ").concat(this.verical_default,"\n    max_temperature: ").concat(this.max_temperature,"\n    min_temperature: ").concat(this.min_temperature,"\n\n")}]}constructor(r,m,h,u,f,g,y){this.name=r,this.platform=m,this.protocol=h,this.horizontal_default=u,this.verical_default=f,this.max_temperature=g,this.min_temperature=y,this.mqttTopicPrefix=""}}function er(r,m,h,u,f,g){return new es(r,"heatpumpir",m,h,u,f,g)}class eo{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command\n      then:\n      - lambda: |-\n         float value = atoi(x.c_str());\n         if(value >= 0 && value <= 180) id(").concat(this.name,").write(value/180);\n         if(value > 180) id(").concat(this.name,").write(180);\n         if(value < 0) id(").concat(this.name,").write(0);\n")},{componentName:"output",payload:"  - platform: ledc\n    pin: ".concat(r,"\n    id: ").concat(this.name,"ledcOutput\n    frequency: 50 Hz\n")},{componentName:"servo",payload:"  - id: ".concat(this.name,"\n    output: ").concat(this.name,"ledcOutput\n    auto_detach_time: 0s\n    transition_length: 0s\n")}]}constructor(r,m){this.name=r,this.platform=m,this.mqttTopicPrefix=""}}function el(r){return new eo(r,"servo")}class ec{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"".concat(this.platform),payload:"    id: ".concat(this.name,"\n    address: 0x5A\n    touch_debounce: 1\n    release_debounce: 1\n    touch_threshold: 10\n    release_threshold: 7\n")},...this.channels.map((r,m)=>r?{componentName:"binary_sensor",payload:"    - platform: mpr121\n      id: ".concat(this.name+"_"+m,"\n      channel: ").concat(m,"\n      name:  ").concat(this.name+"_"+m,"\n      touch_threshold: 12\n      release_threshold: 6\n")}:null).filter(Boolean)]}constructor(r,m,h,u,f,g,y,w,S,I,E,P,A,T,C,D){this.channels=[],this.name=r,this.platform=m,this.i2cBusId=h,this.sclPin=u,this.mqttTopicPrefix="",this.channels=[f,g,y,w,S,I,E,P,A,T,C,D]}}function ed(r,m,h,u,f,g,y,w,S,I,E,P,A,T){return new ec(r,"mpr121","bus_a",m,h,u,f,g,y,w,S,I,E,P,A,T)}class em{attach(r){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      pin: ").concat(r,"\n      model: ").concat(this.model,"\n      update_interval: ").concat(this.updateInterval,"\n      temperature:\n        name: ").concat(this.name,"temp\n      humidity:\n        name: ").concat(this.name,"hum\n")}}constructor(r,m,h,u){this.name=r,this.platform=m,this.model=h,this.updateInterval=u}}function eh(r,m,h){return new em(r,"dht",m,h)}class ep{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}setDeepSleep(r){this.dpEnabled=r}attach(r){var m=[{name:"uart",config:{id:"".concat(this.name,"uartmodbus"),tx_pin:r,rx_pin:this.rxPin,baud_rate:19200,stop_bits:2}},{name:this.platform,config:{id:"".concat(this.name,"modbusid"),uart_id:"".concat(this.name,"uartmodbus")}},{name:"modbus_controller",config:{id:"".concat(this.name,"modbuscontrollerid"),address:1,modbus_id:"".concat(this.name,"modbusid"),setup_priority:-10,update_interval:this.updateInterval}},{name:"sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"load"),name:"".concat(this.name,"load"),unit_of_measurement:"Kg",address:parseInt(this.weightRegister),register_type:"holding",value_type:2==this.weightRegisters2Read?"U_DWORD":"U_WORD",register_count:parseInt(this.weightRegisters2Read)}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags0"),name:"".concat(this.name,"stateflags0"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:0}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags3"),name:"".concat(this.name,"stateflags3"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:3}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags4"),name:"".concat(this.name,"stateflags4"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:16}}];let h=[{name:"switch",config:{platform:"gpio",pin:this.enablePin,id:"".concat(this.name,"enablepin"),name:"".concat(this.name,"enablepin")}},{name:"on_boot",config:{priority:100,then:[{"switch.turn_on":"".concat(this.name,"enablepin")},{wait_until:{condition:{"mqtt.connected":null}}},{"component.update":"".concat(this.name,"modbuscontrollerid")},{delay:"1s"},{"deep_sleep.enter":"ds"}]}},{name:"on_shutdown",config:{priority:700,then:[{"switch.turn_off":"".concat(this.name,"enablepin")}]}}];return this.dpEnabled&&(m=m.concat(h)),m}constructor(r,m,h,u,f,g,y,w){this.name=r,this.platform=m,this.rxPin=h,this.enablePin=u,this.updateInterval=f,this.weightRegister=g,this.weightRegisters2Read=y,this.stateFlagsRegister=w,this.mqttTopicPrefix="",this.dpEnabled=!1}}function e_(r,m,h,u,f,g,y){return new ep(r,"modbus",m,h,u,f,g,y)}class eu{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n")}]}constructor(r,m,h,u,f,g){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=f,this.sclPin=g,this.mqttTopicPrefix=""}}function ef(r,m,h,u){return new eu(r,"bh1750",h,u,"bus_a",m)}class eg{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-aqi"\n        calculation_type: "CAQI"\n')}]}constructor(r,m,h,u,f,g){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=f,this.sclPin=g,this.mqttTopicPrefix=""}}function eb(r,m,h,u){return new eg(r,"hm3301",h,u,"bus_a",m)}class ex{getPlatform(){return this.platform}setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-ethanol\n      methane:\n        name: ").concat(this.name,"-methane\n      ammonia:\n        name: ").concat(this.name,"-ammonia\n")}]}constructor(r,m,h,u,f,g){this.name=r,this.platform=m,this.address=h,this.updateInterval=u,this.i2cBusId=f,this.sclPin=g,this.mqttTopicPrefix=""}}function ey(r,m,h,u){return new ex(r,"mics_4514",h,u,"bus_a",m)}class ev{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,address:this.address,update_interval:this.updateInterval,accel_x:{name:"".concat(this.name,"-accel-x")},accel_y:{name:"".concat(this.name,"-accel-y")},accel_z:{name:"".concat(this.name,"-accel-z")},gyro_x:{name:"".concat(this.name,"-gyro-x")},gyro_y:{name:"".concat(this.name,"-gyro-y")},gyro_z:{name:"".concat(this.name,"-gyro-z")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Accelerometer X",description:"Get accelerometer X axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-x/state",connectionType:"mqtt"},{name:"Accelerometer Y",description:"Get accelerometer Y axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-y/state",connectionType:"mqtt"},{name:"Accelerometer Z",description:"Get accelerometer Z axis status",units:"m/s\xb2",endpoint:"/sensor/"+this.name+"-accel-z/state",connectionType:"mqtt"},{name:"Gyroscope X",description:"Get gyroscope X axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-x/state",connectionType:"mqtt"},{name:"Gyroscope Y",description:"Get gyroscope Y axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-y/state",connectionType:"mqtt"},{name:"Gyroscope Z",description:"Get gyroscope Z axis status",units:"\xb0/s",endpoint:"/sensor/"+this.name+"-gyro-z/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,f){this.type="sensor",this.name=r,this.platform=m,this.address=u,this.updateInterval=f,this.i2cBusId=h}}function ew(r,m,h,u){return new ev(r,"mpu6050",m,h,u)}class eS{setMqttTopicPrefix(r){this.mqttTopicPrefix=r}attach(r){return[{componentName:"i2c",payload:"    sda: ".concat(r,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: bh1750\n      id: ".concat(this.name,"bh1750\n      name: ").concat(this.name,"bh1750\n      address: ").concat(this.bh1750Address,"\n      update_interval: ").concat(this.updateInterval,"\n")},{componentName:"sensor",payload:"    - platform: hm3301 \n      id: ".concat(this.name,"hm3301\n      address: ").concat(this.hm3301Address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-hm3301-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-hm3301-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-hm3301-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-hm3301-aqi"\n        calculation_type: "CAQI"\n')},{componentName:"sensor",payload:"    - platform: mics_4514 \n      id: ".concat(this.name,"sen0377\n      address: ").concat(this.sen0377Address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-sen0377-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-sen0377-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-sen0377-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-sen0377-ethanol\n      methane:\n        name: ").concat(this.name,"-sen0377-methane\n      ammonia:\n        name: ").concat(this.name,"-sen0377-ammonia\n")},,{componentName:"sensor",payload:"    - platform: mpu6050\n      id: ".concat(this.name,"mpu6050\n      address: ").concat(this.mpu6050Address,"\n      update_interval: ").concat(this.updateInterval,'\n      accel_x:\n        name: "').concat(this.name,'-mpu6050-accel-x"\n      accel_y:\n        name: "').concat(this.name,'-mpu6050-accel-y"\n      accel_z:\n        name: "').concat(this.name,'-mpu6050-accel-z"\n      gyro_x:\n        name: "').concat(this.name,'-mpu6050-gyro-x"\n      gyro_y:\n        name: "').concat(this.name,'-mpu6050-gyro-y"\n      gyro_z:\n        name: "').concat(this.name,'-mpu6050-gyro-z"\n      temperature:\n        name: "').concat(this.name,'-mpu6050-temperature"\n')}]}constructor(r,m,h,u,f,g,y,w){this.name=r,this.sclPin=m,this.updateInterval=h,this.i2cBusId=u,this.mqttTopicPrefix="",this.bh1750Address=f,this.hm3301Address=g,this.sen0377Address=y,this.mpu6050Address=w}}function eI(r,m,h,u,f,g,y){return new eS(r,m,h,"bus_a",u,f,g,y)}class eE{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,address:this.address,update_interval:this.updateInterval,pm_1_0:{name:"".concat(this.name,"-pm1-0")},pm_2_5:{name:"".concat(this.name,"-pm2-5")},pm_4_0:{name:"".concat(this.name,"-pm4-0")},pm_10_0:{name:"".concat(this.name,"-pm10-0")},temperature:{name:"".concat(this.name,"-temperature")},humidity:{name:"".concat(this.name,"-humidity")},nox:{name:"".concat(this.name,"-nox")},voc:{name:"".concat(this.name,"-voc")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Pm1.0",description:"Get pm1.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm1-0/state",connectionType:"mqtt"},{name:"Pm2.5",description:"Get pm2.5 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm2-5/state",connectionType:"mqtt"},{name:"Pm4.0",description:"Get pm4.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm4-0/state",connectionType:"mqtt"},{name:"Pm10.0",description:"Get pm10.0 status",units:"\xb5g/m\xb3",endpoint:"/sensor/"+this.name+"-pm10-0/state",connectionType:"mqtt"},{name:"Temperature",description:"Get temperature status",units:"\xbaC",endpoint:"/sensor/"+this.name+"-temperature/state",connectionType:"mqtt"},{name:"Humidity",description:"Get humidity status",units:"%",endpoint:"/sensor/"+this.name+"-humidity/state",connectionType:"mqtt"},{name:"NOx",description:"Get NOX status",endpoint:"/sensor/"+this.name+"-nox/state",connectionType:"mqtt"},{name:"VOC",description:"Get VOC status",endpoint:"/sensor/"+this.name+"-voc/state",connectionType:"mqtt"}]}}constructor(r,m,h,u,f){this.type="sensor",this.name=r,this.platform=m,this.address=u,this.updateInterval=f,this.i2cBusId=h}}function ej(r,m,h,u){return new eE(r,"sen5x",m,h,u)}class eP{attach(r,m){let h=[{name:this.type,config:{platform:this.platform,id:this.name,uart_id:this.uartBusId,update_interval:this.updateInterval,co2:{name:"".concat(this.name,"-co2")},temperature:{name:"".concat(this.name,"-temperature")}},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"CO_2",description:"Get CO_2 status",units:"ppm",endpoint:"/"+this.type+"/"+this.name+"-co2/state",connectionType:"mqtt"},{name:"CO_2",description:"Get CO_2 status",units:"\xbaC",endpoint:"/"+this.type+"/"+this.name+"-temperature/state",connectionType:"mqtt"}]}}constructor(r,m,h,u){this.type="sensor",this.name=r,this.platform=m,this.uartBusId=h,this.updateInterval=u,this.mqttTopicPrefix=""}}function eA(r,m,h){return new eP(r,"mhz19",m,h)}class eT{attach(r,m){let h=[{name:this.type,config:{id:this.id,sda:r,scl:this.scl,scan:this.scan},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h){this.type="i2c",this.scl=m,this.scan=h,this.id=r}}function eC(r,m,h){return new eT(r,m,h)}class eD{getOutputComponents(){let r=[];for(var m=0;m<16;m++){let h={name:"output",config:{platform:"pca9685",pca9685_id:this.name,channel:m,id:this.name+"_channel_"+m},subsystem:{}};r.push(h)}return r}attach(r,m){let h=[{name:this.type,config:{id:this.name,...this.external_clock_input?{}:{frequency:this.frequency},external_clock_input:this.external_clock_input,address:this.address,i2c_id:this.i2cBusId},subsystem:this.getSubsystem()}],u=this.getOutputComponents();return(h=h.concat(u)).forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h,u,f){this.type="pca9685",this.name=r,this.frequency=m,this.external_clock_input=h,this.address=u,this.i2cBusId=f}}function eO(r,m,h,u,f){return new eD(r,m,h,u,f)}class ek{attach(r,m){return[{name:"ethernet",config:{type:this.type,mdc_pin:this.mdc_pin,mdio_pin:this.mdio_pin,clk_mode:this.clk_mode,phy_addr:this.phy_addr,power_pin:this.power_pin},subsystem:this.getSubsystem()}].forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h,u,f,g){this.type=r,this.mdc_pin=m,this.mdio_pin=h,this.clk_mode=u,this.phy_addr=f,this.power_pin=g}}function eN(r,m,h,u,f,g){return new ek(r,m,h,u,f,g)}class eR{attach(r,m){let h=[{name:this.type,config:{id:this.id,tx_pin:r,rx_pin:this.rx,baud_rate:this.baudrate},subsystem:this.getSubsystem()}];return h.forEach((r,h)=>{m[r.name]?(Array.isArray(m[r.name])||(m[r.name]=[m[r.name]]),m[r.name]=[...m[r.name],r.config]):m[r.name]=r.config}),m}getSubsystem(){return{}}constructor(r,m,h){this.type="uart",this.rx=m,this.baudrate=h,this.id=r}}var eF={wifi:f,mqtt:y,deepSleep:S,device:T,output:N,binarySensor:E,neopixelsBus:D,relay:F,adcSensor:L,capacitiveSoilMoistureSensor:W,pulseCounter:G,ledcOutput:U,pirSensor:H,hx711:V,nfcReader:X,ultrasonicDistanceSensor:Y,isOutput:ee,dfplayer:en,xiaomiMiFlora:ea,climateIR:er,servo:el,mpr121:ed,tempHumidity:eh,modbusLoadCell:e_,bh1750:ef,hm3301:eb,sen0377:ey,mpu6050:ew,i2cSensorMatrix:eI,sen55:ej,mhz19:eA,i2cBus:eC,pca9685:eO,ethernet:eN,uartBus:function(r,m,h){return new eR(r,m,h)}}},36076:function(r,m,h){"use strict";h.d(m,{I:function(){return u}});let u={name:"ESPHome",version:"2022.12.8",home_assistant_domain:"esphome",funding_url:"https://esphome.io/guides/supporters.html",builds:[{chipFamily:"ESP32",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32/esphome-web-esp32.bin",offset:0}]},{chipFamily:"ESP32-C3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32c3/esphome-web-esp32c3.bin",offset:0}]},{chipFamily:"ESP32-S2",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s2/esphome-web-esp32s2.bin",offset:0}]},{chipFamily:"ESP32-S3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s3/esphome-web-esp32s3.bin",offset:0}]},{chipFamily:"ESP8266",parts:[{path:"https://firmware.esphome.io/esphome-web-esp8266/esphome-web-esp8266.bin",offset:0}]}]}},21621:function(r,m,h){"use strict";var u=h(52322),f=h(39684),g=h(2784),y=h(66306),w=h(8939),S=h(52026),I=h(16247),E=h(79562),P=h(65919),A=h(91838),T=h(1940);let C=(r,m)=>{var h,C;let{client:D}=(0,f.Td)(),O=r=>{"mqtt"==r.connectionType&&D.publish((0,T.Hj)(m,r.endpoint),r.payload.value.toString())},N=null===(h=r.actions)||void 0===h?void 0:h.map(r=>(0,u.jsx)(y.zx,{onPress:()=>{O(r)},color:"$color10",children:r.name},r.name)),R=null===(C=r.monitors)||void 0===C?void 0:C.map(r=>{let[h,y]=(0,g.useState)(""),{message:I}=(0,f.mU)((0,T.Hj)(m,r.endpoint));g.useEffect(()=>{var r;y(null==I?void 0:null===(r=I.message)||void 0===r?void 0:r.toString())},[I]);let P=h?(0,u.jsx)(E.A,{text:"".concat(h," ").concat(r.units?r.units:"")}):null;return(0,u.jsxs)(w.sL,{gap:"$3",children:[(0,u.jsxs)(S.Text,{marginLeft:4,textAlign:"left",children:[r.name,": "]}),P]})});return(0,u.jsx)(P._k,{position:"relative",borderRadius:"10px",mt:"10px",children:(0,u.jsxs)(A.I,{children:[(0,u.jsx)(I.Paragraph,{textAlign:"left",color:"$color10",children:r.name}),(0,u.jsxs)(w.FA,{mb:"10px",mt:"10px",alignSelf:"flex-start",children:[(0,u.jsx)(w.sL,{gap:"$2",children:N}),(0,u.jsx)(w.FA,{alignItems:"left",gap:"$3",children:R})]})]})})};m.Z=C},5436:function(r,m,h){"use strict";h.d(m,{_:function(){return u}});let u=r=>new Promise(m=>setTimeout(m,r))},41234:function(){},31851:function(){},8638:function(){},76649:function(){},1435:function(){},5006:function(){},66286:function(){},18190:function(){},94611:function(){},51185:function(){}},function(r){var m=function(m){return r(r.s=m)};r.O(0,[8641,8081,4733,1335,8873,2859,6313,3950,9331,4092,9927,6116,9498,1967,5619,9884,995,4866,1004,4152,8676,767,1773,8859,9774,2888,179],function(){return m(7179)}),_N_E=r.O()}]);