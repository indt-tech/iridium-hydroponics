(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892],{9312:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return s(14562)}])},14562:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return N}});var r=s(52322),a=s(28044),n=s(30195),o=s(1201),i=s(40214),l=s(85077),d=s(50897),c=s(79562),m=s(1888),u=s(19034),p=s.n(u),h=s(78161),g=s(2784),f=s(73675);let w=e=>{let{color:t="black",size:s=24,...a}=e;return(0,r.jsxs)(f.ny,{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[(0,r.jsx)(f.UL,{width:"20",height:"16",x:"2",y:"4",rx:"2",stroke:`${t}`}),(0,r.jsx)(f.y$,{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",stroke:`${t}`})]})};w.displayName="Mail";let y=(0,g.memo)((0,h.H)(w));var x=s(32627);let b=e=>{let{color:t="black",size:s=24,...a}=e;return(0,r.jsxs)(f.ny,{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[(0,r.jsx)(f.Cd,{cx:"7.5",cy:"15.5",r:"5.5",stroke:`${t}`}),(0,r.jsx)(f.y$,{d:"m21 2-9.6 9.6",stroke:`${t}`}),(0,r.jsx)(f.y$,{d:"m15.5 7.5 3 3L22 7l-3-3",stroke:`${t}`})]})};b.displayName="Key";let v=(0,g.memo)((0,h.H)(b)),k=e=>{let{color:t="black",size:s=24,...a}=e;return(0,r.jsxs)(f.ny,{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[(0,r.jsx)(f.y$,{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",stroke:`${t}`}),(0,r.jsx)(f.Cd,{cx:"12",cy:"7",r:"4",stroke:`${t}`})]})};k.displayName="User";let j=(0,g.memo)((0,h.H)(k));var $=s(48115),L=s(48715),z=s(6289),S=s(26887);let T="YYYY-MM-DD HH:mm:ss",U={username:y,type:x.V,passwod:v,repassword:v},P="/adminapi/v1/accounts",A="/adminapi/v1/groups";var _={users:{component:e=>{var t;let{pageState:s,initialItems:m,itemData:u,pageSession:h,extraData:f}=e,[w,y]=(0,g.useState)(null!==(t=null==f?void 0:f.groups)&&void 0!==t?t:(0,z.E)("pending"));(0,S.a)(e=>{$.bl.get(A,e)},y,null==f?void 0:f.objects);let x=e=>{let t=w.data.items.map(e=>e.name).find(t=>t==e);return t||""};return(0,o.G)(()=>"At this moment the user is browsing the user management page. The user management page allows to list, create, read, update and delete users and allows to reset the user passwords, chahing the user privileges (admin true/false) and chaing the user types.\n            The zod schema for the user object is:\n            export const UserSchema = Schema.object({\n                username: z.string().email().label('email').hint('user@example.com').static().id().search(),\n                type: z.string().min(1).hint('user, admin, ...').search().help(\"The type refers to a group name. Groups contains privileges (admin true/false) and workspaces.\"),\n                password: z.string().min(6).hint('**********').secret().onCreate('cypher').onUpdate('update').onRead('clearPassword').onList('clearPassword').help(\"Salted hashed password using bcrypt.\"),\n                createdAt: z.string().min(1).generate((obj) => moment().toISOString()).search(),\n                lastLogin: z.string().optional().search(),\n                from: z.string().min(1).search().generate((obj) => 'admin').help(\"Interface used to create the user. Users can be created from command line or from the admin panel\")\n            })\n            the user management system is located at /packages/protolib/bundles/users. The api for managing users is for admins only, and its located at /adminapi/v1/accounts. To read a specify account, /adminapi/v1/accounts/:email.\n            The UI of the users page is located at /packages/protolib/bundles/users/adminPages.tsx and the schema and protomodel declaration at /packages/protolib/bundles/users/usersSchema.ts. The API file is located at /packages/protolib/bundles/users/usersAPI.ts.\n            The user management page allows to manage the users of the system. Users are able to login with their email and password.\n            "+((null==m?void 0:m.isLoaded)?"Currently the system returned the following information: "+JSON.stringify(m.data):"")),(0,r.jsx)(i.D,{title:"Users",pageSession:h,children:(0,r.jsx)(l.V,{integratedChat:!0,enableAddToInitialData:!0,entityName:"accounts",itemData:u,rowIcon:j,sourceUrl:P,initialItems:m,numColumnsForm:1,name:"user",defaultView:"list",onAdd:e=>{if(e.password!=e.repassword)throw"Passwords do not match";let{repassword:t,...s}=e;return s},onEdit:e=>{if(e.password!=e.repassword)throw"Passwords do not match";let{repassword:t,...s}=e;return s},customFields:{type:{component:(e,t,s,a)=>{var n;return("add"==a||"edit"==a)&&(0,r.jsx)(L.E,{f:1,title:"type",elements:null==w?void 0:null===(n=w.data)||void 0===n?void 0:n.items.map(e=>e.name).map(e=>e),value:x(t),setValue:e=>s(e)})}}},columns:d.Z.columns(d.Z.column("email","username",!0),d.Z.column("type","type",!0,e=>(0,r.jsx)(c.A,{text:e.type.toUpperCase(),color:"admin"==e.type?"$color5":"$gray5"})),d.Z.column("from","from",!0,e=>{var t;return(0,r.jsx)(c.A,{text:null===(t=e.from)||void 0===t?void 0:t.toUpperCase(),color:"cmd"==e.from?"$blue5":"$gray5"})}),d.Z.column("created","createdAt",!0,e=>p()(e.createdAt).format(T)),d.Z.column("last login","lastLogin",!0,e=>e.lastLogin?(0,r.jsx)(c.A,{text:p()(e.lastLogin).format(T),color:"$gray5"}):(0,r.jsx)(c.A,{text:"never",color:"$gray5"}))),extraFieldsForms:{repassword:n.z.string().min(6).label("repeat password").after("password").hint("**********").secret()},model:a.T,pageState:s,icons:U,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,m.eq)(P,["admin"],{},async()=>({groups:await $.bl.get(A)}))}},C=s(97729),I=s.n(C);function N(e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I(),{children:(0,r.jsx)("title",{children:"Protofy - Users"})}),(0,r.jsx)(_.users.component,{...e})]})}},28044:function(e,t,s){"use strict";s.d(t,{T:function(){return d}});var r=s(30195),a=s(75370),n=s(19034),o=s.n(n),i=s(54283);let l=a.V_.object({username:r.z.string().email().label("email").hint("user@example.com").static().id().search(),type:r.z.string().min(1).label("group").hint("user, admin, ...").search().help("The type refers to a group name. Groups contains privileges (admin true/false) and workspaces."),password:r.z.string().min(6).hint("**********").secret().onCreate("cypher").onUpdate("update").onRead("clearPassword").onList("clearPassword").help("Salted hashed password using bcrypt."),permissions:r.z.array(r.z.string()).optional().label("additional permissions"),createdAt:r.z.string().min(1).generate(e=>o()().toISOString()).search().hidden(),lastLogin:r.z.string().optional().search().hidden(),from:r.z.string().min(1).search().generate(e=>"admin").help("Interface used to create the user. Users can be created from command line or from the admin panel").hidden()}),d=i.$.createDerived("UserModel",l)}},function(e){e.O(0,[3950,3661,7205,5283,9927,7450,2029,6282,9884,8164,1004,5552,5762,1773,3265,9401,9774,2888,179],function(){return e(e.s=9312)}),_N_E=e.O()}]);