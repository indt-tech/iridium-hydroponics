(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2013],{68425:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/apis",function(){return a(8802)}])},8802:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Q}});var i=a(52322),r=a(75370),s=a(54283);let n=r.V_.object({name:r.V_.string().id().static()}),o=s.$.createDerived("ObjectModel",n);var l=a(48115),d=a(40214),c=a(51813),u=a(13997),p=a(50897),m=a(45734),h=a(59928),b=a(8939),g=a(89929),f=a(88505),x=a(78161),_=a(2784),j=a(87656);let v=e=>{let{color:t="black",size:a=24,...r}=e;return(0,i.jsxs)(j.Svg,{width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[(0,i.jsx)(j.Path,{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",stroke:`${t}`}),(0,i.jsx)(j.Circle,{cx:"12",cy:"12",r:"3",stroke:`${t}`})]})};v.displayName="Eye";let y=(0,_.memo)((0,x.H)(v));var w=a(60166),z=a(30195),I=a(82695),S=a(6429),P=a(1201),N=a(79562),A=a(10836),k=a(28044),T=a(3559),D=a(93976),C=a(52415);let q=z.z.object({type:z.z.string(),options:z.z.any()});z.z.object({resources:z.z.array(q),menu:z.z.any()});let O=r.V_.object({name:z.z.string().search().id()}),$=s.$.createDerived("WorkspaceModel",O);var F=a(52725),L=(0,a(43657).jb)("objects",{});let U={event:D.Yq,user:k.T,group:T.d,object:C.Wk,workspace:$,api:o,page:F.L,...L};var V=a(91838),E=a(26887),R=a(6289),M=a(1888),J=a(70396);let G="  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-36 _mr-0px _mb-1481558152 _ml-0px ",Z={},K=e=>{let{method:t,path:a,description:r,children:s}=e,[n,o]=(0,_.useState)([""]);return(0,i.jsx)(m.U,{onValueChange:e=>o(e),onPress:e=>e.stopPropagation(),type:"multiple",boc:"$gray6",f:1,mb:"$5",width:"640px",children:(0,i.jsxs)(m.U.Item,{br:"$5",bw:1,boc:"$gray6",value:"item",children:[(0,i.jsx)(m.U.Trigger,{p:0,px:8,height:43,bc:"$transparent",focusStyle:{bc:"$transparent"},br:n.includes("item")?"$0":"$5",btlr:"$5",btrr:"$5",bw:"$0",flexDirection:"row",ai:"center",children:e=>{let{open:s}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mt-1481558214 ",children:(0,i.jsx)(B,{method:t,path:a,description:r})}),(0,i.jsx)(h.b,{animation:"quick",rotate:s?"180deg":"0deg",children:(0,i.jsx)(w._,{size:"$1"})})]})}}),(0,i.jsx)(m.U.Content,{f:1,br:"$5",children:s})]})})},W=e=>{let{query:t,desc:a}=e;return(0,i.jsx)(V.I,{children:(0,i.jsxs)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mb-1481558152 _mt-1481558152 ",children:[(0,i.jsx)(N.A,{text:t,color:"$color5",mr:"$3",h:25,w:"100px"}),(0,i.jsxs)("span",{className:"  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px ",children:[" ",a]})]})})},B=e=>{let{method:t,path:a,description:r}=e;return(0,i.jsx)(V.I,{children:(0,i.jsxs)("div",{className:"  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _pt-10px _pr-1316330393 _pb-10px _pl-10px _mt-5px _mb-1481558152 _w-600px _ai-center ",children:[(0,i.jsxs)(b.sL,{alignItems:"center",space:!0,children:[(0,i.jsx)("div",{className:(0,J.concatClassName)(" _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _pt-1481558276 _pr-1481558276 _pb-1481558276 _pl-1481558276  _btlr-1307609936 _btrr-1307609936 _bbrr-1307609936 _bblr-1307609936  "+("GET"===t?" _bg-549765325":" _bg-549765356")),children:(0,i.jsx)("span",{className:"  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fos-14px _fow-bold _col-white _pt-5px _pr-5px _pb-5px _pl-5px _btlr-5px _btrr-5px _bbrr-5px _bblr-5px ",children:t})}),(0,i.jsx)("span",{className:"  _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-bold _fg-1 _fs-1 _fb-auto ",children:a})]}),(0,i.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _ml-1481558152 ",children:(0,i.jsx)("span",{className:"  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-grey36 _fos-14px ",children:r})})]})})};var H={apis:{component:e=>{var t,a,r,s,n,m,h,x;let{pageState:j,initialItems:v,pageSession:w,extraData:S}=e,{replace:k}=(0,I.N)(null!=j?j:{});(0,P.G)(()=>'At this moment the user is browsing the Rest API management page. The Rest API management page allows to list, create, read, update and delete API definitions. API definitions are typescript files using express.\n            The system allows to create APIs either from an empty template, or from an AutoCRUD template. The automatic crud template creates an automatic CRUD API for a given object. \n            To Automatic CRUD API generates the following endpoints: get /api/v1/:objectName (list), post /api/v1/:objectName (create), post /api/v1/:objectName/:objectId (update), get /api/v1/:objectName/:objectId/delete (delete) and get /api/v1/:objectName/:objectId (read)\n            the API files are located at /packages/app/bundles/custom/apis. \n            The Automatic CURD system can be manually extended to have more endpoints.\n            The user can edit the API files by clicking on any API, and can choose visual programming using interactive diagrams generated from the source code, or text based tradicional programming to edit the .ts api file.\n            Those APIs allow the user to create pages based on object data. The automatic crud is an "storage" to manage data for a specific object.\n            '+((null==v?void 0:v.isLoaded)?"Currently the system returned the following information: "+JSON.stringify(v.data):""));let[T,D]=(0,_.useState)(!1),[C,q]=(0,_.useState)(null!==(x=null==S?void 0:S.objects)&&void 0!==x?x:(0,R.E)("pending")),[O,$]=(0,_.useState)({}),F={},L=(null==O?void 0:null===(t=O.data)||void 0===t?void 0:t.object)?U[null==O?void 0:null===(a=O.data)||void 0===a?void 0:a.object]:null;return L&&(F=L.getApiOptions()),(0,E.a)(e=>{l.bl.get({url:"/adminapi/v1/objects?all=1"},e)},q,null==S?void 0:S.objects),(0,i.jsxs)(d.D,{title:"APIs",pageSession:w,children:[(0,i.jsx)(c.a,{acceptCaption:"Close",cancelCaption:"Keep editing",onAccept:async()=>{},open:T,setOpen:D,title:"API Endpoints",description:"",children:(0,i.jsx)(g.p,{maxHeight:"80vh",children:(0,i.jsx)(A.Z,{mt:"$5",children:(0,i.jsxs)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",children:[(0,i.jsxs)(K,{method:"GET",path:F?F.prefix+F.name:"",description:"List all "+(null==O?void 0:null===(r=O.data)||void 0===r?void 0:r.name)+" entries",children:[(0,i.jsx)("span",{className:G,children:"The list API endpoint is designed to provide a paginated, ordered list of items from a dataset. It accepts several query parameters that allow you to customize the response."}),(0,i.jsx)(W,{query:"itemsPerPage",desc:"Defines max items returned per page; defaults to 25."}),(0,i.jsx)(W,{query:"page",desc:"Selects which page of results to retrieve, starting at 0."}),(0,i.jsx)(W,{query:"orderBy",desc:"Specifies field name to sort the results by."}),(0,i.jsx)(W,{query:"orderDirection",desc:"Sets sort direction, ascending ('asc') by default, use 'desc' for descending."}),(0,i.jsx)(W,{query:"all",desc:"If set, returns all results, bypassing pagination."})]}),(0,i.jsxs)(K,{method:"GET",path:F?F.prefix+F.name+"/:id":"",description:"Reads a "+(null==O?void 0:null===(s=O.data)||void 0===s?void 0:s.name)+" entry by id",children:[(0,i.jsx)("span",{className:G,children:"This 'read' endpoint is used to fetch a specific item based on its unique id. It implements security checks and custom data transformations."}),(0,i.jsx)(W,{query:":id",desc:"The unique id of the item to be retrieved from the dataset."})]}),(0,i.jsx)(K,{method:"POST",path:F?F.prefix+F.name:"",description:"Creates a new "+(null==O?void 0:null===(n=O.data)||void 0===n?void 0:n.name)+" entry",children:(0,i.jsx)("span",{className:G,children:"The 'create' endpoint is utilized for adding new items to the dataset. It includes data transformations, and event notifications for successful creations."})}),(0,i.jsxs)(K,{method:"POST",path:F?F.prefix+F.name+"/:id":"",description:"Updates a "+(null==O?void 0:null===(m=O.data)||void 0===m?void 0:m.name)+" entry by id",children:[(0,i.jsx)("span",{className:G,children:"The 'update' endpoint is used for modifying existing items based on their unique id. It includes data transformation processes, and notifications for each update action."}),(0,i.jsx)(W,{query:":id",desc:"The unique id of the item to be updated in the dataset."})]}),(0,i.jsxs)(K,{method:"POST",path:F?F.prefix+F.name+"/:id/delete":"",description:"Deletes a "+(null==O?void 0:null===(h=O.data)||void 0===h?void 0:h.name)+" entry by id",children:[(0,i.jsx)("span",{className:G,children:"The 'delete' endpoint facilitates the removal of items based on their unique id. It encompasses transformations of the data for deletion, and event notifications for the action performed."}),(0,i.jsx)(W,{query:":id",desc:"The unique id of the item to be deleted from the dataset."})]})]})})})}),(0,i.jsx)(u.V,{integratedChat:!0,onSelectItem:e=>k("editFile","/packages/app/bundles/custom/apis/"+e.data.name+".ts"),rowIcon:f.S,sourceUrl:"/adminapi/v1/apis",initialItems:v,numColumnsForm:1,name:"api",columns:p.Z.columns(p.Z.column("name","name",!0,e=>(0,i.jsx)(b.sL,{id:"apis-datatable-"+e.name,children:e.name})),p.Z.column("type","type",!0,e=>(0,i.jsx)(N.A,{text:e.type.toUpperCase(),color:"AutoAPI"==e.type?"$color5":"$gray5"})),p.Z.column("object","object",!0,e=>(0,i.jsx)(N.A,{text:e.object,color:"None"==e.object?"$gray5":"$color5"}))),extraFieldsFormsAdd:C.isLoaded?{template:z.z.union([z.z.literal("Automatic CRUD"),z.z.literal("Automatic CRUD (custom storage)"),z.z.literal("IOT Router"),z.z.literal("Custom API")]).after("name"),object:z.z.union([z.z.literal("without object"),...C.data.items.map(e=>z.z.literal(e.name))]).after("name")}:{},extraMenuActions:[{text:"View API details",icon:y,action:e=>{D(!0),$(e),console.log("DATA",e)},isVisible:e=>"AutoAPI"===e.data.type}],model:o,pageState:j,icons:Z})]})},getServerSideProps:(0,M.F7)(async e=>(0,S.NA)(e,["admin"]))}};a(14528);var X=a(97729),Y=a.n(X);function Q(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Y(),{children:(0,i.jsx)("title",{children:"Protofy - Apis"})}),(0,i.jsx)(H.apis.component,{...e})]})}},54283:function(e,t,a){"use strict";a.d(t,{$:function(){return l},J:function(){return o}});var i=a(94801),r=a(55858),s=a(53596);let n=(0,s.j)();class o{get(e,t){var a;return null!==(a=this.data[e])&&void 0!==a?a:t}getObjectSchema(){return this.objectSchema}getModelName(){return this.modelName}getLocation(){let e=this.objectSchema.is("location").getFields();if(!e.length)throw"Model error: "+this.getModelName()+" doesn't have location information";let t=e[0],a=this.objectSchema.getFieldKeyDefinition(t,"latKey"),i=this.objectSchema.getFieldKeyDefinition(t,"lonKey");if(this.data[t])return{lat:this.data[t][a],lon:this.data[t][i]}}getId(){return this.data[this.idField]}getNotificationsTopic(e){return"notifications/".concat(this.getModelName(),"/").concat(e,"/").concat(this.getId())}getNotificationsPayload(){return this.serialize()}setId(e,t){return new this.constructor({...t||this.data,[this.idField]:e},this.session,this.modelName)}isVisible(){return!this.isDeleted()}isDeleted(){return!!this.data._deleted}list(e,t,a){if(!e)return this.read();{let{parsed:t,searchWithoutTags:a}=function(e){let t;let a=/(\w+):("[^"]+"|\S+)/g,i={},r=e;for(;null!==(t=a.exec(e));){let e=t[1].toLowerCase(),a=t[2].replace(/"/g,"").toLowerCase();i[e]=a,r=r.replace(t[0],"")}return{parsed:i,searchWithoutTags:r=r.trim()}}(e);for(let[e,a]of Object.entries(t))if(!this.data.hasOwnProperty(e)||this.data[e]!=a)return;let r=this.objectSchema.is("search").getFields();for(var i=0;i<r.length;i++)if((this.data[r[i]]+"").toLowerCase().includes(a.toLowerCase()))return this.read()}}async listTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=this.list(e,a,i);if(r)return await this.getObjectSchema().apply("list",r,t)}create(e){let t=this.getData(e);return n.debug({transformed:t},"Creating object: ".concat(JSON.stringify(t))),new this.constructor(t,this.session,this.modelName).validate()}async createTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("create",{...this.data},e);return this.create(t)}read(e){return{...this.data}}async readTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=await this.getObjectSchema().apply("read",this.read(t),e);return a}update(e,t){return e.setId(this.getId(),{...t||e.data})}async updateTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await this.getObjectSchema().apply("update",{...e.data},t,{...this.data});return this.update(e,a)}delete(e){return new this.constructor({_deleted:!0,...e||this.data},this.session,this.modelName)}async deleteTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("delete",{...this.data},e);return this.delete(t)}validate(){return this.schema.parse(this.data),this}serialize(){return JSON.stringify(this.data)}static getApiOptions(){throw Error("Derived class must implement getApiOptions")}static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static unserialize(e,t){return this._newInstance(JSON.parse(e),t)}static load(e,t){return this._newInstance(e,t)}static sort(e,t,a){return e.sort((e,i)=>e[t]>i[t]?"asc"===a?1:-1:e[t]<i[t]?"asc"===a?-1:1:0)}getData(e){return{...this.getObjectSchema().applyGenerators(null!=e?e:this.data)}}constructor(e,t,a,s){var n,o;this.data=e,this.session=null!=a?a:(0,i.ed)(),this.schema=t,this.objectSchema=r.U.load(this.schema),this.modelName=null!==(n=null==s?void 0:s.toLowerCase())&&void 0!==n?n:"unknown";let l=this.objectSchema.is("id");l.getFields().length>1&&(l=l.isNot("fallbackId")),this.idField=null!==(o=l.getFirst("id"))&&void 0!==o?o:"id"}}class l extends o{static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static createDerived(e,t,a,i){class r extends l{static _newInstance(e,t){return new r(e,t)}static getApiOptions(){return{name:a,prefix:i}}constructor(a,i){super(a,t,i,e.substring(0,e.length-5).toLowerCase())}}return r.schemaInstance=t,Object.defineProperty(r,"name",{value:e,writable:!1}),r}constructor(e,t,a,i){super(e,t,a,i)}}},43657:function(e,t,a){"use strict";a.d(t,{jb:function(){return i}});let i=(e,t)=>t},93976:function(e,t,a){"use strict";a.d(t,{Yq:function(){return u}});var i=a(30195),r=a(43657),s=a(75370),n=a(19034),o=a.n(n),l=a(54283);let d=i.z.object((0,r.jb)("schema",{path:i.z.string().search(),from:i.z.string().search(),user:i.z.string().generate(e=>"me").search(),payload:i.z.record(i.z.string(),i.z.any()).search(),created:i.z.string().generate(e=>o()().toISOString()).search()})),c=i.z.object({...s.Pp.shape,...d.shape});class u extends l.J{list(e){return e?JSON.stringify(this.data).toLowerCase().includes(e.toLowerCase())?this.read():void 0:this.read()}static _newInstance(e,t){return new u(e,t)}constructor(e,t){super(e,c,t,"Event")}}},3559:function(e,t,a){"use strict";a.d(t,{d:function(){return o}});var i=a(30195),r=a(75370),s=a(54283);let n=r.V_.object({name:i.z.string().label("name").hint("user, admin, ...").static().id().search(),workspaces:i.z.array(i.z.string()).hidden(),permissions:i.z.array(i.z.string()).optional(),admin:i.z.boolean().optional()}),o=s.$.createDerived("GroupModel",n)},52415:function(e,t,a){"use strict";a.d(t,{Wk:function(){return l}});var i=a(30195),r=a(54283);let s=i.z.object({id:i.z.string().search().id().generate(e=>e.name.charAt(0).toUpperCase()+e.name.slice(1)+"Model").hidden(),name:i.z.string().search().static(),features:i.z.any().generate({},!0).hidden(),keys:i.z.record(i.z.string().optional(),i.z.object({type:i.z.union([i.z.literal("string"),i.z.literal("number"),i.z.literal("boolean"),i.z.literal("array"),i.z.literal("object"),i.z.literal("record"),i.z.literal("union")]),params:i.z.array(i.z.string()).optional(),modifiers:i.z.array(i.z.object({name:i.z.union([i.z.literal("id"),i.z.literal("search"),i.z.literal("generate"),i.z.literal("display"),i.z.literal("optional"),i.z.literal("email"),i.z.literal("label"),i.z.literal("hint"),i.z.literal("static"),i.z.literal("min"),i.z.literal("max"),i.z.literal("secret"),i.z.literal("onCreate"),i.z.literal("onUpdate"),i.z.literal("onRead"),i.z.literal("onDelete"),i.z.literal("onList"),i.z.literal("name"),i.z.literal("location")]),params:i.z.array(i.z.string()).optional()}).name("name")).optional()}).name("name")).generate({})}),n=i.z.object({...s.shape}),o=e=>({...e,keys:Object.keys(e.keys?e.keys:{}).reduce((t,a)=>({...t,[a]:{type:"string",...e.keys[a]}}),{})});class l extends r.J{getDefaultSchemaFilePath(){return l.getDefaultSchemaFilePath(this.data.name)}static getDefaultSchemaFilePath(e){return"/packages/app/bundles/custom/objects/"+e+".ts"}create(e){let t=null!=e?e:this.getData(),a=o(t);return super.create(a)}update(e,t){let a=null!=t?t:e.data,i=o(a);return super.update(e,i)}static _newInstance(e,t){return new l(e,t)}constructor(e,t){super(e,n,t,"Object")}}},52725:function(e,t,a){"use strict";a.d(t,{L:function(){return o}});var i=a(30195),r=a(75370),s=a(54283);let n=r.V_.object({name:i.z.string().search().id(),route:i.z.string().search(),permissions:i.z.array(i.z.string()).label("Permissions").generate(()=>[]),web:i.z.boolean().defaultValue(!0),electron:i.z.boolean().defaultValue(!1),protected:i.z.boolean().defaultValue(!1).label("Require user")});class o extends s.J{getDefaultFilePath(){return"/packages/app/bundles/custom/pages/"+this.data.name+".tsx"}static _newInstance(e,t){return new o(e,t)}constructor(e,t){super(e,n,t,"Page")}}},28044:function(e,t,a){"use strict";a.d(t,{T:function(){return d}});var i=a(30195),r=a(75370),s=a(19034),n=a.n(s),o=a(54283);let l=r.V_.object({username:i.z.string().email().label("email").hint("user@example.com").static().id().search(),type:i.z.string().min(1).label("group").hint("user, admin, ...").search().help("The type refers to a group name. Groups contains privileges (admin true/false) and workspaces."),password:i.z.string().min(6).hint("**********").secret().onCreate("cypher").onUpdate("update").onRead("clearPassword").onList("clearPassword").help("Salted hashed password using bcrypt."),permissions:i.z.array(i.z.string()).optional().label("additional permissions"),createdAt:i.z.string().min(1).generate(e=>n()().toISOString()).search().hidden(),lastLogin:i.z.string().optional().search().hidden(),from:i.z.string().min(1).search().generate(e=>"admin").help("Interface used to create the user. Users can be created from command line or from the admin panel").hidden()}),d=o.$.createDerived("UserModel",l)},1888:function(e,t,a){"use strict";a.d(t,{F7:function(){return n},eq:function(){return o}});var i=a(44499),r=a(6429),s=a(48115);let n=e=>i.l.SSR?e:void 0;function o(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(async n=>{var o,l,d,c,u,p;let m={itemsPerPage:parseInt(n.query.itemsPerPage)?parseInt(n.query.itemsPerPage):"",page:parseInt(n.query.page,10)?parseInt(n.query.page,10):"",search:null!==(o=n.query.search)&&void 0!==o?o:"",orderBy:null!==(l=n.query.orderBy)&&void 0!==l?l:"",orderDirection:null!==(d=n.query.orderDirection)&&void 0!==d?d:"",view:null!==(c=n.query.view)&&void 0!==c?c:"",item:null!==(u=n.query.item)&&void 0!==u?u:"",editFile:null!==(p=n.query.editFile)&&void 0!==p?p:"",..."function"==typeof a?await a(n):a},h="function"==typeof e?e(n):e;return(0,r.NA)(n,t,{sourceUrl:h,initialItems:await s.bl.get({url:(0,r.VM)(h,n),...m}),itemData:n.query.item?await s.bl.get((0,r.VM)(h+"/"+n.query.item,n)):"",extraData:{..."function"==typeof i?await i(n):i},pageState:{...m}})})}},14528:function(){}},function(e){e.O(0,[8641,8081,4733,1335,8873,2859,6313,3950,3661,3057,9613,7369,2905,1004,6076,8404,4608,9774,2888,179],function(){return e(e.s=68425)}),_N_E=e.O()}]);