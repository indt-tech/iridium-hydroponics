(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892],{9312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/users",function(){return a(14562)}])},14562:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return $}});var r=a(52322),s=a(28044),i=a(30195),n=a(1201),o=a(40214),l=a(13997),d=a(50897),c=a(79562),u=a(1888),h=a(19034),m=a.n(h),p=a(78161),g=a(2784),f=a(87656);let w=e=>{let{color:t="black",size:a=24,...s}=e;return(0,r.jsxs)(f.Svg,{width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[(0,r.jsx)(f.Rect,{width:"20",height:"16",x:"2",y:"4",rx:"2",stroke:`${t}`}),(0,r.jsx)(f.Path,{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",stroke:`${t}`})]})};w.displayName="Mail";let v=(0,g.memo)((0,p.H)(w));var y=a(32627);let b=e=>{let{color:t="black",size:a=24,...s}=e;return(0,r.jsxs)(f.Svg,{width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[(0,r.jsx)(f.Circle,{cx:"7.5",cy:"15.5",r:"5.5",stroke:`${t}`}),(0,r.jsx)(f.Path,{d:"m21 2-9.6 9.6",stroke:`${t}`}),(0,r.jsx)(f.Path,{d:"m15.5 7.5 3 3L22 7l-3-3",stroke:`${t}`})]})};b.displayName="Key";let j=(0,g.memo)((0,p.H)(b)),x=e=>{let{color:t="black",size:a=24,...s}=e;return(0,r.jsxs)(f.Svg,{width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[(0,r.jsx)(f.Path,{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",stroke:`${t}`}),(0,r.jsx)(f.Circle,{cx:"12",cy:"7",r:"4",stroke:`${t}`})]})};x.displayName="User";let S=(0,g.memo)((0,p.H)(x));var k=a(48115),I=a(48715),P=a(6289),N=a(26887);let L="YYYY-MM-DD HH:mm:ss",T={username:v,type:y.V,passwod:j,repassword:j},_="/adminapi/v1/accounts",O="/adminapi/v1/groups";var D={users:{component:e=>{var t;let{pageState:a,initialItems:u,itemData:h,pageSession:p,extraData:f}=e,[w,v]=(0,g.useState)(null!==(t=null==f?void 0:f.groups)&&void 0!==t?t:(0,P.E)("pending"));(0,N.a)(e=>{k.bl.get(O,e)},v,null==f?void 0:f.objects);let y=e=>{let t=w.data.items.map(e=>e.name).find(t=>t==e);return t||""};return(0,n.G)(()=>"At this moment the user is browsing the user management page. The user management page allows to list, create, read, update and delete users and allows to reset the user passwords, chahing the user privileges (admin true/false) and chaing the user types.\n            The zod schema for the user object is:\n            export const UserSchema = Schema.object({\n                username: z.string().email().label('email').hint('user@example.com').static().id().search(),\n                type: z.string().min(1).hint('user, admin, ...').search().help(\"The type refers to a group name. Groups contains privileges (admin true/false) and workspaces.\"),\n                password: z.string().min(6).hint('**********').secret().onCreate('cypher').onUpdate('update').onRead('clearPassword').onList('clearPassword').help(\"Salted hashed password using bcrypt.\"),\n                createdAt: z.string().min(1).generate((obj) => moment().toISOString()).search(),\n                lastLogin: z.string().optional().search(),\n                from: z.string().min(1).search().generate((obj) => 'admin').help(\"Interface used to create the user. Users can be created from command line or from the admin panel\")\n            })\n            the user management system is located at /packages/protolib/bundles/users. The api for managing users is for admins only, and its located at /adminapi/v1/accounts. To read a specify account, /adminapi/v1/accounts/:email.\n            The UI of the users page is located at /packages/protolib/bundles/users/adminPages.tsx and the schema and protomodel declaration at /packages/protolib/bundles/users/usersSchema.ts. The API file is located at /packages/protolib/bundles/users/usersAPI.ts.\n            The user management page allows to manage the users of the system. Users are able to login with their email and password.\n            "+((null==u?void 0:u.isLoaded)?"Currently the system returned the following information: "+JSON.stringify(u.data):"")),(0,r.jsx)(o.D,{title:"Users",pageSession:p,children:(0,r.jsx)(l.V,{integratedChat:!0,enableAddToInitialData:!0,entityName:"accounts",itemData:h,rowIcon:S,sourceUrl:_,initialItems:u,numColumnsForm:1,name:"user",defaultView:"list",onAdd:e=>{if(e.password!=e.repassword)throw"Passwords do not match";let{repassword:t,...a}=e;return a},onEdit:e=>{if(e.password!=e.repassword)throw"Passwords do not match";let{repassword:t,...a}=e;return a},customFields:{type:{component:(e,t,a,s)=>{var i;return("add"==s||"edit"==s)&&(0,r.jsx)(I.E,{f:1,title:"type",elements:null==w?void 0:null===(i=w.data)||void 0===i?void 0:i.items.map(e=>e.name).map(e=>e),value:y(t),setValue:e=>a(e)})}}},columns:d.Z.columns(d.Z.column("email","username",!0),d.Z.column("type","type",!0,e=>{var t;return(0,r.jsx)(c.A,{text:null===(t=e.type)||void 0===t?void 0:t.toUpperCase(),color:"admin"==e.type?"$color5":"$gray5"})}),d.Z.column("from","from",!0,e=>{var t;return(0,r.jsx)(c.A,{text:null===(t=e.from)||void 0===t?void 0:t.toUpperCase(),color:"cmd"==e.from?"$blue5":"$gray5"})}),d.Z.column("created","createdAt",!0,e=>m()(e.createdAt).format(L)),d.Z.column("last login","lastLogin",!0,e=>e.lastLogin?(0,r.jsx)(c.A,{text:m()(e.lastLogin).format(L),color:"$gray5"}):(0,r.jsx)(c.A,{text:"never",color:"$gray5"}))),extraFieldsForms:{repassword:i.z.string().min(6).label("repeat password").after("password").hint("**********").secret()},model:s.T,pageState:a,icons:T,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,u.eq)(_,["admin"],{},async()=>({groups:await k.bl.get(O)}))}},z=a(97729),C=a.n(z);function $(e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C(),{children:(0,r.jsx)("title",{children:"Protofy - Users"})}),(0,r.jsx)(D.users.component,{...e})]})}},54283:function(e,t,a){"use strict";a.d(t,{$:function(){return l},J:function(){return o}});var r=a(94801),s=a(55858),i=a(53596);let n=(0,i.j)();class o{get(e,t){var a;return null!==(a=this.data[e])&&void 0!==a?a:t}getObjectSchema(){return this.objectSchema}getModelName(){return this.modelName}getLocation(){let e=this.objectSchema.is("location").getFields();if(!e.length)throw"Model error: "+this.getModelName()+" doesn't have location information";let t=e[0],a=this.objectSchema.getFieldKeyDefinition(t,"latKey"),r=this.objectSchema.getFieldKeyDefinition(t,"lonKey");if(this.data[t])return{lat:this.data[t][a],lon:this.data[t][r]}}getId(){return this.data[this.idField]}getNotificationsTopic(e){return"notifications/".concat(this.getModelName(),"/").concat(e,"/").concat(this.getId())}getNotificationsPayload(){return this.serialize()}setId(e,t){return new this.constructor({...t||this.data,[this.idField]:e},this.session,this.modelName)}isVisible(){return!this.isDeleted()}isDeleted(){return!!this.data._deleted}list(e,t,a){if(!e)return this.read();{let{parsed:t,searchWithoutTags:a}=function(e){let t;let a=/(\w+):("[^"]+"|\S+)/g,r={},s=e;for(;null!==(t=a.exec(e));){let e=t[1].toLowerCase(),a=t[2].replace(/"/g,"").toLowerCase();r[e]=a,s=s.replace(t[0],"")}return{parsed:r,searchWithoutTags:s=s.trim()}}(e);for(let[e,a]of Object.entries(t))if(!this.data.hasOwnProperty(e)||this.data[e]!=a)return;let s=this.objectSchema.is("search").getFields();for(var r=0;r<s.length;r++)if((this.data[s[r]]+"").toLowerCase().includes(a.toLowerCase()))return this.read()}}async listTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=this.list(e,a,r);if(s)return await this.getObjectSchema().apply("list",s,t)}create(e){let t=this.getData(e);return n.debug({transformed:t},"Creating object: ".concat(JSON.stringify(t))),new this.constructor(t,this.session,this.modelName).validate()}async createTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("create",{...this.data},e);return this.create(t)}read(e){return{...this.data}}async readTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=await this.getObjectSchema().apply("read",this.read(t),e);return a}update(e,t){return e.setId(this.getId(),{...t||e.data})}async updateTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await this.getObjectSchema().apply("update",{...e.data},t,{...this.data});return this.update(e,a)}delete(e){return new this.constructor({_deleted:!0,...e||this.data},this.session,this.modelName)}async deleteTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("delete",{...this.data},e);return this.delete(t)}validate(){return this.schema.parse(this.data),this}serialize(){return JSON.stringify(this.data)}static getApiOptions(){throw Error("Derived class must implement getApiOptions")}static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static unserialize(e,t){return this._newInstance(JSON.parse(e),t)}static load(e,t){return this._newInstance(e,t)}static sort(e,t,a){return e.sort((e,r)=>e[t]>r[t]?"asc"===a?1:-1:e[t]<r[t]?"asc"===a?-1:1:0)}getData(e){return{...this.getObjectSchema().applyGenerators(null!=e?e:this.data)}}constructor(e,t,a,i){var n,o;this.data=e,this.session=null!=a?a:(0,r.ed)(),this.schema=t,this.objectSchema=s.U.load(this.schema),this.modelName=null!==(n=null==i?void 0:i.toLowerCase())&&void 0!==n?n:"unknown";let l=this.objectSchema.is("id");l.getFields().length>1&&(l=l.isNot("fallbackId")),this.idField=null!==(o=l.getFirst("id"))&&void 0!==o?o:"id"}}class l extends o{static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static createDerived(e,t,a,r){class s extends l{static _newInstance(e,t){return new s(e,t)}static getApiOptions(){return{name:a,prefix:r}}constructor(a,r){super(a,t,r,e.substring(0,e.length-5).toLowerCase())}}return s.schemaInstance=t,Object.defineProperty(s,"name",{value:e,writable:!1}),s}constructor(e,t,a,r){super(e,t,a,r)}}},28044:function(e,t,a){"use strict";a.d(t,{T:function(){return d}});var r=a(30195),s=a(75370),i=a(19034),n=a.n(i),o=a(54283);let l=s.V_.object({username:r.z.string().email().label("email").hint("user@example.com").static().id().search(),type:r.z.string().min(1).label("group").hint("user, admin, ...").search().help("The type refers to a group name. Groups contains privileges (admin true/false) and workspaces."),password:r.z.string().min(6).hint("**********").secret().onCreate("cypher").onUpdate("update").onRead("clearPassword").onList("clearPassword").help("Salted hashed password using bcrypt."),permissions:r.z.array(r.z.string()).optional().label("additional permissions"),createdAt:r.z.string().min(1).generate(e=>n()().toISOString()).search().hidden(),lastLogin:r.z.string().optional().search().hidden(),from:r.z.string().min(1).search().generate(e=>"admin").help("Interface used to create the user. Users can be created from command line or from the admin panel").hidden()}),d=o.$.createDerived("UserModel",l)},1888:function(e,t,a){"use strict";a.d(t,{F7:function(){return n},eq:function(){return o}});var r=a(44499),s=a(6429),i=a(48115);let n=e=>r.l.SSR?e:void 0;function o(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(async n=>{var o,l,d,c,u,h;let m={itemsPerPage:parseInt(n.query.itemsPerPage)?parseInt(n.query.itemsPerPage):"",page:parseInt(n.query.page,10)?parseInt(n.query.page,10):"",search:null!==(o=n.query.search)&&void 0!==o?o:"",orderBy:null!==(l=n.query.orderBy)&&void 0!==l?l:"",orderDirection:null!==(d=n.query.orderDirection)&&void 0!==d?d:"",view:null!==(c=n.query.view)&&void 0!==c?c:"",item:null!==(u=n.query.item)&&void 0!==u?u:"",editFile:null!==(h=n.query.editFile)&&void 0!==h?h:"",..."function"==typeof a?await a(n):a},p="function"==typeof e?e(n):e;return(0,s.NA)(n,t,{sourceUrl:p,initialItems:await i.bl.get({url:(0,s.VM)(p,n),...m}),itemData:n.query.item?await i.bl.get((0,s.VM)(p+"/"+n.query.item,n)):"",extraData:{..."function"==typeof r?await r(n):r},pageState:{...m}})})}}},function(e){e.O(0,[8641,8081,4733,1335,8873,2859,6313,3950,3661,3057,9613,7369,2905,1004,6076,8404,4608,9774,2888,179],function(){return e(e.s=9312)}),_N_E=e.O()}]);