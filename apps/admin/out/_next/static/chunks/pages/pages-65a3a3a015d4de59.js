(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2158],{68918:function(e,t,a){"use strict";a.d(t,{d:function(){return l}});var r=a(78161),s=a(2784),i=a(87656),n=a(52322);let o=e=>{let{color:t="black",size:a=24,...r}=e;return(0,n.jsxs)(i.Svg,{width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[(0,n.jsx)(i.Path,{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",stroke:`${t}`}),(0,n.jsx)(i.Polyline,{points:"15 3 21 3 21 9",stroke:`${t}`}),(0,n.jsx)(i.Line,{x1:"10",x2:"21",y1:"14",y2:"3",stroke:`${t}`})]})};o.displayName="ExternalLink";let l=(0,s.memo)((0,r.H)(o))},17165:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pages",function(){return a(21518)}])},21518:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return U}});var r=a(52322),s=a(52725),i=a(13997),n=a(48115),o=a(40214),l=a(50897),d=a(71932),c=a(79562),u=a(1888),m=a(30195),p=a(52026),_=a(89929),h=a(53763),x=a(8939),f=a(68918),b=a(89560),g=a(82695),w=a(6429),v=a(2784),j=a(6289),y=a(26887),N=a(5632),P=a(51813),S=a(66306),k=a(91838);let I="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-600 _fos-16px _col-791969588 ",F=e=>{let{slides:t,lastButtonCaption:a,onFinish:s}=e,[i,n]=(0,v.useState)(0),o=t.length,l=i>1?i-1:0,d=i<o-1?i+1:null,c=t.filter((e,t)=>t<=i).map(e=>e.name).join(" / ");return(0,r.jsxs)(x.FA,{id:"admin-dataview-create-dlg",w:800,mah:700,p:"$3",f:1,children:[(0,r.jsxs)(x.sL,{id:"admin-eo",mt:"$4",justifyContent:"space-between",width:"100%",children:[(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ",children:(0,r.jsx)("span",{className:I,children:c})}),(0,r.jsx)("div",{className:"  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _ai-flex-end ",children:(0,r.jsxs)("span",{className:I,children:["[",i+1,"/",o,"]"]})})]}),(0,r.jsx)(k.I,{children:(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",children:(0,r.jsx)("span",{className:"  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-600 _fos-34px _col-549765294 ",children:t[i].title})})}),(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mt-1316330269 ",children:t[i].component}),(0,r.jsxs)("div",{className:"  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _gap-40px _jc-center _mb-1316330238 _fg-1 _ai-flex-end ",children:[0!==i?(0,r.jsx)(S.zx,{w:250,onPress:e=>{e.stopPropagation(),i>0&&n(l)},children:"Back"}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)(k.I,{children:(0,r.jsx)(S.zx,{id:"admin-pages-add-btn",w:250,onPress:async e=>{e.stopPropagation(),d?n(d):s&&await s()},children:o===i+1?a:"Next"})})]})]})};a(6410);var C=a(24066),O=a(57643),$=a(82614),z=a(22287),D=a(70396);let E=e=>{var t;let{template:a,isSelected:s,onPress:i,theme:n}=e,[o,l]=(0,v.useState)(!1),d="/images/templates/".concat(a.id,"-").concat(n,".png");return(0,r.jsx)(k.I,{children:(0,r.jsxs)(x.FA,{id:"pages-template-"+a.id,onPress:i,onHoverIn:()=>l(!0),onHoverOut:()=>l(!1),overflow:"hidden",borderWidth:s?"$1":"$0.5",borderColor:s?"$color7":"$gray8",cursor:"pointer",borderRadius:"$3",children:[(0,r.jsx)(z.E,{source:{height:180,width:357,uri:d}}),(0,r.jsx)("div",{className:(0,D.concatClassName)(" _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _mih-0px _miw-0px _fs-0  _zi-10000 _pos-absolute _r-1481558214 _t-1481558214  "+(o?" _dsp-block":" _dsp-none")),children:(0,r.jsx)($.p,{target:"_blank",href:d,children:(0,r.jsx)(S.zx,{backgroundColor:"$color7",size:"$1.5",borderRadius:"$1",px:"$2",textProps:{size:"$1"},onPress:e=>{e.stopPropagation()},children:"preview"})})}),(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _jc-441309761 _btw-1481558338 _btc-791969557 _brc-791969557 _bbc-791969557 _blc-791969557 _bg-791969402 _pt-1481558276 _pb-1481558276 _pr-1481558214 _pl-1481558214 _bts-solid ",children:(0,r.jsx)("p",{className:"  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",children:null!==(t=a.name)&&void 0!==t?t:a.id})})]})})};a(57117);var L=a(81974);let A={blank:{id:"blank",name:"Blank"},default:{id:"default",name:"Default"},admin:{name:"Admin panel",id:"admin",extraFields:e=>{var t;return{object:m.z.union([...e&&e.data?null===(t=e.data)||void 0===t?void 0:t.items.filter(e=>e.features&&e.features.AutoAPI).map(e=>m.z.literal(e.name)):[]]).after("route")}},extraValidation:e=>{if(!Object.keys(e).includes("object"))return{error:"object cant be empty"}}},landing:{id:"landing",name:"Landing"},iot:{id:"iot",name:"IoT Panel"},ecomerce:{id:"ecomerce",name:"E-commerce"},about:{id:"about",name:"About"},newsfeed:{id:"newsfeed",name:"News feed"}},q={},T="/adminapi/v1/pages",V="/adminapi/v1/objects?all=1",M=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _jc-center _ai-center _gap-25px _fw-wrap ",children:t})},B=e=>{let{selected:t,setSelected:a}=e,s=(0,p.useThemeName)();return(0,r.jsxs)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",children:[(0,r.jsx)(_.p,{mah:"500px",children:(0,r.jsx)(M,{children:Object.entries(A).map(e=>{let[i,n]=e;return(0,r.jsx)(E,{theme:s,template:n,isSelected:t===i,onPress:()=>a(i)})})})}),(0,r.jsx)("span",{className:"  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-1316330176 _miw-1316330176 _fs-0 _w-1316330176 _h-1316330176 _pe-none _mb-1316330331 "})]})},Z=e=>{let{data:t,setData:a,error:i,setError:n,objects:o}=e;return(0,r.jsx)(C.G,{externalErrorHandling:!0,error:i,setError:n,data:t,setData:a,name:"page",numColumns:2,mode:"add",title:"",model:s.L,extraFields:A[t.data.template].extraFields?A[t.data.template].extraFields(o):{}})};var H={pages:{component:e=>{var t;let{pageState:a,initialItems:u,pageSession:_,extraData:w}=e,S={data:{web:!0,electron:!1,protected:!1,template:"blank"}};(0,N.useRouter)();let{replace:k}=(0,g.N)(a),[I,C]=(0,v.useState)(null!==(t=null==w?void 0:w.objects)&&void 0!==t?t:(0,j.E)("pending")),[$,z]=(0,v.useState)(!1);(0,p.useThemeName)();let[E,M]=(0,v.useState)(S),H=(0,h.Py)(),[J,R]=(0,v.useState)("");(0,O.rf)(()=>{R(""),M(S)},[$]),(0,y.a)(e=>{n.bl.get({url:V},e)},C,null==w?void 0:w.objects);let U=e=>{let t=L.T[document.location.hostname.split(".")[0]];return t&&t.baseUrl?t.baseUrl+e:e};return(0,r.jsxs)(o.D,{title:"Pages",pageSession:_,children:[(0,r.jsx)(P.a,{integratedChat:!0,p:"$2",pt:"$5",pl:"$5",setOpen:z,open:$,hideAccept:!0,description:"",children:(0,r.jsx)("div",{className:"  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _jc-center _ai-center ",children:(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1316330238 ",children:(0,r.jsx)(F,{lastButtonCaption:"Create",onFinish:async()=>{try{let e=s.L.load(E.data);if(A[E.data.template].extraValidation){let e=A[E.data.template].extraValidation(E.data);if(null==e?void 0:e.error)throw e.error}let t=await n.bl.post(T,e.create().getData());if(t.isError)throw t.error;z(!1),H.show("Page created",{message:e.getId()})}catch(e){console.log("original error: ",e),R((0,j.E)("error",null,e instanceof m.z.ZodError?e.flatten():e))}},slides:[{name:"Create new page",title:"Select your Template",component:(0,r.jsx)(B,{selected:null==E?void 0:E.data.template,setSelected:e=>M({...E,data:{...E.data,template:e}})})},{name:"Configure your page",title:"Configure your page",component:(0,r.jsx)(Z,{error:J,objects:I,setError:R,data:E,setData:M})}]})})})}),(0,r.jsx)(i.V,{integratedChat:!0,sourceUrl:T,initialItems:u,numColumnsForm:2,name:"page",rowIcon:()=>(0,r.jsx)(r.Fragment,{}),objectProps:{columnWidth:500},columns:l.Z.columns(l.Z.column("","",!0,e=>(0,r.jsx)("a",{href:U(e.route.startsWith("/")?e.route:"/"+e.route),target:"_blank",children:(0,r.jsx)(d.z,{Icon:f.d})}),!0,"50px"),l.Z.column("name","name",!0,e=>(0,r.jsx)(x.sL,{id:"pages-datatable-"+e.name,children:e.name})),l.Z.column("route","route",!0),l.Z.column("visibility","protected",!0,e=>e.protected?(0,r.jsx)(c.A,{text:"protected",color:"$gray5"}):(0,r.jsx)(c.A,{text:"public",color:"$color5"})),l.Z.column("permissions","permissions",!0,e=>e.permissions.map((e,t)=>(0,r.jsx)("div",{className:(0,D.concatClassName)(" _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  "+(t?" _ml-10px":" _ml-0px")),children:(0,r.jsx)(c.A,{text:e,color:"$gray5"})},t)))),onAddButton:()=>{z(!0)},extraMenuActions:[{text:"Edit Page file",icon:b.z,action:e=>{k("editFile",e.getDefaultFilePath())},isVisible:e=>!0}],model:s.L,pageState:a,icons:q})]})},getServerSideProps:(0,u.eq)(T,["admin"],{},async e=>({objects:await n.bl.get((0,w.VM)(V,e))}))}};a(73344);var J=a(97729),R=a.n(J);function U(e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R(),{children:(0,r.jsx)("title",{children:"Protofy - Pages"})}),(0,r.jsx)(H.pages.component,{...e})]})}},54283:function(e,t,a){"use strict";a.d(t,{$:function(){return l},J:function(){return o}});var r=a(94801),s=a(55858),i=a(53596);let n=(0,i.j)();class o{get(e,t){var a;return null!==(a=this.data[e])&&void 0!==a?a:t}getObjectSchema(){return this.objectSchema}getModelName(){return this.modelName}getLocation(){let e=this.objectSchema.is("location").getFields();if(!e.length)throw"Model error: "+this.getModelName()+" doesn't have location information";let t=e[0],a=this.objectSchema.getFieldKeyDefinition(t,"latKey"),r=this.objectSchema.getFieldKeyDefinition(t,"lonKey");if(this.data[t])return{lat:this.data[t][a],lon:this.data[t][r]}}getId(){return this.data[this.idField]}getNotificationsTopic(e){return"notifications/".concat(this.getModelName(),"/").concat(e,"/").concat(this.getId())}getNotificationsPayload(){return this.serialize()}setId(e,t){return new this.constructor({...t||this.data,[this.idField]:e},this.session,this.modelName)}isVisible(){return!this.isDeleted()}isDeleted(){return!!this.data._deleted}list(e,t,a,r){if(r){let{itemsPerPage:e,page:t,orderBy:a,orderDirection:s,search:i,token:n,...o}=r,l=Object.keys(o).every(e=>this.data&&this.data[e]==o[e]);if(!l)return}if(!e)return this.read();{let{parsed:t,searchWithoutTags:a}=function(e){let t;let a=/(\w+):("[^"]+"|\S+)/g,r={},s=e;for(;null!==(t=a.exec(e));){let e=t[1].toLowerCase(),a=t[2].replace(/"/g,"").toLowerCase();r[e]=a,s=s.replace(t[0],"")}return{parsed:r,searchWithoutTags:s=s.trim()}}(e);for(let[e,a]of Object.entries(t))if(!this.data.hasOwnProperty(e)||this.data[e]!=a)return;let r=this.objectSchema.is("search").getFields();for(var s=0;s<r.length;s++)if((this.data[r[s]]+"").toLowerCase().includes(a.toLowerCase()))return this.read()}}async listTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,i=this.list(e,a,r,s);if(i)return await this.getObjectSchema().apply("list",i,t)}create(e){let t=this.getData(e);return n.debug({transformed:t},"Creating object: ".concat(JSON.stringify(t))),new this.constructor(t,this.session,this.modelName).validate()}async createTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("create",{...this.data},e);return this.create(t)}read(e){return{...this.data}}async readTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=await this.getObjectSchema().apply("read",this.read(t),e);return a}update(e,t){return e.setId(this.getId(),{...t||e.data})}async updateTransformed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=await this.getObjectSchema().apply("update",{...e.data},t,{...this.data});return this.update(e,a)}delete(e){return new this.constructor({_deleted:!0,...e||this.data},this.session,this.modelName)}async deleteTransformed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await this.getObjectSchema().apply("delete",{...this.data},e);return this.delete(t)}validate(){return this.schema.parse(this.data),this}serialize(){return JSON.stringify(this.data)}static getApiOptions(){throw Error("Derived class must implement getApiOptions")}static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static unserialize(e,t){return this._newInstance(JSON.parse(e),t)}static load(e,t){return this._newInstance(e,t)}static sort(e,t,a){return e.sort((e,r)=>e[t]>r[t]?"asc"===a?1:-1:e[t]<r[t]?"asc"===a?-1:1:0)}getData(e){return{...this.getObjectSchema().applyGenerators(null!=e?e:this.data)}}constructor(e,t,a,i){var n,o;this.data=e,this.session=null!=a?a:(0,r.ed)(),this.schema=t,this.objectSchema=s.U.load(this.schema),this.modelName=null!==(n=null==i?void 0:i.toLowerCase())&&void 0!==n?n:"unknown";let l=this.objectSchema.is("id");l.getFields().length>1&&(l=l.isNot("fallbackId")),this.idField=null!==(o=l.getFirst("id"))&&void 0!==o?o:"id"}}class l extends o{static _newInstance(e,t){throw Error("Derived class must implement _newInstance.")}static createDerived(e,t,a,r){class s extends l{static _newInstance(e,t){return new s(e,t)}static getApiOptions(){return{name:a,prefix:r}}constructor(a,r){super(a,t,r,e.substring(0,e.length-5).toLowerCase())}}return s.schemaInstance=t,Object.defineProperty(s,"name",{value:e,writable:!1}),s}constructor(e,t,a,r){super(e,t,a,r)}}},52725:function(e,t,a){"use strict";a.d(t,{L:function(){return o}});var r=a(30195),s=a(75370),i=a(54283);let n=s.V_.object({name:r.z.string().search().id(),route:r.z.string().search(),permissions:r.z.array(r.z.string()).label("Permissions").generate(()=>[]),web:r.z.boolean().defaultValue(!0),electron:r.z.boolean().defaultValue(!1),protected:r.z.boolean().defaultValue(!1).label("Require user")});class o extends i.J{getDefaultFilePath(){return"/packages/app/bundles/custom/pages/"+this.data.name+".tsx"}static _newInstance(e,t){return new o(e,t)}constructor(e,t){super(e,n,t,"Page")}}},1888:function(e,t,a){"use strict";a.d(t,{F7:function(){return n},eq:function(){return o}});var r=a(46149),s=a(6429),i=a(48115);let n=e=>r.l.SSR?e:void 0;function o(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return n(async n=>{var o,l,d,c,u,m;let p={itemsPerPage:parseInt(n.query.itemsPerPage)?parseInt(n.query.itemsPerPage):"",page:parseInt(n.query.page,10)?parseInt(n.query.page,10):"",search:null!==(o=n.query.search)&&void 0!==o?o:"",orderBy:null!==(l=n.query.orderBy)&&void 0!==l?l:"",orderDirection:null!==(d=n.query.orderDirection)&&void 0!==d?d:"",view:null!==(c=n.query.view)&&void 0!==c?c:"",item:null!==(u=n.query.item)&&void 0!==u?u:"",editFile:null!==(m=n.query.editFile)&&void 0!==m?m:"",..."function"==typeof a?await a(n):a},_="function"==typeof e?e(n):e;return(0,s.NA)(n,t,{sourceUrl:_,initialItems:await i.bl.get({url:(0,s.VM)(_,n),...p}),itemData:n.query.item?await i.bl.get((0,s.VM)(_+"/"+n.query.item,n)):"",extraData:{..."function"==typeof r?await r(n):r},pageState:{...p}})})}},57117:function(){},6410:function(){},73344:function(){}},function(e){e.O(0,[8641,8081,4733,1335,8873,2859,6313,3950,3057,9613,7369,2905,1004,6076,8404,7594,9774,2888,179],function(){return e(e.s=17165)}),_N_E=e.O()}]);