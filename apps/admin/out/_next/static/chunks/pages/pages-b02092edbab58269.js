(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2158],{68918:function(e,t,s){"use strict";s.d(t,{d:function(){return l}});var r=s(78161),a=s(2784),o=s(87656),n=s(52322);let i=e=>{let{color:t="black",size:s=24,...r}=e;return(0,n.jsxs)(o.Svg,{width:s,height:s,viewBox:"0 0 24 24",fill:"none",stroke:`${t}`,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...r,children:[(0,n.jsx)(o.Path,{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",stroke:`${t}`}),(0,n.jsx)(o.Polyline,{points:"15 3 21 3 21 9",stroke:`${t}`}),(0,n.jsx)(o.Line,{x1:"10",x2:"21",y1:"14",y2:"3",stroke:`${t}`})]})};i.displayName="ExternalLink";let l=(0,a.memo)((0,r.H)(i))},17165:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/pages",function(){return s(27291)}])},27291:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return q}});var r=s(52322),a=s(52725),o=s(13997),n=s(48115),i=s(40214),l=s(50897),d=s(71932),_=s(79562),c=s(1888),p=s(30195),x=s(52026),m=s(89929),u=s(53763),b=s(8939),f=s(68918),h=s(89560),j=s(82695),g=s(6429),w=s(2784),v=s(6289),N=s(26887),P=s(5632),k=s(51813),y=s(66306),$=s(91838);let z="  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-600 _fos-16px _col-791969588 ",C=e=>{let{slides:t,lastButtonCaption:s,onFinish:a}=e,[o,n]=(0,w.useState)(0),i=t.length,l=o>1?o-1:0,d=o<i-1?o+1:null,_=t.filter((e,t)=>t<=o).map(e=>e.name).join(" / ");return(0,r.jsxs)(b.FA,{id:"admin-dataview-create-dlg",w:800,mah:700,p:"$3",f:1,children:[(0,r.jsxs)(b.sL,{id:"admin-eo",mt:"$4",justifyContent:"space-between",width:"100%",children:[(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 ",children:(0,r.jsx)("span",{className:z,children:_})}),(0,r.jsx)("div",{className:"  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _ai-flex-end ",children:(0,r.jsxs)("span",{className:z,children:["[",o+1,"/",i,"]"]})})]}),(0,r.jsx)($.I,{children:(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",children:(0,r.jsx)("span",{className:"  _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _fow-600 _fos-34px _col-549765294 ",children:t[o].title})})}),(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mt-1316330269 ",children:t[o].component}),(0,r.jsxs)("div",{className:"  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _gap-40px _jc-center _mb-1316330238 _fg-1 _ai-flex-end ",children:[0!==o?(0,r.jsx)(y.zx,{w:250,onPress:e=>{e.stopPropagation(),o>0&&n(l)},children:"Back"}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)($.I,{children:(0,r.jsx)(y.zx,{id:"admin-pages-add-btn",w:250,onPress:async e=>{e.stopPropagation(),d?n(d):a&&await a()},children:i===o+1?s:"Next"})})]})]})};s(6410);var E=s(24066),S=s(57643),F=s(82614),V=s(22287),A=s(70396),I=e=>{let{template:t,isSelected:s,onPress:a,theme:o}=e,[n,i]=(0,w.useState)(!1),l="/images/templates/".concat(t,"-").concat(o,".png");return(0,r.jsx)($.I,{children:(0,r.jsxs)(b.FA,{id:"pages-template-"+t,onPress:a,onHoverIn:()=>i(!0),onHoverOut:()=>i(!1),overflow:"hidden",borderWidth:s?"$1":"$0.5",borderColor:s?"$color7":"$gray8",cursor:"pointer",borderRadius:"$3",children:[(0,r.jsx)(V.E,{source:{height:180,width:357,uri:l}}),(0,r.jsx)("div",{className:(0,A.concatClassName)(" _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _mih-0px _miw-0px _fs-0  _zi-10000 _pos-absolute _r-1481558214 _t-1481558214  "+(n?" _dsp-block":" _dsp-none")),children:(0,r.jsx)(F.p,{target:"_blank",href:l,children:(0,r.jsx)(y.zx,{backgroundColor:"$color7",size:"$1.5",borderRadius:"$1",px:"$2",textProps:{size:"$1"},onPress:e=>{e.stopPropagation()},children:"preview"})})}),(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _jc-441309761 _btw-1481558338 _btc-791969557 _brc-791969557 _bbc-791969557 _blc-791969557 _bg-791969402 _pt-1481558276 _pb-1481558276 _pr-1481558214 _pl-1481558214 _bts-solid ",children:(0,r.jsx)("p",{className:"  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",children:t})})]})})};s(57117);var L=s(81974);let Z={},D="/adminapi/v1/pages",O="/adminapi/v1/objects?all=1",T={blank:{},default:{},admin:{extraFields:e=>{var t;return{object:p.z.union([...e&&e.data?null===(t=e.data)||void 0===t?void 0:t.items.filter(e=>e.features&&e.features.AutoAPI).map(e=>p.z.literal(e.name)):[]]).after("route")}},extraValidation:e=>{if(!Object.keys(e).includes("object"))return{error:"object cant be empty"}}},landing:{},ecomerce:{},about:{},newsfeed:{}},H=e=>{let{children:t}=e;return(0,r.jsx)("div",{className:"  _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _jc-center _ai-center _gap-25px _fw-wrap ",children:t})},B=e=>{let{selected:t,setSelected:s}=e,a=(0,x.useThemeName)();return(0,r.jsxs)("div",{className:"  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 ",children:[(0,r.jsx)(m.p,{mah:"500px",children:(0,r.jsx)(H,{children:Object.keys(T).map(e=>(0,r.jsx)(I,{theme:a,template:e,isSelected:t==e,onPress:()=>s(e)}))})}),(0,r.jsx)("span",{className:"  is_Spacer _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-1316330176 _miw-1316330176 _fs-0 _w-1316330176 _h-1316330176 _pe-none _mb-1316330331 "})]})},R=e=>{let{data:t,setData:s,error:o,setError:n,objects:i}=e;return(0,r.jsx)(E.G,{externalErrorHandling:!0,error:o,setError:n,data:t,setData:s,name:"page",numColumns:2,mode:"add",title:"",model:a.L,extraFields:T[t.data.template].extraFields?T[t.data.template].extraFields(i):{}})};var W={pages:{component:e=>{var t;let{pageState:s,initialItems:c,pageSession:m,extraData:g}=e,y={data:{web:!0,electron:!1,protected:!1,template:"blank"}};(0,P.useRouter)();let{replace:$}=(0,j.N)(s),[z,E]=(0,w.useState)(null!==(t=null==g?void 0:g.objects)&&void 0!==t?t:(0,v.E)("pending")),[F,V]=(0,w.useState)(!1);(0,x.useThemeName)();let[I,H]=(0,w.useState)(y),W=(0,u.Py)(),[M,U]=(0,w.useState)("");(0,S.rf)(()=>{U(""),H(y)},[F]),(0,N.a)(e=>{n.bl.get({url:O},e)},E,null==g?void 0:g.objects);let q=e=>{let t=L.T[document.location.hostname.split(".")[0]];return t&&t.baseUrl?t.baseUrl+e:e};return(0,r.jsxs)(i.D,{title:"Pages",pageSession:m,children:[(0,r.jsx)(k.a,{integratedChat:!0,p:"$2",pt:"$5",pl:"$5",setOpen:V,open:F,hideAccept:!0,description:"",children:(0,r.jsx)("div",{className:"  _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _jc-center _ai-center ",children:(0,r.jsx)("div",{className:"  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0 _mr-1316330238 ",children:(0,r.jsx)(C,{lastButtonCaption:"Create",onFinish:async()=>{try{let e=a.L.load(I.data);if(T[I.data.template].extraValidation){let e=T[I.data.template].extraValidation(I.data);if(null==e?void 0:e.error)throw e.error}let t=await n.bl.post(D,e.create().getData());if(t.isError)throw t.error;V(!1),W.show("Page created",{message:e.getId()})}catch(e){console.log("original error: ",e),U((0,v.E)("error",null,e instanceof p.z.ZodError?e.flatten():e))}},slides:[{name:"Create new page",title:"Select your Template",component:(0,r.jsx)(B,{selected:null==I?void 0:I.data.template,setSelected:e=>H({...I,data:{...I.data,template:e}})})},{name:"Configure your page",title:"Configure your page",component:(0,r.jsx)(R,{error:M,objects:z,setError:U,data:I,setData:H})}]})})})}),(0,r.jsx)(o.V,{integratedChat:!0,sourceUrl:D,initialItems:c,numColumnsForm:2,name:"page",rowIcon:()=>(0,r.jsx)(r.Fragment,{}),objectProps:{columnWidth:500},columns:l.Z.columns(l.Z.column("","",!0,e=>(0,r.jsx)("a",{href:q(e.route.startsWith("/")?e.route:"/"+e.route),target:"_blank",children:(0,r.jsx)(d.z,{Icon:f.d})}),!0,"50px"),l.Z.column("name","name",!0,e=>(0,r.jsx)(b.sL,{id:"pages-datatable-"+e.name,children:e.name})),l.Z.column("route","route",!0),l.Z.column("visibility","protected",!0,e=>e.protected?(0,r.jsx)(_.A,{text:"protected",color:"$gray5"}):(0,r.jsx)(_.A,{text:"public",color:"$color5"})),l.Z.column("permissions","permissions",!0,e=>e.permissions.map((e,t)=>(0,r.jsx)("div",{className:(0,A.concatClassName)(" _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-0  "+(t?" _ml-10px":" _ml-0px")),children:(0,r.jsx)(_.A,{text:e,color:"$gray5"})},t)))),onAddButton:()=>{V(!0)},extraMenuActions:[{text:"Edit Page file",icon:h.z,action:e=>{$("editFile",e.getDefaultFilePath())},isVisible:e=>!0}],model:a.L,pageState:s,icons:Z})]})},getServerSideProps:(0,c.eq)(D,["admin"],{},async e=>({objects:await n.bl.get((0,g.VM)(O,e))}))}};s(73344);var M=s(97729),U=s.n(M);function q(e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U(),{children:(0,r.jsx)("title",{children:"Protofy - Pages"})}),(0,r.jsx)(W.pages.component,{...e})]})}},52725:function(e,t,s){"use strict";s.d(t,{L:function(){return i}});var r=s(30195),a=s(75370),o=s(54283);let n=a.V_.object({name:r.z.string().search().id(),route:r.z.string().search(),permissions:r.z.array(r.z.string()).label("Permissions").generate(()=>[]),web:r.z.boolean().defaultValue(!0),electron:r.z.boolean().defaultValue(!1),protected:r.z.boolean().defaultValue(!1).label("Require user")});class i extends o.J{getDefaultFilePath(){return"/packages/app/bundles/custom/pages/"+this.data.name+".tsx"}static _newInstance(e,t){return new i(e,t)}constructor(e,t){super(e,n,t,"Page")}}},57117:function(){},6410:function(){},73344:function(){}},function(e){e.O(0,[8641,8081,4733,1335,8873,2859,6313,3950,9331,4092,9927,6116,9498,1967,5619,9884,995,1004,4152,8676,767,1773,8859,4305,9774,2888,179],function(){return e(e.s=17165)}),_N_E=e.O()}]);