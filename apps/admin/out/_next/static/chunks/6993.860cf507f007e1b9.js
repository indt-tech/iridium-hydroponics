"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6993],{72555:function(e,t,n){n.r(t),t.default={src:"/admin/_next/static/media/logo.12766b1b.png",height:572,width:572,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAdVBMVEUBAgIAAgIBAQEAAQEBAgIBAQEBAQEAAQEAAQEAAQEAAQEBAgIBAQEBAgIBAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQEAAQGs73SBAAAAJ3RSTlMAAAAAAQEEBgcNDxsbHR0vMTU2P0BKX2RmZ3J0e31/goiQkpaXnZ4UCFX1AAAARUlEQVR42gVABRKAIBBcXQM74QxEDPz/Ex3EbJ+3IZBKGMYgCYwHCW+wzJlz+bRCdHSckRaIZVHSCtR+V/W1KZD9FzryB5lZBEw3DyQBAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8}},6993:function(e,t,n){let i,r,o;n.r(t),n.d(t,{default:function(){return eD},newVisualUiContext:function(){return q},useVisualUi:function(){return X},useVisualUiAtom:function(){return W},useVisualUiComms:function(){return G}});var l=n(52322),s=n(2784),a=n(5632),d=n(8293),c=n(7771),u=n(18299),p=n(28316),h=n(60163),f=n(50637),g=n(40178),x=n(81267),m=n(32678),v=n(9944),y=n(8939),E=n(86838),b={nodeBackgroundColor:"#252526",interactiveHoverColor:"#4772b330",interactiveColor:"#4772b3",inputBackgroundColor:"#404040",borderColor:"grey",blockPort:"grey",flowPort:"grey",dataPort:"grey",textColor:"#CCCCCC",dataOutputColor:"grey",nodeBorderColor:"grey",edgeColor:"grey",titleColor:"black"},C=n(98982),w=n(70549),A=e=>{var t;let{name:n,color:i,size:r}=e,o=null!==(t=C[n])&&void 0!==t?t:w.Z;return(0,l.jsx)(o,{color:i,size:r})};let j=(0,s.forwardRef)((e,t)=>{let{...n}=e;return(0,l.jsx)("div",{ref:t,...n,style:{cursor:"pointer",padding:"6px",borderRadius:"2px",...n.style,backgroundColor:n.backgroundColor}})}),k=e=>{var t;let{render:n,onEnableEvents:i}=e,{id:r}=(0,d.Zo)(),{actions:o,query:a,isActive:c}=(0,d.jE)((e,t)=>({isActive:t.getEvent("selected").contains(r)})),{isHover:C,dom:w,name:k,moveable:S,deletable:J,connectors:{drag:I},parent:N,childs:P,nodeAndSiblings:z,nodeId:T,unknown:O,setProp:D,custom:K,props:L}=(0,d.Zo)(e=>{var t,n,i;return{custom:e.data.custom,unknown:null!==(i=e.data.custom.unknown)&&void 0!==i&&i,nodeId:e.id,isHover:e.events.hovered,dom:e.dom,name:e.data.custom.displayName||e.data.displayName,moveable:a.node(e.id).isDraggable(),deletable:a.node(e.id).isDeletable()&&a.node(e.id).isDraggable(),parent:e.data.parent,props:e.data.props,childs:e.data.nodes,nodeAndSiblings:(null===(t=e.data)||void 0===t?void 0:t.parent)?a.node(null===(n=e.data)||void 0===n?void 0:n.parent).childNodes():void 0}}),B=O?"#EF9364":"#2680EB",R="1px solid gray",Q=(0,s.useRef)();(0,s.useEffect)(()=>{w&&(c?w.style.boxShadow="inset 0px 0px 0px 2px "+B:C?w.style.boxShadow="inset 0px 0px 0px 1px "+B:w.style.boxShadow="")},[w,c,C]);let Z=(0,s.useCallback)(e=>{let{top:t,left:n,bottom:i}=e?e.getBoundingClientRect():{top:0,left:0,bottom:0};return{top:(t>100?t-60:i-50)+"px",left:n+"px"}},[]),F=(0,s.useCallback)(()=>{let{current:e}=Q;if(!e)return;let{top:t,left:n}=Z(w);e.style.top=t,e.style.left=n},[w,Z]);(0,s.useEffect)(()=>{var e,t;return null===(t=document)||void 0===t||null===(e=t.querySelector(".craftjs-renderer"))||void 0===e||e.addEventListener("scroll",F),()=>{var e,t;null===(t=document)||void 0===t||null===(e=t.querySelector(".craftjs-renderer"))||void 0===e||e.removeEventListener("scroll",F)}},[F]);let V=e=>(0,l.jsx)("div",{style:{height:50,borderLeft:R}});return(0,l.jsxs)(l.Fragment,{children:[c?p.createPortal((0,l.jsxs)("div",{id:"my-renderedNode",ref:Q,style:{left:Z(w).left,top:Z(w).top,zIndex:1e31,position:"fixed",backgroundColor:b.nodeBackgroundColor,border:R,padding:"6px",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center",height:50,pointerEvents:"auto",gap:"6px"},children:[(0,l.jsxs)("div",{style:{fontSize:14,color:"white",padding:"10px 20px"},children:[k,O?" (Unknown)":""]}),(0,l.jsx)(V,{}),(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"row",flex:1,gap:"6px",alignItems:"center"},children:[S?(0,l.jsx)(j,{ref:I,style:{cursor:"grab"},title:"Move",children:(0,l.jsx)(h.Z,{color:"white",size:20})}):null,r!==u.QS&&"ROOT"!=N?(0,l.jsx)(j,{title:"Select parent",children:(0,l.jsx)(f.Z,{onMouseDown:e=>{o.selectNode(N),e.stopPropagation()},color:"white",size:20})}):null,P.length?(0,l.jsx)(j,{title:"Select first child",children:(0,l.jsx)(g.Z,{onMouseDown:e=>{o.selectNode(P[0]),e.stopPropagation()},color:"white",size:20})}):null,(null==z?void 0:z.length)>1?(0,l.jsx)(j,{title:"Select next sibling",children:(0,l.jsx)(x.Z,{onMouseDown:e=>{let t=z.indexOf(T),n=(t+1)%z.length,i=z[n];o.selectNode(i),e.stopPropagation()},color:"white",size:20})}):null,K.shortcuts?(0,l.jsxs)(y.sL,{ai:"center",gap:"6px",children:[(0,l.jsx)(V,{}),K.shortcuts.map((e,t)=>{var n;let r=null!=e&&!!e.selected&&e.selected(L);return(0,l.jsxs)(E.J2,{placement:"top",onOpenChange:i,children:[(0,l.jsx)(E.J2.Trigger,{children:(0,l.jsx)(j,{backgroundColor:r?"white":"",onClick:e.action?()=>e.action({setProp:D,dom:w}):null,children:(0,l.jsx)(A,{name:e.icon(L),color:r?b.nodeBackgroundColor:"white",size:20})})}),e.menu?(0,l.jsx)(E.J2.Content,{gap:"$4",br:"$0",shadowRadius:"$4",shadowColor:"black",boc:"gray",bw:"1px",shadowOpacity:.6,bc:b.nodeBackgroundColor,maxHeight:"350px",overflow:"scroll",overflowX:"hidden",children:null===(n=e.menu)||void 0===n?void 0:n.map(e=>(0,l.jsx)("div",{style:{cursor:"pointer",alignSelf:"flex-start"},onClick:t=>{t.stopPropagation(),e.action({setProp:D,dom:w})},children:(0,l.jsx)("div",{children:e.name})}))}):null]},t)}),(0,l.jsx)(V,{})]}):null,J?(0,l.jsx)(j,{title:"Delete",id:"render-node-delete-btn",onClick:e=>{e.stopPropagation(),o.delete(r)},children:(0,l.jsx)(m.Z,{color:"white",size:20})}):null,K.options?(0,l.jsxs)(E.J2,{placement:"top",onOpenChange:i,children:[(0,l.jsx)(V,{}),(0,l.jsx)(E.J2.Trigger,{children:(0,l.jsx)(j,{title:"Delete",id:"render-node-delete-btn",children:(0,l.jsx)(v.Z,{color:"white",size:20})})}),(0,l.jsx)(E.J2.Content,{gap:"$4",br:"$0",shadowRadius:"$4",shadowColor:"black",boc:"gray",bw:"1px",shadowOpacity:.6,bc:b.nodeBackgroundColor,children:null===(t=K.options)||void 0===t?void 0:t.map(e=>(0,l.jsx)("div",{style:{cursor:"pointer",alignSelf:"flex-start"},onClick:t=>{t.stopPropagation(),e.action({setProp:D,dom:w})},children:(0,l.jsx)("div",{children:e.name})}))})]}):null]})]}),document.querySelector(".page-container")):null,n]})},S=e=>(0,l.jsx)(l.Fragment,{});S.craft={props:{},related:{settings:()=>(0,l.jsx)("div",{})}};let J=e=>(0,l.jsx)(l.Fragment,{children:e.children});J.craft={props:{},related:{settings:()=>(0,l.jsx)("div",{})}};let I=e=>{var t;let{connectors:{connect:n},setProp:i}=(0,d.Zo)(e=>({selected:e.events.selected,custom:e.data.custom}));return(0,l.jsx)("div",{ref:n,style:{minHeight:"30px"},children:null!==(t=e.children)&&void 0!==t?t:"Unknown"})};I.craft={props:{},related:{settings:()=>(0,l.jsx)("div",{})}};var N={craft:{Root:J,Unknown:I,ReactCode:S}},P=n(97729),z=n.n(P),T=n(45054),O=n(85067),D=n.n(O),K=n(20477);class L{static parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new K.IKL({useInMemoryFileSystem:!0,manipulationSettings:{indentationText:K.xI4.Tab},compilerOptions:{target:K.H7j.Latest,scriptKind:K.hVH.TSX,languageVariant:K.C$L.JSX}});return new L(n.createSourceFile("_temp2.tsx",e,{overwrite:!0}),t)}data(e){e&&this.identifyElements(e);let t=this.getContent(),n=this.toCraftNodes(t);return this.addCustomProps(n)}getContent(){return this.getFirstDescendant("JsxElement")}getFirstDescendant(e){var t,n;let i=K.lGB[e];return e?null===(t=this.ast)||void 0===t?void 0:t.getFirstDescendantByKind(i):null===(n=this.ast)||void 0===n?void 0:n.getFirstDescendant()}getAllJsxElements(e){let t=this.getAllJsxChildren(e),n=[e,...t];return n}getAttributes(e){let t=this.isKind(e,"JsxElement"),n=this.isKind(e,"JsxSelfClosingElement"),i=this.isKind(e,"JsxExpression");if(!e||!t&&!n&&!i)throw"Not valid node to get attributes";return t?this.getJsxElementAttributes(e):n?this.getJsxSelfClosingElementAttributes(e):i?[]:void 0}getJsxAttribute(e,t){if(!e||!this.isKind(e,"JsxElement")&&!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxElement or JsxSelfClosingElement, can't get the specified attribute";let n=this.getAttributes(e).find(e=>e.getNameNode().getText()==t);if(!n)throw"Can't get attribute ".concat(t);return n}getAttributeKey(e){if(!e||!this.isKind(e,"JsxAttribute"))throw"Can't get attribute key, the node provided isn't a JsxAttribute";return e.getNameNode().getText()}getAttributeValue(e){if(!e||!this.isKind(e,"JsxAttribute"))throw"Can't get attribute value, the node provided isn't a JsxAttribute";return e.getInitializer()}getJsxElementAttributes(e){if(!e||!this.isKind(e,"JsxElement"))throw"Error node provided is not a JsxElement, can't get its attributes";return e.getOpeningElement().getAttributes()}getJsxSelfClosingElementAttributes(e){if(!e||!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxSelfClosingElement, can't get its attributes";return e.getAttributes()}getJsxElementName(e){let t=this.isKind(e,"JsxElement"),n=this.isKind(e,"JsxSelfClosingElement"),i=this.isKind(e,"JsxExpression");if(!e||!t&&!n&&!i)throw"Not valid node to get Name";return t?this.getJsxElementIdentifier(e):n?this.getJsxSelfClosingElementIdentifier(e):i?{name:"ReactCode"}:void 0}getJsxElementIdentifier(e){if(!e||!this.isKind(e,"JsxElement"))throw"Error node provided is not a JsxElement, can't get its Identifier";let t=e.getOpeningElement(),n=t.getTagNameNode(),i=n.getText();return{node:n,name:i}}getJsxSelfClosingElementIdentifier(e){if(!e||!this.isKind(e,"JsxSelfClosingElement"))throw"Error node provided is not a JsxSelfClosingElement, can't get its Identifier";let t=e.getTagNameNode(),n=t.getText();return{node:t,name:n}}getJsxChildren(e){if(this.isKind(e,"JsxSelfClosingElement"))throw"Can't obtain children from JsxSelfClosingElement";if(!e||!this.isKind(e,"JsxElement"))throw"Can't obtain node children";let t=e.getChildrenOfKind(K.lGB.SyntaxList)[0],n=t.getChildren();return n}getJsxTextOfJsxElement(e){if(this.isKind(e,"JsxExpression")||this.isKind(e,"JsxSelfClosingElement"))return;let t=this.getJsxChildren(e);if(t.length&&this.isKind(t[0],"JsxText"))return t[0]}getJsxChildrenFirstLevel(e){if(!(this.isKind(e,"JsxSelfClosingElement")||this.isKind(e,"JsxExpression")))return this.getJsxChildren(e).filter(e=>this.isKind(e,"JsxElement")||this.isKind(e,"JsxSelfClosingElement")||this.isKind(e,"JsxExpression"))}getAllJsxChildren(e){var t;let n;try{(n=this.getJsxChildrenFirstLevel(e)).forEach(e=>{n=[...n,...this.getAllJsxChildren(e)]})}catch(e){}return null!==(t=null==n?void 0:n.sort((e,t)=>e.getPos()-t.getPos()))&&void 0!==t?t:[]}isKind(e,t){return t==e.getKindName()}getNodeData(e){let t=this.getJsxElementName(e).name,n=this.getAttributes(e),i={},r={_nodeType:e.getKindName()};n.forEach(e=>{let t=this.getAttributeKey(e),n=this.getAttributeValue(e),{value:o,nodeKind:l}=this.nodeValueFactory(n);o&&t&&(i={...i,[t]:o}),l&&t&&(r={...r,[t]:l})});let o=this.getJsxTextOfJsxElement(e);return o&&o.getText()&&(i={...i,children:o.getText()},r={...r,children:"StringLiteral"}),{type:{resolvedName:t},isCanvas:!0,props:i,displayName:t,custom:r,hidden:!1,nodes:[],linkedNodes:{}}}flatten(e,t,n){var i;if(!e||!this.isKind(e,"JsxElement")&&!this.isKind(e,"JsxSelfClosingElement")&&!this.isKind(e,"JsxExpression"))return;let r=null!==(i=this.getIdentifier(e))&&void 0!==i?i:this.getIdFromSourceCode(e),o=this.getNodeData(e),l=[],s=this.getJsxChildrenFirstLevel(e);for(let e=0;e<(null==s?void 0:s.length);e++){let n=s[e];l.push(this.flatten(n,t,r))}let a={...o,nodes:l,parent:n};return t[r]=a,r}getNodes(e){if(!e||!this.isKind(e,"JsxElement"))throw"Can't getNodes from the give node that has no kind of type JsxElement";let t={};if(this.flatten(e,t,"ROOT"),!e||!this.isKind(e,"JsxElement"))throw"Can't getNodes from the give node that has no kind of type JsxElement";return t}toCraftNodes(e){var t;let n={type:{resolvedName:"Root"},isCanvas:!0,props:{"data-cy":"root-container"},displayName:"Root",custom:{},hidden:!1,nodes:[],linkedNodes:{}},i=this.getNodes(e),r=null===(t=Object.keys(i))||void 0===t?void 0:t.find(e=>"ROOT"==i[e].parent),o={};return r?(n={...n,nodes:[...n.nodes,r]},o={...i,ROOT:n}):o={ROOT:n},o}addCustomProps(e){let t=this.getImportDeclarations(),n={};return Object.keys(e).forEach(i=>{let r=e[i],o=this.getDisplayNameInNamedImports(r.displayName,t),l={...r,custom:{...r.custom,...o}};n={...n,[i]:l}}),n}getImportDeclarations(){let e=this.ast.getImportDeclarations(),t=[];return e.forEach(e=>{var n,i;let r=e.getNamedImports().length?e.getNamedImports():void 0,o=null==r?void 0:r.map(e=>{var t;return{name:e.getName(),alias:null===(t=e.getAliasNode())||void 0===t?void 0:t.getText()}}),l=null===(n=e.getDefaultImport())||void 0===n?void 0:n.getText(),s=null===(i=e.getModuleSpecifier())||void 0===i?void 0:i.getText();t=[...t,{namedImports:o,defaultImport:l,moduleSpecifier:s}]}),t}getDisplayNameInNamedImports(e,t){for(let n=0;n<(null==t?void 0:t.length);n++){let i=t[n],r=null==i?void 0:i.namedImports,o=null==i?void 0:i.defaultImport,l=null==i?void 0:i.moduleSpecifier;if(o===e)return{defaultImport:e,moduleSpecifier:l};if(r)for(let t=0;t<(null==r?void 0:r.length);t++){let n=r[t],i=null==n?void 0:n.name,o=null==n?void 0:n.alias;if(o===e||i===e)return{namedImportName:i,namedImportAlias:o,moduleSpecifier:l}}}return{}}identifyElements(e){let t=this.getAllJsxElements(this.getContent());for(let n=0;n<t.length;n++){let i,r="";t=this.getAllJsxElements(this.getContent());let o=this.getAttributes(t[n]);try{this.getJsxAttribute(t[n],"_nodeId")}catch(i){r+=' _nodeId="'.concat(e?e():this.getSameIdAsFlows(t[n]),'" ')}i=o.length?o[0].getStart():this.getJsxElementName(t[n]).node.getEnd(),this.ast.insertText(i,e=>e.write(r))}return this}getIdentifier(e){try{let t=this.getJsxAttribute(e,"_nodeId"),n=this.getAttributeValue(t);return this.nodeValueFactory(n).value}catch(e){console.error("Could not find node identifier")}}unidentifyElements(){let e=this.getAllJsxElements(this.getContent());for(let t=0;t<e.length;t++){e=this.getAllJsxElements(this.getContent());try{let n=this.getJsxAttribute(e[t],"_nodeId");this.ast.removeText(n.getStart(),n.getEnd())}catch(e){}}return this}getJsxElementByIdentifier(e,t){let n=this.getAllJsxElements(e),i=n.find(e=>this.getIdentifier(e)==t);if(!i)throw'Could not find element specified with uuid "'.concat(t,'" in the provided node');return i}convertJsxExpressionToJsxElement(){let e=()=>{let e=this.getContent();return this.getAllJsxElements(e).filter(e=>"JsxExpression"==e.getKindName())},t=n=>{n.length&&(this.ast.replaceText([n[0].getPos(),n[0].getEnd()],""),t(e()))};return t(e()),this}reactElementFactory(e,t){let n;let i=e.displayName;if("ReactCode"===i){let t=e.props.codeBlock;n="".concat(t)}else{let r,o="";if(Object.keys(e.props).filter(e=>!["_nodeId"].includes(e)).forEach(t=>{let n=e.props[t];if("StringLiteral"==e.custom[t]&&"children"!=t&&(n='"'.concat(n,'"')),"children"==t){r=n;return}void 0===n?o+=" ".concat(t):o+=" ".concat(t,"=").concat(n)}),"JsxSelfClosingElement"===e.custom._nodeType){let e=r?' children="'.concat(r,'"'):"";n="<"+"".concat(i)+o+e+"/>"}else n="<"+"".concat(i)+o+">"+"".concat(null!=r?r:"")+t+"</"+"".concat(i)+">"}return n}nodeValueFactory(e){let t;var n,i,r,o=null==e?void 0:e.getKindName();if("StringLiteral"===o)t=null==e?void 0:e.getLiteralValue();else{let l=null==e?void 0:e.getExpression(),s=null==l?void 0:l.getKindName();switch(s){case"StringLiteral":case"NumericLiteral":case"TrueKeyword":case"FalseKeyword":t=l.getLiteralValue(),o=s;break;case"ObjectLiteralExpression":let a=l.getProperties().reduce((e,t)=>{var n,i,r=t.getName();try{n=null===(i=t.getInitializer())||void 0===i?void 0:i.getLiteralValue()}catch(e){n=t.getInitializer().getText()}return{...e,[r]:n}},{});t=a,o=s;break;case"Identifier":if((null===(n=this.metadata)||void 0===n?void 0:n.context)&&(null===(i=this.metadata)||void 0===i?void 0:i.context[l.getText()])!=void 0){t=null===(r=this.metadata)||void 0===r?void 0:r.context[l.getText()];break}default:t=null==e?void 0:e.getText()}}return{value:t,nodeKind:o}}getIdFromSourceCode(e){try{return e.getKindName()+"_"+e._compilerNode.pos+"_"+e._compilerNode.end}catch(t){return e}}constructor(e,t){this.ast=e,this.metadata=t}}var B=n(64509),R=n(52026);class Q extends s.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}render(){if(this.state.hasError){var e;return(0,l.jsx)(R.Stack,{style:{height:"100vh",justifyContent:"center",alignItems:"center"},children:(0,l.jsxs)(y.FA,{width:"80%",maxWidth:"600px",alignItems:"center",children:[(0,l.jsx)(R.Text,{children:"Can not render Visual UI frame due the following error:"}),(0,l.jsx)(R.Text,{color:"red",marginTop:"10px",children:null===(e=this.state.error)||void 0===e?void 0:e.message})]})})}return this.props.children}constructor(e){super(e),this.state={hasError:!1}}}var Z=n(28261),F=n.n(Z),V=n(29691),M=n.n(V),_=n(4065),U=n(1594),$=n(29392),H=n(752);function q(e){return(0,d._i)(e)}function W(e){let t=null!=e?e:null;return t?(0,H.KO)(t):[null,null]}function X(e,t,n){if(e){let[i]=(0,H.KO)(e),[r,o]=(0,s.useState)(null),[l,a]=(0,s.useState)(null),[d,c]=(0,s.useState)(null!=n?n:null);return(0,s.useEffect)(()=>{i&&i.subscribe&&i.subscribe(e=>{c(e=>{let n=t&&t(e,i);return null!=n?n:e})},()=>{})},[i]),(0,s.useEffect)(()=>{if(i.history.timeline.length<1)return;if(null===l&&null===r){o(i.query.serialize());return}let e=JSON.parse(i.query.serialize()),t=D().diff(JSON.parse(r),e);if(console.log("in-dev: diffs",t),!(t.length<1)){if(t.find(e=>"N"==e.kind))console.log("in: add",t.find(e=>"N"==e.kind).path,t.find(e=>"N"==e.kind)),a({action:"add-node"});else if(t.find(e=>"D"==e.kind)){let e=t.filter(e=>"D"==e.kind).map(e=>e.path[0]),n=t.find(e=>"A"==e.kind).path[0];a({action:"delete-node",deletedNodes:e,parent:n})}else t.find(e=>"E"==e.kind)&&(console.log("in: edit",t.find(e=>"E"==e.kind).path,t.find(e=>"E"==e.kind)),a({action:"add-node"}))}},[i.query.serialize()]),{actions:i.actions,query:i.query,state:d,lastEvent:l}}throw Error("useVisualUi(...) must have a defined atom")}function G(e,t,n,i,r){let{actions:o,query:l}=e,{resolveComponentsDir:d,appendNewNodeToTree:c}=t,u=(0,a.useRouter)(),p=u.query;if("true"===p.experimental_comms){console.log("protocraft experimental communications");let{lastEvent:e}=X(r);(0,s.useEffect)(()=>{console.log("in: event",e)},[e])}else console.log("protocraft legacy communications"),(0,s.useEffect)(()=>{let e=i.action,t=i.nodeId,r=i.value,s=i.param;switch(e){case"delete-node":var a;if("JsxElement"!=i.deletedNodeType)return;o.setOptions(e=>e.skipTopic=!0),null===(a=i.nodesToDelete)||void 0===a||a.forEach(e=>o.delete(e)),n(JSON.parse(l.serialize()));break;case"delete-data":if(!s)return;try{o.setOptions(e=>e.skipTopic=!0),o.setProp(t,e=>(delete e[s],e)),n(JSON.parse(l.serialize()))}catch(e){console.error("error deleting data. ",e)}break;case"edit-data":if(!s)return;try{o.setOptions(e=>e.skipTopic=!0),o.setProp(t,e=>e[s]=r),o.setCustom(t,e=>e[s]="JsxText");let e=null==i?void 0:i.deleteKey;e&&o.setProp(t,t=>(delete t[e],t)),n(JSON.parse(l.serialize()))}catch(e){console.error("error editing data. ",e)}break;case"add-data":let u=JSON.parse(l.serialize());if(!u[t])return;try{u[t]={...u[t],props:{...u[t].props,[s]:r}},o.setOptions(e=>e.skipTopic=!0),o.setProp(t,e=>e[s]=r),n(u)}catch(e){console.error("error adding data. ",e)}break;case"add-node":let p=i.type,h=i.childrenPos,f=i.nodeName,g=i.parent;if("JsxElement"==p){let e={displayName:f,props:{},custom:{defaultImport:f,moduleSpecifier:'"'.concat(d).concat(f,'"'),_nodeType:"JsxElement"},hidden:!1,isCanvas:!0,parent:g,type:{resolvedName:f},nodes:[]},i=JSON.parse(l.serialize());if(!g||!i)return;try{let r=c(i,t,e,g,h);o.setOptions(e=>e.skipTopic=!0),o.deserialize(r),n(JSON.parse(l.serialize()))}catch(e){console.error("error adding node (JsxElement). ",e)}}else try{let e=i.data;if(!(null==e?void 0:e.isAncestorJsxElement))return;o.setOptions(e=>e.skipTopic=!0),o.setProp(g,t=>t[e.key]=e.value),n(JSON.parse(l.serialize()))}catch(e){console.error("error adding node (Not a JsxElement). ",e)}}},[i])}let Y="flows-ui",ee=(0,_.e)(Y),et=e=>{let[t,n]=W(e.contextAtom);return(0,l.jsx)(ee,{...e,flowId:Y,enableCommunicationInterface:function(e){let{edges:n,nodeData:i,nodes:r,setEdges:o,setNodesData:l,deleteNodes:d,setNodes:c,createNode:u,setNodeData:p,_customComponents:h,onSaveNodes:f,flowId:g,data:x}=e,m=(0,a.useRouter)(),v=m.query;"true"===v.experimental_comms?(0,s.useEffect)(()=>{console.log("flows: experimental communications -> ",t)},[]):(console.log("flows: legacy communications"),(0,s.useEffect)(()=>{let e=x[g+"/ui"];if(e){var t=e.nodeId;switch(e.action){case"delete-node":var s,a=null!==(s=e.deletedNodes)&&void 0!==s?s:[],f=e.parent;let{updatedEdges:g,newNodeData:x}=d(a,f,t,n,i);o(g),l(x),c(e=>e.filter(e=>!a.includes(e.id)));break;case"add-node":var m,v,y=e.nodeName,E=e.parent,b=null!==(v=null==e?void 0:e.data)&&void 0!==v?v:{},C=null===(m=r.find(t=>t.id==e.parent))||void 0===m?void 0:m.position;if(!C)return;var w=e.childrenPos+1,A=e.nodeProps;let J=Object.keys(A).reduce((e,t)=>{var n=A[t],i="prop-".concat(t);let r=(0,U.GT)(n);var o={key:t,value:n,kind:r};return"children"==t&&(i="child-1",o=n),{...e,[i]:o}},{name:y});var j={...i,[t]:J};if(h.find(e=>e.id==y)){var k={};j={...j,[t]:{...j[t]}}}let I=u([C.x+500,C.y],"JsxElement",e.nodeId,b,!0,{},k);c(e=>e.concat(I));let N=(0,$.wo)(r,n,j,t,"JsxElement");l(j={...j,[E]:{...(0,$.MR)(j[E],w,null!=N?N:'"children"')}}),o((0,$.lm)(n,t,E,w));break;case"edit-node":let P=e.field,z=e.value;S="prop"==e.type?{["prop-"+P]:{...i[t]["prop-"+P],value:z,key:P,kind:(0,U.GT)(z)}}:{"child-1":z};var S,j={...i,[t]:{...i[t],...S}};l(j);break;case"move-node":let T=e.isSameParent;if(T){let t=e.parent,r=e.childrenIndexes,l=Math.min(...r),s={...i[t]},a=(0,$.ro)(s,r,l);p(t,a);let d=(0,$.lh)(n,t,l,r);o(d);return}{let r=e.oldParentId,s=e.oldPos+1,a=i[r],{data:d,deletedElementData:c}=(0,$.ap)(a,s),u=e.newParentId,p=i[u];if(!p)return;let h=Object.keys(p).filter(e=>e.startsWith("child-")).length,f=-1==e.newPos?h+1:e.newPos+1,g=(0,$.MR)(p,f,c);l({...i,[r]:d,[u]:g});let x=(0,$.cV)(n,t,r,s,u,f);o(x)}}}},[x[g+"/ui"]]),(0,s.useEffect)(()=>{var e;(null===(e=x.savenodes)||void 0===e?void 0:e.value)&&f()},[x.savenodes]))}})},en=(e,t,n)=>{e.debounce?(o=setTimeout(()=>{t(Y+"/ui",e)},1e3),i&&e.nodeId==i.nodeId&&clearTimeout(r),i=e,r=o):t(Y+"/ui",e),n&&n()},ei=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"customCode.tsx",n=new K.IKL({useInMemoryFileSystem:!0,manipulationSettings:{indentationText:K.xI4.Tab},compilerOptions:{target:K.H7j.Latest,scriptKind:K.hVH.TSX,languageVariant:K.C$L.JSX}}),i=n.createSourceFile(t,e,{overwrite:!0});return i},er=(e,t,n)=>{var i,r;let o=null===(i=e.filter(e=>"ImportDeclaration"==e.type))||void 0===i?void 0:i.map(e=>e.id),l=null===(r=e.filter(e=>["JsxElement","JsxSelfClosingElement"].includes(e.type)))||void 0===r?void 0:r.map(e=>e.id),s=[];o.forEach(e=>{let n=t[e],i=n.module;Object.keys(n).forEach(e=>{let t;"default"==e&&n[e]?(t={defaultImport:n.default,moduleSpecifier:i},s.push(t)):e.startsWith("import-")&&n[e]&&(t={namedImports:[{name:n[e],alias:void 0}],moduleSpecifier:i},s.push(t))})});let a=[];function d(e){for(let t of s){if(t.defaultImport===e)return!0;if(t.namedImports){for(let n of t.namedImports)if(n.name===e)return!0}}return!1}e.forEach(e=>{l.includes(e.id)&&a.push({...e.data,tagName:t[e.id].name})});let c=function(){let e=[];for(let t of a){let{tagName:n,namedImports:i,defaultImport:r}=t;d(n)||i||r||e.push({defaultImport:n}),!d(n)&&(i||r)&&e.push(t)}return e}();return c};var eo=n(60545),el=(0,B.Ic)(e=>{var t;let{children:i,topics:r,currentPageContent:o,resolveComponentsDir:a,onReady:c=()=>{},metadata:u={},contextAtom:p=null}=e,h=(0,s.useRef)(),[f,g]=(0,s.useState)(!0),[x,m]=(0,s.useState)({}),[v,y]=(0,s.useState)({}),[E,b]=(0,s.useState)(),{publish:C,data:w}=r,{actions:A,query:j,connectors:k}=(0,d.jE)((e,n)=>{let i=JSON.parse(n.serialize()),r=D().diff(x,JSON.parse(n.serialize()));b(null===(a=e.events.selected)||void 0===a?void 0:a.keys().next().value);let o=(null==r?void 0:r.length)>0,l=D().diff(v,i);if(!n.getOptions().skipTopic&&(null==l?void 0:l.length)&&JSON.stringify(l)!=t){var s={};if(1==l.filter(e=>"N"==e.kind).length){let e=l.find(e=>"N"==e.kind).path[0],t=i[e].parent,n=i[t].nodes.findIndex(t=>t==e),r=i[e].custom;en(s={action:"add-node",nodeId:e,nodeName:i[e].displayName,parent:t,childrenPos:n,data:r,nodeProps:i[e].props},C)}else if(l.find(e=>"D"==e.kind)){let e=l.filter(e=>"D"==e.kind).map(e=>e.path[0]),t=l.find(e=>"A"==e.kind).path[0];en(s={action:"delete-node",deletedNodes:e,parent:t},C)}else if(l.find(e=>"E"==e.kind)){let e=l.find(e=>"E"==e.kind&&"parent"==e.path[1]),t=l.find(e=>"E"==e.kind&&"children"==e.path[2]),n=l.find(e=>"E"==e.kind&&"props"==e.path[1]),i=l.find(e=>"E"==e.kind&&"nodes"==e.path[1]);if(t||n){let e=t?"children":"prop";var a,d,c="children"==e?t:n;let i=c.path[0],r=c.rhs;s={action:"edit-node",nodeId:i,value:r,type:e,field:c.path[2],debounce:"children"==e}}else if(e){let t=e.path[0],n=e.rhs,i=e.lhs,r=v[i].nodes.findIndex(e=>e==t),o=l.find(e=>"E"==e.kind&&e.path[0]==n&&e.rhs==t),a=null!==(d=null==o?void 0:o.path[2])&&void 0!==d?d:-1;s={action:"move-node",isSameParent:!1,nodeId:t,oldParentId:i,newParentId:n,newPos:a,oldPos:r}}else{let e=i.path[0],t=l.sort((e,t)=>e.path[2]-t.path[2]).map(e=>e.rhs),n=v[e].nodes,r=function(e,t){let n=[],i={};for(let t=0;t<e.length;t++)i[e[t]]=t;for(let e=0;e<t.length;e++){let r=t[e];n.push(i[r])}return n}(n,t);s={action:"move-node",isSameParent:!0,parent:e,childrenIndexes:r}}en(s,C)}t=JSON.stringify(l),y(i)}return{hasChanges:o,currentEditorNodes:i,enabled:e.options.enabled}});(0,s.useEffect)(()=>{E&&C("zoomToNode",{id:E})},[E]),G({actions:A,query:j},{resolveComponentsDir:a,appendNewNodeToTree:(e,t,n,i,r)=>(e[t]=n,e[i].nodes.splice(r,0,t),e)},y,w["flow/editor"],p),(0,s.useEffect)(()=>{A.setOptions(e=>e.skipTopic=!1)},[v]);let S=async()=>{let e=L.parse(o,u),t=e.data();m(t);let n=null!==(l=null==j?void 0:null===(r=j.getOptions())||void 0===r?void 0:r.resolver)&&void 0!==l?l:{},i=Object.keys(n);try{var r,l,s={};Object.keys(t).forEach(e=>{if(!i.includes(t[e].displayName)){let n={...t[e],custom:{...t[e].custom,unknown:!0},type:{...t[e].type,resolvedName:"Unknown"}};s[e]=n}}),A.deserialize({...t,...s})}catch(e){throw"Error loading editor nodes"}};return(0,T.Z)(["z","Z","s","S","c","C","Delete","Backspace"],e=>{var t,n;let i=(null===(n=h.current)||void 0===n?void 0:null===(t=n.getBoundingClientRect())||void 0===t?void 0:t.height)>0;if(i){if(("z"==e.key||"Z"==e.key)&&(e.ctrlKey||e.metaKey)&&e.shiftKey){try{A.history.redo()}catch(e){console.error("can not redone action")}return}if(("z"==e.key||"Z"==e.key)&&(e.ctrlKey||e.metaKey)){try{A.history.undo()}catch(e){console.error("can not undone action")}return}}}),(0,s.useEffect)(()=>{let e=async t=>{try{await S()}catch(n){t<10?(setTimeout(()=>e(t+1),5e3),g(!0)):console.error("Max retry reached! Error deserializing editor nodes (CraftJS nodes). Error: ".concat(n)),console.error("Error deserializing editor nodes (CraftJS nodes). Error: ".concat(n))}};o&&(g(!1),e(0))},[o]),(0,l.jsxs)("div",{style:{backgroundColor:"rgb(50, 50, 50)",overflow:"hidden",flex:1,display:"flex",flexDirection:"column"},children:[(0,l.jsxs)(z(),{children:[(0,l.jsx)("title",{children:"Platform UI"}),(0,l.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:n(72555)})]}),f?(0,l.jsx)(R.Stack,{style:{height:"100vh",justifyContent:"center",alignItems:"center",zIndex:100,backgroundColor:"#f0f0f0"},children:(0,l.jsx)(eo.$,{size:"large"})}):null,(0,l.jsx)("div",{onLoad:()=>g(!1),className:"page-container",style:{width:"100%",height:"100%"},children:(0,l.jsx)("div",{id:"editor",className:"craftjs-renderer",ref:e=>{h.current=e,k.select(k.hover(e,null),null)},style:{flex:1,position:"relative",overflow:"auto",color:"black",backgroundColor:"#f0f0f0",margin:"0 auto",left:0,right:0,width:"100%",height:"100%"},children:(0,l.jsx)(Q,{children:(0,l.jsx)("div",{id:"editor-frame-container",children:(0,l.jsx)(d.RQ,{})})})})})]})},{topics:["flow/editor"]}),es=n(38880),ea=n(88724);let ed=e=>{let{palettes:t,sendMessage:n,currentPage:i}=e,r=s.useRef(null),[o,a]=s.useState(""),{connectors:c,query:u}=(0,d.jE)(),p=Object.keys(t).reduce((e,n)=>{let i=t[n]?Object.keys(t[n]).filter(e=>{var i,r;return!(null===(r=t[n][e].craft)||void 0===r?void 0:null===(i=r.custom)||void 0===i?void 0:i.hidden)}).reduce((e,i)=>{var r,o,l,s;return{...e,[i]:{dropable:!0,element:t[n][i],icon:(r=t[n][i],s="Component",(null==r?void 0:null===(o=r.craft)||void 0===o?void 0:o.custom)&&(null==r?void 0:null===(l=r.craft)||void 0===l?void 0:l.custom.icon)&&(s=r.craft.custom.icon),s)}}},{}):{...e};return{...e,[n]:i}},{}),h=o?Object.keys(p).reduce((e,t)=>{let n=p[t],i=Object.keys(n),r=i.filter(e=>e.toLocaleLowerCase().includes(o.toLocaleLowerCase())).reduce((e,t)=>({...e,[t]:n[t]}),{});var l={};return Object.keys(r).length&&(l={[t]:r}),{...e,...l}},{}):p,f=Object.keys(h).filter(e=>"craft"!=e);function g(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=.95*window.innerHeight;r.current&&(r.current.style.height=e+"px",r.current.style.maxHeight=e+"px")}return s.useEffect(()=>(g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)),[]),(0,l.jsx)("div",{className:"visualui-sidebar",style:{backgroundColor:"rgb(37, 37, 38, 0.97)"},children:(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",flex:1,padding:"4px"},children:(0,l.jsxs)("div",{ref:r,style:{padding:"4px",display:"flex",flexDirection:"column",flex:1},children:[(0,l.jsx)("p",{style:{padding:"18px 0px 0px 14px",fontSize:"18px",color:"white",fontWeight:"400"},children:"Components"}),(0,l.jsxs)("div",{style:{display:"flex",margin:"18px 12px 18px 2px",position:"relative"},children:[(0,l.jsx)("input",{style:{fontFamily:"Jost-Regular",padding:"8px 8px 8px 36px",display:"flex",boxSizing:"border-box",fontSize:"14px",backgroundColor:"#323232",borderRadius:"10px",borderWidth:"0px",outline:"none",color:"white",flex:1},value:o,onChange:e=>a(e.target.value),placeholder:"Search..."}),(0,l.jsx)(es.Z,{color:"grey",size:20,style:{position:"absolute",top:"8px",left:"10px"}}),o?(0,l.jsx)(ea.Z,{onClick:()=>a(""),color:"white",size:20,style:{position:"absolute",top:"8px",right:"10px",cursor:"pointer"}}):null]}),(0,l.jsx)("div",{className:"visualui-sidebar-list",style:{overflow:"auto",overflowX:"hidden",display:"flex",flexDirection:"column",flex:1},children:f.map((e,t)=>(0,l.jsxs)("div",{style:{flexDirection:"column",display:"flex",marginBottom:"25px"},children:[(0,l.jsx)("p",{style:{paddingLeft:"16px",marginBottom:"10px",fontSize:"12px",color:"grey"},children:e.toUpperCase()}),(0,l.jsx)("div",{className:"visualui-sidebar-list",style:{flex:1,display:"flex",justifyContent:"flex-start",flexWrap:"wrap",alignContent:"flex-start",gap:"8px"},children:Object.keys(h[e]).map((t,n)=>{let i=h[e][t];return(null==i?void 0:i.nonDeletable)?null:(0,l.jsx)("div",{onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#FFFFFF10"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=""},title:t,style:{display:"flex",cursor:"grab",borderRadius:"6px"},children:(0,l.jsxs)("div",{ref:e=>c.create(e,()=>i.dropable?(0,l.jsx)(d.W_,{is:i.element,canvas:!0}):s.createElement(i.element)),id:"drag-element-"+t,className:"draggable-element",style:{textAlign:"center",paddingTop:"10px",paddingBottom:"10px",width:"100px",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,l.jsx)(A,{name:i.icon,color:"#a8a29e",size:32}),(0,l.jsx)("div",{style:{marginTop:"14px"},children:(0,l.jsx)("p",{style:{fontSize:"12px",width:"100%",color:"white",padding:"5px"},children:t.length>12?t.substring(0,9)+"...":t})})]})},n)})})]},t))})]})})})};var ec=n(51745),eu=n(27911),ep=e=>{let{sourceCode:t,onChange:n,onSave:i,onEscape:r}=e;return i&&(0,T.Z)(["s","S"],e=>{if(("s"==e.key||"S"==e.key)&&(e.ctrlKey||e.metaKey)&&i)return e.preventDefault(),i()}),r&&(0,T.Z)(["Escape"],e=>{if("Escape"==e.key&&r)return e.preventDefault(),r()}),(0,l.jsx)(eu.ZP,{theme:"vs-dark",defaultLanguage:"javascript",value:t,onChange:e=>n(e)})},eh=n(53544),ef=n(91425),eg=n(43748),ex=n(8219),em=n(89285),ev=n(70698),ey=n(1674),eE=n(50664),eb=n(75780),eC=n(66306),ew=n(64973),eA=n(73235),ej=n(17788),ek=n(11001),eS=n(81395);function eJ(){let e=(0,eA._)(["\n  height: ",";\n  flex: ",";\n  color: #545454;\n"]);return eJ=function(){return e},e}let eI=ej.default.div(eJ(),e=>e.visible&&e.height&&"full"!==e.height?"".concat(e.height):"auto",e=>e.visible&&e.height&&"full"===e.height?"1":"unset"),eN=e=>{let{visible:t,icon:n,title:i,children:r,height:o,onChange:a}=e;return(0,l.jsxs)(eI,{visible:t,height:o,style:{display:"flex",flexDirection:"column"},children:[(0,l.jsxs)("div",{onClick:()=>{a&&a(!t)},style:{cursor:"pointer",backgroundColor:"#191919",borderBottom:"1px solid #cccccc20",alignItems:"center",padding:"10px",flexDirection:"row",display:"flex"},children:[(0,l.jsxs)("div",{style:{display:"flex",flex:1,alignItems:"center"},children:[s.createElement(n,{size:18,color:"white"}),(0,l.jsx)("div",{style:{fontSize:18,marginLeft:"10px",color:"white"},children:i})]}),t?(0,l.jsx)(ek.Z,{size:18}):(0,l.jsx)(eS.Z,{size:18})]}),(0,l.jsx)(y.FA,{style:{display:t?"flex":"none",flex:1,flexDirection:"column",overflowY:"scroll"},children:r})]})};var eP=n(82095);let ez=e=>{let{icon:t,onPress:n,text:i,buttonProps:r={},id:o}=e,[a,d]=(0,s.useState)(!1);return(0,l.jsx)(y.sL,{id:o,onPress:n,children:(0,l.jsx)(eC.zx,{animation:"bouncy",chromeless:!0,paddingHorizontal:"$3",height:"40px",fontSize:"$5",borderRadius:"$2",icon:t,color:a&&!r.theme?b.interactiveColor:"white",onMouseEnter:e=>d(!0),onMouseLeave:e=>d(!1),scaleIcon:1.5,...r,children:i})})};var eT=e=>{let{height:t,leftItems:n,rightItems:i,...r}=e;return(0,l.jsxs)(y.sL,{jc:"space-between",ai:"center",backgroundColor:b.nodeBackgroundColor,h:t,bbc:"#cccccc20",bbw:"1px",paddingHorizontal:"$4",...r,children:[(0,l.jsx)(y.sL,{ai:"center",gap:"$4",children:n.map((e,t)=>(0,l.jsx)(ez,{id:e.id,onPress:e.onPress,icon:e.icon,text:e.text,buttonProps:e.buttonProps},t))}),(0,l.jsx)(y.sL,{ai:"center",gap:"$4",children:i.map((e,t)=>(0,l.jsx)(ez,{id:e.id,onPress:e.onPress,icon:e.icon,text:e.text,buttonProps:e.buttonProps},t))})]})},eO=(0,s.memo)((0,B.Ic)(function(e){let{isActive:t=!0,sourceCode:n="",sendMessage:i,currentPage:r="",userPalettes:o={},resolveComponentsDir:u="",topics:p,metadata:h={},contextAtom:f=null}=e,[g,x]=W(f),m=(0,s.useRef)(),v=(0,s.useRef)(),[E,C]=(0,s.useState)(!1),[A,j]=(0,s.useState)(""),[S,J]=(0,s.useState)(A),[I,P]=(0,s.useState)(!1),[z,T]=(0,s.useState)("preview"),[O,D]=(0,s.useState)(!1),[K,L]=(0,s.useState)(!0),[B,R]=(0,s.useState)(!1),Q=(0,a.useRouter)(),{publish:Z}=p,{data:F}=p,[V,M]=s.useState(!1),_="preview"==z,U="50px",$="calc(100vh - "+U+")";(0,s.useEffect)(()=>{let e=()=>M(!1);return window.addEventListener("dragenter",e),()=>{window.removeEventListener("dragenter",e)}},[]);let H={...N,...o},X=Object.keys(H).reduce((e,t)=>e={...e,...H[t]},{}),G=async()=>{j(n)},Y=async(e,t,n)=>{var r=t;switch(e){case"monaco":i({type:"save",data:{content:r=S}});break;case"flows":if(!n)break;let o=ei(r),l=o.getImportDeclarations(),s=er(n.nodes,n.nodesData,u);if(s.length){let e=s.filter((e,t,n)=>t===n.findIndex(t=>JSON.stringify(t)===JSON.stringify(e))),t=e.reduce((e,t)=>{var n,i,r,o,l;let s;let a=t.moduleSpecifier;if(a){if(null===(n=t.namedImports)||void 0===n?void 0:n.length){let e=(null===(i=t.namedImports[0])||void 0===i?void 0:i.alias)?(null===(r=t.namedImports[0])||void 0===r?void 0:r.name)+" as "+(null===(o=t.namedImports[0])||void 0===o?void 0:o.alias):null===(l=t.namedImports[0])||void 0===l?void 0:l.name;s="import {"+e+'} from "'+a+'";\n'}else t.defaultImport&&(s="import "+t.defaultImport+' from "'+a+'";\n')}else s="";return e+s},"\n"),n=l?l[l.length-1].getEnd():0,i=o.insertText(n,t);r=i.getText()}i({type:"save",data:{content:r}})}},ee=e=>{"code"==e?(E?D(!O):D(!0),T(void 0),C(!0)):"flow"==e?(z==e?D(!O):D(!0),T(e),C(!1)):"preview"==e&&(["flow-preview","preview"].includes(z)?D(!O):D(!0),T(e),C(!1))};(0,s.useEffect)(()=>{J(A)},[A]),(0,s.useEffect)(()=>{G()},[n]),(0,s.useEffect)(()=>{var e;(null===(e=F.zoomToNode)||void 0===e?void 0:e.id)&&!O&&D(!0)},[F.zoomToNode]);let en=(0,l.jsx)("div",{style:{display:"flex",width:"100%",top:O?0:-1e12,position:O?"relative":"absolute",height:"100%"},children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:$},children:[(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",zIndex:999999,backgroundColor:"#252526",borderBottom:"1px solid #cccccc20"},children:[(0,l.jsxs)(y.sL,{padding:"10px",display:I&&E?"flex":"none",theme:"dark",marginVertical:"$1",children:[(0,l.jsx)(eC.zx,{size:"$3",chromeless:!0,circular:!0,marginRight:"$2",onPress:()=>{J(A),P(!1)},children:(0,l.jsx)(ea.Z,{})}),(0,l.jsx)(eC.zx,{size:"$3",chromeless:!0,circular:!0,onPress:()=>Y("monaco",S),children:(0,l.jsx)(eh.Z,{fillOpacity:0})})]}),(0,l.jsx)(y.sL,{padding:"10px",display:["flow-preview","preview"].includes(z)?"flex":"none",children:(0,l.jsxs)(ew.t,{backgroundColor:"red",theme:"dark",type:"single",defaultValue:"preview",disableDeactivation:!0,children:[(0,l.jsx)(ew.t.Item,{hoverStyle:{backgroundColor:"#273E61"},focusStyle:{backgroundColor:"flow-preview"==z?b.interactiveColor:b.inputBackgroundColor},backgroundColor:"flow-preview"==z?b.interactiveColor:b.inputBackgroundColor,value:"flow-preview",onPress:()=>T("flow-preview"),children:(0,l.jsx)(ef.Z,{})}),(0,l.jsx)(ew.t.Item,{hoverStyle:{backgroundColor:"#273E61"},focusStyle:{backgroundColor:"preview"==z?b.interactiveColor:b.inputBackgroundColor},backgroundColor:"preview"==z?b.interactiveColor:b.inputBackgroundColor,value:"preview",onPress:()=>T("preview"),children:(0,l.jsx)(eg.Z,{})})]})})]}),(0,l.jsx)("div",{style:{display:E?"flex":"none",flex:1},children:(0,l.jsx)(ep,{onChange:e=>{J(e),A!=e?P(!0):P(!1)},sourceCode:S})}),(0,l.jsxs)("div",{style:{opacity:1,marginRight:0,flex:1,display:E?"none":"flex",flexDirection:"column",backgroundColor:"#252526"},children:[(0,l.jsx)(eN,{icon:ex.Z,title:"Customize",height:B?"55%":"full",visible:K,onChange:e=>L(e),children:(0,l.jsx)(et,{disableDots:!t||_,sourceCode:A,setSourceCode:j,customComponents:(0,eP.B)(Q.pathname,Q.query),onSave:(e,t,n)=>Y("flows",e,n),config:{masks:(0,eP.W)(Q.pathname,Q.query)},zoomOnDoubleClick:!_,themeMode:"dark",bgColor:"#252526",theme:b,nodePreview:z,metadata:h,contextAtom:f})}),(0,l.jsx)(eN,{icon:em.Z,title:"Layers",visible:B,onChange:e=>R(e),height:K?"55%":"full",children:(0,l.jsx)(c.S9,{})})]})]})},"auxiliarySidebar"),eo=(0,l.jsx)("div",{style:{display:"flex",flex:1,height:"100%"},children:(0,l.jsx)(ed,{palettes:H,sendMessage:i,currentPage:r})},"sidebar"),es=(0,l.jsx)("div",{id:"editor-layout",style:{flex:1,display:"flex",minWidth:"280px",borderRight:"2px solid #424242",borderLeft:"2px solid #424242"},children:(0,l.jsx)(el,{metadata:h,currentPageContent:A,onSave:()=>null,resolveComponentsDir:u,contextAtom:f})});function eu(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=window.innerHeight;m.current&&(m.current.style.height=e+"px")}(0,s.useEffect)(()=>(eu(),window.addEventListener("resize",eu),()=>window.removeEventListener("resize",eu)),[]),(0,s.useEffect)(()=>{var e;let t=e=>{v.current||(e.preventDefault(),e.stopPropagation())};return null===(e=document.getElementById("editor-layout"))||void 0===e||e.addEventListener("click",t),()=>{var e;return null===(e=document.getElementById("editor-layout"))||void 0===e?void 0:e.removeEventListener("click",t)}},[]);let eA={resolver:X,onRender:e=>{let{...t}=e;return k({...t,onEnableEvents:e=>{v.current=e}})}},ej=q(eA);return x&&x(ej),(0,l.jsx)("div",{ref:m,style:{display:"flex",flex:1,width:"100%",flexDirection:"column"},children:(0,l.jsxs)(d.ML,{...eA,parentContext:ej,children:[(0,l.jsx)(eT,{height:U,leftItems:[{id:"components-to-drag-btn",icon:w.Z,buttonProps:{chromeless:!1,theme:"blue",backgroundColor:b.interactiveColor},onPress:()=>M(!0)},{icon:ev.Z,onPress:()=>{Q.push({query:{}})}}],rightItems:[{icon:ey.Z,onPress:()=>ee("code")},{icon:eE.Z,onPress:()=>ee("flow")},{id:"save-nodes-btn",text:"Save",buttonProps:{chromeless:!1,theme:"blue",backgroundColor:b.interactiveColor,paddingHorizontal:"$4"},onPress:()=>Z("savenodes",{value:"visual-ui"})},{icon:eb.Z,onPress:()=>ee("preview")}]}),(0,l.jsx)("div",{style:{display:"flex",flex:1,flexDirection:"row"},children:(0,l.jsx)(ec.Z,{openPanel:V,setOpenPanel:M,leftPanelContent:eo,centerPanelContent:es,height:$,rightPanelContent:en,rightPanelResizable:!_,rightPanelWidth:_?0:50,rightPanelVisible:O})})]})})},{topics:["zoomToNode"]})),eD=e=>{let{userPalettes:t={},_sourceCode:n="",_resolveComponentsDir:i="@/uikit",_currentPage:r="",onSave:o=()=>null,metadata:a={},contextAtom:d}=e,[c,u]=(0,s.useState)(r),p=async e=>{let t=e.type,n=e.data;switch(t){case"loadPage":let i=n.pageName;u(i);break;case"save":let r=n.content;o(function(e){let t;try{t=M().format(e,{bracketSameLine:!0,jsxBracketSameLine:!0,singleAttributePerLine:!1,printWidth:1e3,quoteProps:"consistent",jsxSingleQuote:!1,parser:"typescript",plugins:[F()]})}catch(e){console.error("Could not format text. Error: "+e)}return null!=t?t:e}(r))}};return(0,l.jsx)(B.US,{children:n?(0,l.jsx)(eO,{sourceCode:n,currentPage:c,userPalettes:t,sendMessage:p,resolveComponentsDir:"".concat(i,"/"),metadata:a,contextAtom:d}):null})}}}]);