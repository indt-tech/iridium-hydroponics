(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2172],{32172:function(a,r,h){"use strict";h.d(r,{Z:function(){return tI}});var m=h(52322),u=h(97729),_=h.n(u),f=h(6429),g=h(17793),y=h(1888),w=h(5632),v=h(25237),S=h.n(v),E=h(64509);let I=S()(()=>h.e(9481).then(h.bind(h,29481)),{loadableGenerated:{webpack:()=>[29481]},ssr:!1});function T(a){let{workspace:r,deviceDefinition:h,data:u,pageSession:y}=a,v=(0,w.useRouter)();(0,f.kP)(y);let{name:S}=v.query;return(0,m.jsxs)(E.US,{children:[(0,m.jsx)(_(),{children:(0,m.jsx)("title",{children:"Protofy - Admin Panel"})}),(0,m.jsx)(g.bR,{workspace:r,children:(0,m.jsx)(I,{deviceDefinition:h})})]})}let A=[{name:"Empty device",board:{name:"Protofy ESP32 devBoard",core:{id:"1",name:"esp32",sdks:["esphome"],config:{}},ports:[{number:1,side:"left",name:"3V3",type:"P",analog:!1,description:"3V3 Power supply",maxVoltage:3.3,rtc:!1},{number:2,side:"left",name:"EN",type:"I",analog:!1,description:"CHIP_PU, RESET",maxVoltage:3.3,rtc:!1},{number:3,side:"left",name:"36",type:"I",analog:!0,description:"GPIO36, ADC1_CH0, S_VP",maxVoltage:3.3,rtc:!0},{number:4,side:"left",name:"39",type:"I",analog:!0,description:"GPIO39, ADC1_CH3, S_VN",maxVoltage:3.3,rtc:!0},{number:5,side:"left",name:"34",type:"I",analog:!0,description:"GPIO34, ADC1_CH6, VDET_1",maxVoltage:3.3,rtc:!0},{number:6,side:"left",name:"35",type:"I",analog:!0,description:"GPIO35, ADC1_CH7, VDET_2",maxVoltage:3.3,rtc:!0},{number:7,side:"left",name:"32",type:"IO",analog:!0,description:"GPIO32, ADC1_CH4, TOUCH_CH9, XTAL_32K_P",maxVoltage:3.3,rtc:!0},{number:8,side:"left",name:"33",type:"IO",analog:!0,description:"GPIO33, ADC1_CH5, TOUCH_CH8, XTAL_32K_N",maxVoltage:3.3,rtc:!0},{number:9,side:"left",name:"25",type:"IO",analog:!0,description:"GPIO25, ADC1_CH8, DAC_1",maxVoltage:3.3,rtc:!0},{number:10,side:"left",name:"26",type:"IO",analog:!0,description:"GPIO26, ADC2_CH9, DAC_2",maxVoltage:3.3,rtc:!0},{number:11,side:"left",name:"27",type:"IO",analog:!0,description:"GPIO27, ADC2_CH7, TOUCH_CH7",maxVoltage:3.3,rtc:!0},{number:12,side:"left",name:"14",type:"IO",analog:!0,description:"GPIO14, ADC2_CH6, TOUCH_CH6, MTMS",maxVoltage:3.3,rtc:!0},{number:13,side:"left",name:"12",type:"IO",analog:!0,description:"GPIO12, ADC2_CH5, TOUCH_CH5, MTDI",maxVoltage:3.3,rtc:!0},{number:14,side:"left",name:"GND",type:"G",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:15,side:"left",name:"13",type:"IO",analog:!0,description:"GPIO13, ADC2_CH4, TOUCH_CH4, MTCK",maxVoltage:3.3,rtc:!0},{number:16,side:"left",name:"9",type:"IO",analog:!1,description:"GPIO9, D2",maxVoltage:3.3,rtc:!1},{number:17,side:"left",name:"10",type:"IO",analog:!1,description:"GPIO10, D3",maxVoltage:3.3,rtc:!1},{number:18,side:"left",name:"11",type:"IO",analog:!1,description:"GPIO11, CMD",maxVoltage:3.3,rtc:!1},{number:19,side:"left",name:"5V",type:"P",analog:!1,description:"5V Power supply",maxVoltage:5,rtc:!1},{number:1,side:"right",name:"GND",type:"G",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:2,side:"right",name:"23",type:"IO",analog:!1,description:"GPIO23",maxVoltage:3.3,rtc:!1},{number:3,side:"right",name:"22",type:"IO",analog:!1,description:"GPIO22",maxVoltage:3.3,rtc:!1},{number:4,side:"right",name:"TX",type:"IO",analog:!1,description:"GPIO1, U0TXD",maxVoltage:3.3,rtc:!1},{number:5,side:"right",name:"RX",type:"IO",analog:!1,description:"GPIO3, U0RXD",maxVoltage:3.3,rtc:!1},{number:6,side:"right",name:"21",type:"IO",analog:!1,description:"GPIO21",maxVoltage:3.3,rtc:!1},{number:7,side:"right",name:"GND",type:"GND",analog:!1,description:"Ground",maxVoltage:0,rtc:!1},{number:8,side:"right",name:"19",type:"IO",analog:!1,description:"GPIO19",maxVoltage:3.3,rtc:!1},{number:9,side:"right",name:"18",type:"IO",analog:!1,description:"GPIO18",maxVoltage:3.3,rtc:!1},{number:10,side:"right",name:"5",type:"IO",analog:!1,description:"GPIO5",maxVoltage:3.3,rtc:!1},{number:11,side:"right",name:"17",type:"IO",analog:!1,description:"GPIO17",maxVoltage:3.3,rtc:!1},{number:12,side:"right",name:"16",type:"IO",analog:!1,description:"GPIO16",maxVoltage:3.3,rtc:!1},{number:13,side:"right",name:"4",type:"IO",analog:!0,description:"GPIO4, ADC2_CH0, TOUCH_CH0",maxVoltage:3.3,rtc:!0},{number:14,side:"right",name:"0",type:"IO",analog:!0,description:"GPIO0, ADC2_CH1, TOUCH_CH1, Boot",maxVoltage:3.3,rtc:!0},{number:15,side:"right",name:"2",type:"IO",analog:!0,description:"GPIO2, ADC2_CH2, TOUCH_CH2",maxVoltage:3.3,rtc:!0},{number:16,side:"right",name:"15",type:"IO",analog:!0,description:"GPIO15, ADC2_CH3, TOUCH_CH3, MTDO",maxVoltage:3.3,rtc:!0},{number:17,side:"right",name:"8",type:"IO",analog:!1,description:"GPIO8, D1",maxVoltage:3.3,rtc:!1},{number:18,side:"right",name:"7",type:"IO",analog:!1,description:"GPIO7, D0",maxVoltage:3.3,rtc:!1},{number:19,side:"right",name:"CLK",type:"IO",analog:!1,description:"GPIO6, CLK",maxVoltage:3.3,rtc:!1}],config:{}},sdk:{name:"esphome"},subsystems:{},config:{mqttServer:{broker:"bo-firmware.protofy.xyz",port:1883,username:null,password:null,clientId:null,websocketEndpoint:"/ws",websocketProtocol:"ws"}},sdkConfig:{board:"esp32dev",framework:{type:"arduino"}}}],P=(0,y.F7)(async a=>(0,f.NA)(a,["admin"],{deviceDefinition:A}));var D=h(41585),C=h(57909),O=h(32627),R=h(30195),M=h(75370),F=h(54283);let N=M.V_.object({name:R.z.string().hint("ESP32, AT-MEGA2560  ARMv7, Protofy, ...").static().id(),sdks:R.z.array(R.z.string()).hint("esphome, platformio, wled, javascript, ...").hidden(),config:R.z.record(R.z.string(),R.z.string()).generate(()=>({}))}),L=F.$.createDerived("DeviceCoreModel",N);var q=h(6289),U=h(26887),B=h(48115),G=h(40214),H=h(13997),z=h(50897),V=h(79562),W=h(6364);let Z=M.V_.object({id:R.z.string().generate((0,W.Z)()).id(),name:R.z.string().hint("MicroPython, Platformio...").static()}),K=F.$.createDerived("DeviceSdkModel",Z);var $=h(2784);let X={name:O.V,sdk:C.S},Y="/adminapi/v1/devicecores",J="/adminapi/v1/devicesdks?all=1";var Q={component:a=>{var r;let{pageState:h,initialItems:u,itemData:_,pageSession:f,extraData:g}=a,[y,w]=(0,$.useState)(null!==(r=null==g?void 0:g.sdks)&&void 0!==r?r:(0,q.E)("pending"));return(0,U.a)(a=>{B.bl.get({url:J},a)},w,null==g?void 0:g.cores),(0,m.jsx)(G.D,{title:"Device Cores",pageSession:f,children:(0,m.jsx)(H.V,{integratedChat:!0,itemData:_,rowIcon:D.x,sourceUrl:Y,initialItems:u,numColumnsForm:1,entityName:"devicecores",name:"core",onAdd:a=>a,onEdit:a=>a,columns:z.Z.columns(z.Z.column("name","name",!0),z.Z.column("sdk","sdk",!0,a=>{var r;return(0,m.jsx)("div",{style:{gap:"5px",display:"flex",flexDirection:"row"},children:null===(r=a.sdks)||void 0===r?void 0:r.map(a=>(0,m.jsx)(V.A,{text:a,color:"$gray5"}))})})),extraFieldsForms:{sdks:R.z.array(R.z.union([R.z.literal(""),R.z.literal("")])).generateOptions(()=>y.isLoaded?y.data.items.map(a=>K.load(a).getData()).map(a=>a.name):[]).after("name").display()},model:L,pageState:h,icons:X,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,y.eq)(Y,["admin"],{},async()=>({sdks:await B.bl.get(J)}))},tt=h(66132);let te=M.V_.object({name:R.z.string().hint("ESP32S3, CHUWI, Arduino UNO...").static().id(),core:R.z.string().hidden(),ports:R.z.array(R.z.record(R.z.string(),R.z.any())),config:R.z.record(R.z.string(),R.z.any())}),tn=F.$.createDerived("DeviceBoardModel",te),ti={name:O.V,core:C.S},ta="/adminapi/v1/deviceboards",ts="/adminapi/v1/devicecores?all=1";var to={component:a=>{var r;let{pageState:h,initialItems:u,itemData:_,pageSession:f,extraData:g}=a,[y,w]=(0,$.useState)(null!==(r=null==g?void 0:g.cores)&&void 0!==r?r:(0,q.E)("pending"));return(0,U.a)(a=>{B.bl.get({url:ts},a)},w,null==g?void 0:g.cores),(0,m.jsx)(G.D,{title:"Device Boards",pageSession:f,children:(0,m.jsx)(H.V,{integratedChat:!0,entityName:"deviceboards",itemData:_,rowIcon:tt.b,sourceUrl:ta,initialItems:u,numColumnsForm:1,name:"board",onAdd:a=>a,onEdit:a=>a,columns:z.Z.columns(z.Z.column("name","name",!0),z.Z.column("core","core",!0,a=>(0,m.jsx)(V.A,{text:a.core,color:"$gray5"})),z.Z.column("ports","ports",!0,a=>(0,m.jsx)(V.A,{text:Object.keys(a.ports).length,color:"$gray5"}))),extraFieldsForms:{core:R.z.union(y.isLoaded?y.data.items.map(a=>R.z.literal(L.load(a).getId())):[]).after("name")},model:tn,pageState:h,icons:ti,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,y.eq)(ta,["admin"],{},async()=>({cores:await B.bl.get(ts)}))},tr=h(40198),tc=h(74705),tl=h(51813),th=h(62962),td=h(16399),tm=h(28554),tp=h(15486);let tu="  _ai-stretch _dsp-flex _fd-row _fb-auto _bxs-border-box _pos-relative _mih-0px _fs-1 _fg-1 _miw-10037 ",t_={name:O.V,board:tt.b},tf="/adminapi/v1/devicedefinitions",tg="/adminapi/v1/deviceboards?all=1",ty="/adminapi/v1/devicecores?all=1";var tb={component:a=>{var r,h;let{workspace:u,pageState:_,initialItems:f,itemData:g,pageSession:y,extraData:v}=a,[S,E]=$.useState(!1),[I,T]=$.useState(!1),{resolvedTheme:A}=(0,td.P)(),P={components:'[\n "mydevice",\n "esp32dev",\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n null,\n];\n\n'},[D,C]=(0,$.useState)(P.components),[O,M]=$.useState({}),F=(0,w.useRouter)(),N=(a,r)=>{O.setData({components:a,sdkConfig:{board:"esp32dev",framework:{type:"arduino"}}})},[W,Z]=(0,$.useState)(null!==(r=null==v?void 0:v.boards)&&void 0!==r?r:(0,q.E)("pending"));(0,U.a)(a=>{B.bl.get({url:tg},a)},Z,null==v?void 0:v.deviceDefinitions);let K=W.isLoaded?W.data.items.map(a=>tn.load(a).getData()):[],[X,Y]=(0,$.useState)(null!==(h=null==v?void 0:v.cores)&&void 0!==h?h:(0,q.E)("pending"));(0,U.a)(a=>{B.bl.get({url:ty},a)},Y,null==v?void 0:v.cores);let J=X.isLoaded?X.data.items.map(a=>L.load(a).getData()):[];return(0,m.jsxs)(G.D,{title:"Device Definitions",workspace:u,pageSession:y,children:[(0,m.jsx)(tl.a,{open:S,setOpen:a=>{E(a)},hideAccept:!0,style:{width:"80%",height:"80%",padding:"0px",overflow:"hidden"},children:(0,m.jsx)("div",{className:tu,children:(0,m.jsx)(tm.Z,{style:{width:"100%"},disableDots:!0,onSave:I?a=>{console.log("ON SAVE: ",a),N(a,"a")}:null,hideBaseComponents:!0,disableStart:!0,getFirstNode:a=>a.find(a=>"ArrayLiteralExpression"==a.type),showActionsBar:I,mode:"device",customComponents:(0,tp.B)(F.pathname,F.query),bridgeNode:!1,setSourceCode:a=>{console.log("set new sourcecode from flows: ",a),C(a)},sourceCode:D,themeMode:A,config:{masks:(0,tp.W)(F.pathname,F.query),layers:[]},bgColor:"transparent",dataNotify:a=>{a.notifyId},positions:[],disableSideBar:!0,display:!0,flowId:"flows-editor"},"flow")})}),(0,m.jsx)(H.V,{integratedChat:!0,entityName:"devicedefinitions",itemData:g,rowIcon:tr.p,sourceUrl:tf,initialItems:f,numColumnsForm:1,name:"Definition",onAdd:a=>(console.log("DATA (onAdd): ",a),a),onEdit:a=>(console.log("DATA (onEdit): ",a),a),columns:z.Z.columns(z.Z.column("name","name",!0),z.Z.column("board","board",!0,a=>(0,m.jsx)(V.A,{text:a.board,color:"$gray5"})),z.Z.column("sdk","sdk",!0,a=>(0,m.jsx)(V.A,{text:a.sdk,color:"$gray5"})),z.Z.column("config","config",!1,a=>(0,m.jsx)(th.Z,{onPress:async r=>{console.log("row from Edit: ",a),T(!1),E(!0),C(a.config.components)},children:"View"}))),extraFieldsForms:{board:R.z.union(K.map(a=>R.z.literal(a.name))).after("name"),sdk:R.z.union([R.z.any(),R.z.any()]).dependsOn("board").generateOptions(a=>{if(a.board){let r=K.find(r=>r.name===a.board);return J.find(a=>a.name===r.core).sdks}return[]}).after("name")},model:tc.q,pageState:_,icons:t_,dataTableGridProps:{itemMinWidth:300,spacing:20},customFields:{config:{component:(a,r,h,u)=>(console.log("inputs: ",{path:a,data:r,setData:h,mode:u}),"preview"==u)?(0,m.jsx)(m.Fragment,{}):(0,m.jsx)(th.Z,{onPress:m=>{E(!0),T(!0),"add"==u?C(P.components):C(r.components),M({path:a,data:r,setData:h,mode:u}),console.log("inputs: ",{path:a,data:r,setData:h,mode:u})},children:"Edit"}),hideLabel:!1}}})]})},getServerSideProps:(0,y.eq)(tf,["admin"],{},async()=>({boards:await B.bl.get(tg),cores:await B.bl.get(ty)}))};h(76649);var tw=h(65704),tv=h(32878);let tS={name:O.V,sdk:C.S},tx="/adminapi/v1/devicesdks";var tE={component:a=>{let{pageState:r,initialItems:h,itemData:u,pageSession:_}=a;return(0,m.jsx)(G.D,{title:"Device Sdks",pageSession:_,children:(0,m.jsx)(H.V,{integratedChat:!0,entityName:"devicesdks",itemData:u,rowIcon:tv.E,sourceUrl:tx,initialItems:h,numColumnsForm:1,name:"Sdk",onAdd:a=>a,onEdit:a=>a,columns:z.Z.columns(z.Z.column("id","id",!0),z.Z.column("name","name",!0)),model:K,pageState:r,icons:tS,dataTableGridProps:{itemMinWidth:300,spacing:20}})})},getServerSideProps:(0,y.eq)(tx,["admin"])},tI={"device-test/**":{component:T,getServerSideProps:P},"devices/**":tw.Z,"deviceSdks/**":tE,"deviceCores/**":Q,"deviceBoards/**":to,"deviceDefinitions/**":tb}},74705:function(a,r,h){"use strict";h.d(r,{q:function(){return g}});var m=h(30195),u=h(75370),_=h(54283);let f=u.V_.object({name:m.z.string().hint("Protofy screen controller...").static().id(),board:m.z.string().hidden(),sdk:m.z.string().hidden(),subsystems:m.z.record(m.z.string(),m.z.any()).optional(),config:m.z.record(m.z.string(),m.z.any())}),g=_.$.createDerived("DeviceDefinitionModel",f)},11010:function(a,r,h){"use strict";let m;h.d(r,{$:function(){return S},K:function(){return E}});var u=h(3089),_=h(58895),f=h(5436),g=h(71155),y=h(36076);let w="https://firmware.protofy.xyz/api/v1",v=async a=>{await a.device.setSignals({dataTerminalReady:!1,requestToSend:!0}),await a.device.setSignals({dataTerminalReady:!1,requestToSend:!1})},S=async()=>{let a=!0;try{m=await navigator.serial.requestPort()}catch(r){return r.name,a}if(!m)return a;try{await m.open({baudRate:115200})}catch(r){return a}},E=async a=>{let r,h;a({message:'Please hold "Boot" button of your ESP32 board.'});let S=new u.J(m),E=new _.p(S,115200,void 0);await m.close(),window.esploader=E;try{await E.main_fn()}catch(r){throw console.error(r),a({message:"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL.",details:{error:g.g.FAILED_INITIALIZING,details:r}}),await v(S),await S.disconnect(),"Failed to initialize. Try resetting your device or holding the BOOT button while clicking INSTALL."}if(console.log("chipFamily: ",h=E.chip.CHIP_NAME),!E.chip.ROM_TEXT)throw a({message:"Chip ".concat(h," is not supported"),details:{error:g.g.NOT_SUPPORTED,details:"Chip ".concat(h," is not supported")}}),await v(S),await S.disconnect(),"Chip ".concat(h," is not supported");if(a({message:"Initialized. Found ".concat(h),details:{done:!0}}),!(r=y.I.builds.find(a=>a.chipFamily===h)))throw a({message:"Your ".concat(h," board is not supported."),details:{error:g.g.NOT_SUPPORTED,details:h}}),await v(S),await S.disconnect(),"Your ".concat(h," board is not supported.");a({message:"Preparing installation...",details:{done:!1}});let I=r.parts.map(async a=>{let r=w+"/device/download?configuration=test.yaml&type=firmware-factory.bin",h=await fetch(r);if(!h.ok)throw Error("Downlading firmware ".concat(r," failed: ").concat(h.status));let m=new FileReader,u=await h.blob();return new Promise(a=>{m.addEventListener("load",()=>a(m.result)),m.readAsBinaryString(u)})}),T=[],A=0;for(let h=0;h<I.length;h++)try{let a=await I[h];T.push({data:a,address:r.parts[h].offset}),A+=a.length}catch(r){a({message:r.message,details:{error:g.g.FAILED_FIRMWARE_DOWNLOAD,details:r.message}}),await v(S),await S.disconnect();return}a({message:"Installation prepared",details:{done:!0}}),a({message:"Erasing device...",details:{done:!1}}),await E.erase_flash(),a({message:"Device erased",details:{done:!0}}),a({message:"Writing progress: 0%",details:{bytesTotal:A,bytesWritten:0,percentage:0}});let P=0;try{await E.write_flash(T,"keep","keep","keep",!1,!0,(r,h,m)=>{let u=h/m*T[r].data.length,_=Math.floor((P+u)/A*100);if(h===m){P+=u;return}a({message:"Writing progress: ".concat(_,"%"),details:{bytesTotal:A,bytesWritten:P+h,percentage:_}})})}catch(r){a({message:r.message,details:{error:g.g.WRITE_FAILED,details:r}}),await v(S),await S.disconnect();return}a({message:"Writing complete",details:{bytesTotal:A,bytesWritten:P,percentage:100}}),await (0,f._)(100),console.log("HARD RESET"),await v(S),console.log("DISCONNECT"),await S.disconnect(),a({message:"All done!"})}},65704:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(52322),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2784),_tamagui_lucide_icons_dist_esm_icons_book_open__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(40198),_tamagui_lucide_icons_dist_esm_icons_tag__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(32627),_tamagui_lucide_icons_dist_esm_icons_router__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(15230),_devicesSchemas__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(1940),protolib__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(48115),protolib__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(26887),protolib__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(40214),protolib__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(13997),protolib__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(50897),protolib__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(62962),protolib__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(91838),protolib__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1888),protolib_base__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(30195),_deviceDefinitions__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(74705),_devicesUtils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(11010),mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(39684),protodevice_src_DeviceModal__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(6873),protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(35327),protodevice_src_nodes_utils_subsystem__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(21621),_my_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(75296),protolib_base__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(6289);let _cn5="  is_Paragraph _col-675002279 _dsp-inline _bxs-border-box _ww-break-word _mt-20px _mr-0px _mb-0px _ml-20px _ff-299667014 _fow-233016233 _ls-167744152 _fos-229441313 _lh-222976666 _ussel-auto font_body ",_cn4="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _pr-1481558214 _pl-1481558214 _pb-1316330238 _fg-1 ",_cn3="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-0px _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",_cn2="  is_Paragraph _dsp-inline _bxs-border-box _ww-break-word _mt-1481558152 _mr-0px _mb-0px _ml-0px _col-312414369 _ff-299667014 _fow-233016140 _ls-167744059 _fos-229441220 _lh-222976573 _ussel-auto font_body ",_cn="  _ai-stretch _dsp-flex _fd-column _fb-auto _bxs-border-box _pos-relative _mih-0px _miw-0px _fs-1 _fg-1 _h-10037 ",MqttTest=a=>{let{onSetStage:r,onSetModalFeedback:h}=a,{message:m}=(0,mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__.mU)(["device/compile"]),[u,_]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([]);return(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{console.log("Compile Message: ",m);try{if(null==m?void 0:m.message){let a=JSON.parse(null==m?void 0:m.message.toString());"exit"==a.event&&0==a.code?(_([]),console.log("Succesfully compiled"),r("upload")):"exit"==a.event&&0!=a.code&&(console.error("Error compiling",u),h({message:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{className:_cn,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn2,children:"Error compiling code."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn3,children:"Please check your flow configuration."}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_my_ui__WEBPACK_IMPORTED_MODULE_3__.K,{textAlign:"left",f:1,mt:"$2",mb:"$5",children:u.map(a=>a.data).join("")})]}),details:{error:!0}})),_([...u,a])}}catch(a){console.log(a)}},[m]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.Fragment,{})},DevicesIcons={name:_tamagui_lucide_icons_dist_esm_icons_tag__WEBPACK_IMPORTED_MODULE_4__.V,deviceDefinition:_tamagui_lucide_icons_dist_esm_icons_book_open__WEBPACK_IMPORTED_MODULE_5__.p},callText=async(a,r,h,m)=>{var u={method:r,headers:{"Content-Type":"text/plain;charset=UTF-8"}};h&&(u.body=h);let _="?";-1!=a.indexOf("?")&&(_="&");var f=a+(m?_+"token="+m:"");return console.log("Deff URL: ",f),fetch(f,u).then(function(a){return 200==a.status?"ok":(console.log(a.status),a.ok,a)})},sourceUrl="/adminapi/v1/devices",definitionsSourceUrl="/adminapi/v1/deviceDefinitions?all=1";__webpack_exports__.Z={component:param=>{var _extraData_deviceDefinitions;let{pageState,initialItems,itemData,pageSession,extraData}=param;Object.keys(protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__.Z).forEach(a=>window[a]=protodevice_src_device__WEBPACK_IMPORTED_MODULE_6__.Z[a]);let[showModal,setShowModal]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[modalFeedback,setModalFeedback]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[stage,setStage]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(""),yamlRef=react__WEBPACK_IMPORTED_MODULE_1__.useRef(),flashDevice=async(deviceName,deviceDefinitionId)=>{console.log("Flash device: ",{deviceName,deviceDefinitionId});let response=await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get("/adminapi/v1/deviceDefinitions/"+deviceDefinitionId);if(response.isError){alert(response.error);return}let deviceDefinition=response.data,response1=await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get("/adminapi/v1/deviceBoards/"+deviceDefinition.board);if(response1.isError){alert(response1.error);return}console.log("---------deviceDefinition----------",deviceDefinition),deviceDefinition.board=response1.data;let jsCode=deviceDefinition.config.components,deviceCode="device("+jsCode+")";console.log("-------DEVICE CODE------------",deviceCode);let deviceObj=eval(deviceCode),componentsTree=deviceObj.getComponentsTree(deviceName,deviceDefinition),yaml=deviceObj.dump("yaml"),subsystems=deviceObj.getSubsystemsTree(deviceName,deviceDefinition);protolib__WEBPACK_IMPORTED_MODULE_7__.bl.post("/adminapi/v1/devices/"+deviceName,{subsystem:subsystems,deviceDefinition:deviceDefinitionId}),console.log("ComponentsTree: ",componentsTree),console.log("Subsystems: ",subsystems),yamlRef.current=yaml,setShowModal(!0);try{setStage("yaml")}catch(e){console.error("error writting firmware: ",e)}},sendMessage=async a=>{await fetch("https://firmware.protofy.xyz/api/v1/device/compile")},compile=async()=>{setModalFeedback({message:"Compiling firmware...",details:{error:!1}});let a={type:"spawn",configuration:"test.yaml"};sendMessage(JSON.stringify(a))},flashCb=a=>{console.log(a),setModalFeedback(r=>r=a)},onSelectPort=async()=>{let a=await (0,_devicesUtils__WEBPACK_IMPORTED_MODULE_8__.$)();a||setStage("write")},saveYaml=async a=>{console.log("Save Yaml"),console.log(await callText("https://firmware.protofy.xyz/api/v1/device/edit?configuration=test.yaml","POST",a))};(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{let a=async()=>{if("yaml"==stage)await saveYaml(yamlRef.current),setStage("compile");else if("compile"==stage)console.log("stage - compile"),await compile();else if("write"==stage)try{await (0,_devicesUtils__WEBPACK_IMPORTED_MODULE_8__.K)(flashCb),setStage("idle")}catch(a){flashCb({message:"Error writing the device. Check that the USB connection and serial port are correctly configured.",details:{error:!0}})}else if("upload"==stage){let a=navigator.userAgent.includes("Chrome")||navigator.userAgent.includes("Edge")||navigator.userAgent.includes("Opera");a?(setModalFeedback({message:"Connect your device and click select to chose the port. ",details:{error:!1}}),console.log("chormium based true")):(console.log("chormium based very false"),setModalFeedback({message:"You need Chrome, Opera or Edge to upload the code to the device.",details:{error:!0}}))}};a()},[stage]);let[deviceDefinitions,setDeviceDefinitions]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(null!==(_extraData_deviceDefinitions=null==extraData?void 0:extraData.deviceDefinitions)&&void 0!==_extraData_deviceDefinitions?_extraData_deviceDefinitions:(0,protolib_base__WEBPACK_IMPORTED_MODULE_9__.E)("pending"));return(0,protolib__WEBPACK_IMPORTED_MODULE_10__.a)(a=>{protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get({url:definitionsSourceUrl},a)},setDeviceDefinitions,null==extraData?void 0:extraData.deviceDefinitions),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(protolib__WEBPACK_IMPORTED_MODULE_11__.D,{title:"Devices",pageSession:pageSession,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(mqtt_react_hooks__WEBPACK_IMPORTED_MODULE_2__.wR,{brokerUrl:"wss://firmware.protofy.xyz/ws",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protodevice_src_DeviceModal__WEBPACK_IMPORTED_MODULE_12__.Z,{stage:stage,onCancel:()=>setShowModal(!1),onSelect:onSelectPort,modalFeedback:modalFeedback,showModal:showModal}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(MqttTest,{onSetStage:a=>setStage(a),onSetModalFeedback:a=>setModalFeedback(a)})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protolib__WEBPACK_IMPORTED_MODULE_13__.V,{integratedChat:!0,itemData:itemData,rowIcon:_tamagui_lucide_icons_dist_esm_icons_router__WEBPACK_IMPORTED_MODULE_14__.F,sourceUrl:sourceUrl,initialItems:initialItems,numColumnsForm:1,name:"device",onAdd:a=>a,onEdit:a=>a,columns:protolib__WEBPACK_IMPORTED_MODULE_15__.Z.columns(protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("name","name",!0),protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("device definition","deviceDefinition",!0),protolib__WEBPACK_IMPORTED_MODULE_15__.Z.column("config","config",!1,a=>(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(protolib__WEBPACK_IMPORTED_MODULE_16__.Z,{onPress:r=>{flashDevice(a.name,a.deviceDefinition)},children:"Upload"}))),extraFieldsForms:{deviceDefinition:protolib_base__WEBPACK_IMPORTED_MODULE_17__.z.union(deviceDefinitions.isLoaded?deviceDefinitions.data.items.map(a=>protolib_base__WEBPACK_IMPORTED_MODULE_17__.z.literal(_deviceDefinitions__WEBPACK_IMPORTED_MODULE_18__.q.load(a).getId())):[]).after("name")},model:_devicesSchemas__WEBPACK_IMPORTED_MODULE_19__.O,pageState:pageState,icons:DevicesIcons,dataTableGridProps:{itemMinHeight:320,itemMinWidth:320,spacing:20,onSelectItem:()=>{},getBody:(a,r)=>{var h,m=[];return null===(h=a.subsystem)||void 0===h||h.forEach(r=>{m.push((0,protodevice_src_nodes_utils_subsystem__WEBPACK_IMPORTED_MODULE_20__.Z)(r,a.name))}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:_cn4,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(protolib__WEBPACK_IMPORTED_MODULE_21__.I,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("p",{className:_cn5,children:a.name}),m]})})}}})]})},getServerSideProps:(0,protolib__WEBPACK_IMPORTED_MODULE_22__.eq)(sourceUrl,["admin"],{},async()=>({initialDeviceDefinitions:await protolib__WEBPACK_IMPORTED_MODULE_7__.bl.get(definitionsSourceUrl)}))},__webpack_require__(8638)},1940:function(a,r,h){"use strict";h.d(r,{O:function(){return g}});var m=h(30195),u=h(75370),_=h(54283);let f=u.V_.object({name:m.z.string().hint("Device name").static().regex(/^[a-z0-9A-Z]+$/,"Only lower case chars or numbers").id().search(),deviceDefinition:m.z.string().hidden(),substitutions:m.z.record(m.z.string().optional(),m.z.any().optional()).optional(),subsystem:m.z.record(m.z.string(),m.z.any()).optional(),data:m.z.array(m.z.record(m.z.string(),m.z.any())).optional(),location:m.z.object({lat:m.z.string(),long:m.z.string()}).optional().location("lat","long")}),g=_.$.createDerived("DevicesModel",f)},62962:function(a,r,h){"use strict";var m=h(52322),u=h(66306),_=h(2784);let f=_.forwardRef((a,r)=>(0,m.jsx)(u.zx,{ref:r,borderRadius:"$10",size:"$3",elevate:!0,fontFamily:"$silkscreen",space:"$3",...a,children:a.children}));r.Z=f},6873:function(a,r,h){"use strict";h.d(r,{Z:function(){return T}});var m=h(52322),u=h(2784),_={src:"/admin/_next/static/media/protofitoCompiling.7548c399.gif"},f={src:"/admin/_next/static/media/protofitoCompilingW.1d28e002.gif"},g={src:"/admin/_next/static/media/protofitoLoading.b3d41156.gif"},y={src:"/admin/_next/static/media/protofitoLoadingW.a84348f3.gif"},w={src:"/admin/_next/static/media/protofitoDancing.5a429207.gif"},v={src:"/admin/_next/static/media/protofitoDancingW.fa27d98c.gif"},S=h(51813),E=h(52026);let I=a=>{var r,h;let{stage:I,onCancel:T,onSelect:A,showModal:P,modalFeedback:D}=a,C=null==D?void 0:null===(r=D.details)||void 0===r?void 0:r.error,O=["write"].includes(I)&&!C&&!(null==D?void 0:null===(h=D.message)||void 0===h?void 0:h.includes('Please hold "Boot"'));O||["idle","compile"].includes(I);let R=(0,E.useThemeName)(),M={yaml:"Uploading yaml to the project...",compile:"Compiling firmware...",upload:"Connect your device and click select to chose the port. ",write:"Writting firmware to device. Please do not unplug your device.",idle:"Device configured successfully. You can unplug your device."},[F,N]=u.useState(M[I]),L=()=>"upload"===I&&!C&&(0,m.jsx)("div",{style:{textAlign:"center",color:C?"red":"",marginTop:C?"80px":"",marginBottom:"0px"},children:(0,m.jsxs)(m.Fragment,{children:["If you don't see your device on the menu, download device drivers on",(0,m.jsx)("a",{href:"https://www.silabs.com/documents/public/software/CP210x_Windows_Drivers.zip",target:"_blank",style:{paddingLeft:"5px"},children:"Windows"}),",",(0,m.jsx)("a",{href:"https://www.silabs.com/documents/public/software/Mac_OSX_VCP_Driver.zip",target:"_blank",style:{paddingInline:"5px"},children:"Mac"}),"or ",(0,m.jsx)("a",{href:"https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers?tab=downloads",target:"_blank",children:"other OS"})]})}),q={compile:"1",upload:"2",write:"3",idle:"4"};return(0,m.jsx)(S.a,{open:P,hideAccept:!0,children:(0,m.jsxs)("div",{style:{height:"350px",width:"400px",position:"relative",overflow:"visible",justifyContent:"space-between",display:"flex",flexDirection:"column"},children:[(0,m.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[(0,m.jsx)("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:"xs"},children:"[".concat(q[I],"/").concat(Object.keys(q).length,"]")}),(0,m.jsx)("div",{style:{flexGrow:1,textAlign:"center",color:C?"red":"",marginBottom:"0px",marginTop:"2"===q[I]?"100px":"0px"},children:D&&["write","compile","upload"].includes(I)?D.message:F}),(0,m.jsx)(L,{})]}),O?(0,m.jsx)("img",{alt:"protofito loading",style:{height:"160px",width:"300px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==R?g.src:y.src}):null,"idle"!=I||C?null:(0,m.jsx)("img",{alt:"protofito dancing",style:{height:"160px",width:"190px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==R?w.src:v.src}),"compile"!=I||C?null:(0,m.jsx)("img",{alt:"protofito compiling",style:{height:"160px",width:"180px",alignSelf:"center",marginTop:"30px",marginBottom:"10px",objectFit:"cover"},src:"light"==R?_.src:f.src}),(0,m.jsxs)("div",{style:{justifyContent:"center",alignSelf:"center",display:"flex",gap:"20px"},children:["write"!=I&&"idle"!=I||C?(0,m.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"#cccccc40",borderRadius:"10px"},onClick:()=>{T()},children:"Cancel"}):(0,m.jsx)(m.Fragment,{}),"upload"==I?(0,m.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{A()},children:"Select"}):(0,m.jsx)(m.Fragment,{}),"idle"==I?(0,m.jsx)("button",{style:{padding:"10px 20px 10px 20px",backgroundColor:"black",color:"white",borderRadius:"10px"},onClick:()=>{T()},children:"Done!"}):(0,m.jsx)(m.Fragment,{})]})]})})};var T=I},71155:function(a,r,h){"use strict";var m,u;h.d(r,{g:function(){return u}}),function(a){a.INITIALIZING="initializing",a.PREPARING="preparing",a.ERASING="erasing",a.WRITING="writing",a.FINISHED="finished",a.ERROR="error"}(m||(m={})),function(a){a.FAILED_INITIALIZING="failed_initialize",a.FAILED_MANIFEST_FETCH="fetch_manifest_failed",a.NOT_SUPPORTED="not_supported",a.FAILED_FIRMWARE_DOWNLOAD="failed_firmware_download",a.WRITE_FAILED="write_failed"}(u||(u={}))},58895:function(a,r,h){"use strict";h.d(r,{p:function(){return f}});class m extends Error{}var u=h(32845);async function _(a){switch(a){case 15736195:{let{ESP32ROM:a}=await h.e(1568).then(h.bind(h,91568));return new a}case 1763790959:case 456216687:{let{ESP32C3ROM:a}=await h.e(5867).then(h.bind(h,65867));return new a}case 9:{let{ESP32S3ROM:a}=await h.e(5963).then(h.bind(h,15963));return new a}case 1990:{let{ESP32S2ROM:a}=await h.e(2579).then(h.bind(h,2579));return new a}case 4293968129:{let{ESP8266ROM:a}=await h.e(90).then(h.bind(h,40090));return new a}default:return null}}class f{_sleep(a){return new Promise(r=>setTimeout(r,a))}write(a){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.terminal?r?this.terminal.writeLine(a):this.terminal.write(a):console.log(a)}error(a){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write("Error: ".concat(a),r)}info(a){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.write(a,r)}debug(a){let r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this.debugLogging&&this.write("Debug: ".concat(a),r)}_short_to_bytearray(a){return new Uint8Array([255&a,a>>8&255])}_int_to_bytearray(a){return new Uint8Array([255&a,a>>8&255,a>>16&255,a>>24&255])}_bytearray_to_short(a,r){return a|r>>8}_bytearray_to_int(a,r,h,m){return a|r<<8|h<<16|m<<24}_appendBuffer(a,r){let h=new Uint8Array(a.byteLength+r.byteLength);return h.set(new Uint8Array(a),0),h.set(new Uint8Array(r),a.byteLength),h.buffer}_appendArray(a,r){let h=new Uint8Array(a.length+r.length);return h.set(a,0),h.set(r,a.length),h}ui8ToBstr(a){let r="";for(let h=0;h<a.length;h++)r+=String.fromCharCode(a[h]);return r}bstrToUi8(a){let r=new Uint8Array(a.length);for(let h=0;h<a.length;h++)r[h]=a.charCodeAt(h);return r}async flush_input(){try{await this.transport.rawRead(200)}catch(a){this.error(a.message)}}async command(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Uint8Array(0),h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=!(arguments.length>3)||void 0===arguments[3]||arguments[3],_=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;if(null!=a){let m;let u=new Uint8Array(8+r.length);for(m=0,u[0]=0,u[1]=a,u[2]=this._short_to_bytearray(r.length)[0],u[3]=this._short_to_bytearray(r.length)[1],u[4]=this._int_to_bytearray(h)[0],u[5]=this._int_to_bytearray(h)[1],u[6]=this._int_to_bytearray(h)[2],u[7]=this._int_to_bytearray(h)[3];m<r.length;m++)u[8+m]=r[m];await this.transport.write(u)}if(!u)return[0,new Uint8Array(0)];for(let r=0;r<100;r++){let r=await this.transport.read(_),h=r[0],u=r[1],f=this._bytearray_to_int(r[4],r[5],r[6],r[7]),g=r.slice(8);if(1==h){if(null==a||u==a)return[f,g];if(0!=g[0]&&g[1]==this.ROM_INVALID_RECV_MSG)throw await this.flush_input(),new m("unsupported command error")}}throw new m("invalid response")}async read_reg(a){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,h=this._int_to_bytearray(a),m=await this.command(this.ESP_READ_REG,h,void 0,void 0,r);return m[0]}async write_reg(a,r){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4294967295,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,_=this._appendArray(this._int_to_bytearray(a),this._int_to_bytearray(r));_=this._appendArray(_,this._int_to_bytearray(h)),_=this._appendArray(_,this._int_to_bytearray(m)),u>0&&(_=this._appendArray(_,this._int_to_bytearray(this.chip.UART_DATE_REG_ADDR)),_=this._appendArray(_,this._int_to_bytearray(0)),_=this._appendArray(_,this._int_to_bytearray(0)),_=this._appendArray(_,this._int_to_bytearray(u))),await this.check_command("write target memory",this.ESP_WRITE_REG,_)}async sync(){let a;this.debug("Sync");let r=new Uint8Array(36);for(a=0,r[0]=7,r[1]=7,r[2]=18,r[3]=32;a<32;a++)r[4+a]=85;try{let a=await this.command(8,r,void 0,void 0,100);return a}catch(a){throw this.debug("Sync err "+a),a}}async _connect_attempt(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.debug("_connect_attempt "+a+" "+r),"no_reset"!==a&&(this.transport.get_pid()===this.USB_JTAG_SERIAL_PID?(await this.transport.setRTS(!1),await this.transport.setDTR(!1),await this._sleep(100),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(100),await this.transport.setRTS(!0),await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)):(await this.transport.setDTR(!1),await this.transport.setRTS(!0),await this._sleep(100),r&&await this._sleep(2e3),await this.transport.setDTR(!0),await this.transport.setRTS(!1),await this._sleep(50)),await this.transport.setDTR(!1));let h=0,m=!0;for(;m;){try{let a=await this.transport.read(1e3);h+=a.length}catch(a){if(this.debug(a.message),a instanceof Error){m=!1;break}}await this._sleep(50)}for(this.transport.slip_reader_enabled=!0,h=7;h--;){try{let a=await this.sync();return this.debug(a[0].toString()),"success"}catch(a){a instanceof Error&&(r?this.info("_",!1):this.info(".",!1))}await this._sleep(50)}return"error"}async connect(){let a,r,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset",u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(this.info("Connecting...",!1),await this.transport.connect(this.rom_baudrate),a=0;a<u&&"success"!==(r=await this._connect_attempt(h,!1))&&"success"!==(r=await this._connect_attempt(h,!0));a++);if("success"!==r)throw new m("Failed to connect with the device");if(this.info("\n\r",!1),!f){let a=await this.read_reg(1073745920)>>>0;this.debug("Chip Magic "+a.toString(16));let r=await _(a);if(null===this.chip)throw new m("Unexpected CHIP magic value ".concat(a,". Failed to autodetect chip type."));this.chip=r}}async detect_chip(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.connect(a),this.info("Detecting chip type... ",!1),null!=this.chip?this.info(this.chip.CHIP_NAME):this.info("unknown!")}async check_command(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Uint8Array(0),m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3;this.debug("check_command "+a);let _=await this.command(r,h,m,void 0,u);return _[1].length>4?_[1]:_[0]}async mem_begin(a,r,h,m){this.debug("mem_begin "+a+" "+r+" "+h+" "+m.toString(16));let u=this._appendArray(this._int_to_bytearray(a),this._int_to_bytearray(r));u=this._appendArray(u,this._int_to_bytearray(h)),u=this._appendArray(u,this._int_to_bytearray(m)),await this.check_command("enter RAM download mode",this.ESP_MEM_BEGIN,u)}async mem_block(a,r){let h=this._appendArray(this._int_to_bytearray(a.length),this._int_to_bytearray(r));h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,this._int_to_bytearray(0)),h=this._appendArray(h,a);let m=this.checksum(a);await this.check_command("write to target RAM",this.ESP_MEM_DATA,h,m)}async mem_finish(a){let r=0===a?1:0,h=this._appendArray(this._int_to_bytearray(r),this._int_to_bytearray(a));await this.check_command("leave RAM download mode",this.ESP_MEM_END,h,void 0,50)}async flash_spi_attach(a){let r=this._int_to_bytearray(a);await this.check_command("configure SPI flash pins",this.ESP_SPI_ATTACH,r)}async flash_begin(a,r){let h=Math.floor((a+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),m=this.chip.get_erase_size(r,a),u=new Date,_=u.getTime(),f=3e3;!1==this.IS_STUB&&(f=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,a)),this.debug("flash begin "+m+" "+h+" "+this.FLASH_WRITE_SIZE+" "+r+" "+a);let g=this._appendArray(this._int_to_bytearray(m),this._int_to_bytearray(h));g=this._appendArray(g,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),g=this._appendArray(g,this._int_to_bytearray(r)),!1==this.IS_STUB&&(g=this._appendArray(g,this._int_to_bytearray(0))),await this.check_command("enter Flash download mode",this.ESP_FLASH_BEGIN,g,void 0,f);let y=u.getTime();return 0!=a&&!1==this.IS_STUB&&this.info("Took "+(y-_)/1e3+"."+(y-_)%1e3+"s to erase flash block"),h}async flash_defl_begin(a,r,h){let m,u;let _=Math.floor((r+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),f=Math.floor((a+this.FLASH_WRITE_SIZE-1)/this.FLASH_WRITE_SIZE),g=new Date,y=g.getTime();this.IS_STUB?(m=a,u=3e3):(m=f*this.FLASH_WRITE_SIZE,u=this.timeout_per_mb(this.ERASE_REGION_TIMEOUT_PER_MB,m)),this.info("Compressed "+a+" bytes to "+r+"...");let w=this._appendArray(this._int_to_bytearray(m),this._int_to_bytearray(_));w=this._appendArray(w,this._int_to_bytearray(this.FLASH_WRITE_SIZE)),w=this._appendArray(w,this._int_to_bytearray(h)),("ESP32-S2"===this.chip.CHIP_NAME||"ESP32-S3"===this.chip.CHIP_NAME||"ESP32-C3"===this.chip.CHIP_NAME)&&!1===this.IS_STUB&&(w=this._appendArray(w,this._int_to_bytearray(0))),await this.check_command("enter compressed flash mode",this.ESP_FLASH_DEFL_BEGIN,w,void 0,u);let v=g.getTime();return 0!=a&&!1===this.IS_STUB&&this.info("Took "+(v-y)/1e3+"."+(v-y)%1e3+"s to erase flash block"),_}async flash_block(a,r,h){let m=this._appendArray(this._int_to_bytearray(a.length),this._int_to_bytearray(r));m=this._appendArray(m,this._int_to_bytearray(0)),m=this._appendArray(m,this._int_to_bytearray(0)),m=this._appendArray(m,a);let u=this.checksum(a);await this.check_command("write to target Flash after seq "+r,this.ESP_FLASH_DATA,m,u,h)}async flash_defl_block(a,r,h){let m=this._appendArray(this._int_to_bytearray(a.length),this._int_to_bytearray(r));m=this._appendArray(m,this._int_to_bytearray(0)),m=this._appendArray(m,this._int_to_bytearray(0)),m=this._appendArray(m,a);let u=this.checksum(a);this.debug("flash_defl_block "+a[0].toString(16)+" "+a[1].toString(16)),await this.check_command("write compressed data to flash after seq "+r,this.ESP_FLASH_DEFL_DATA,m,u,h)}async flash_finish(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=a?0:1,h=this._int_to_bytearray(r);await this.check_command("leave Flash mode",this.ESP_FLASH_END,h)}async flash_defl_finish(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=a?0:1,h=this._int_to_bytearray(r);await this.check_command("leave compressed flash mode",this.ESP_FLASH_DEFL_END,h)}async run_spiflash_command(a,r,h){let u,_;let f=-2147483648,g=268435456,y=134217728,w=this.chip.SPI_REG_BASE,v=w+0,S=w+this.chip.SPI_USR_OFFS,E=w+this.chip.SPI_USR1_OFFS,I=w+this.chip.SPI_USR2_OFFS,T=w+this.chip.SPI_W0_OFFS;u=null!=this.chip.SPI_MOSI_DLEN_OFFS?async(a,r)=>{let h=w+this.chip.SPI_MOSI_DLEN_OFFS,m=w+this.chip.SPI_MISO_DLEN_OFFS;a>0&&await this.write_reg(h,a-1),r>0&&await this.write_reg(m,r-1)}:async(a,r)=>{let h=E,m=17,u=8,_=0===a?0:a-1,f=0===r?0:r-1,g=f<<u|_<<m;await this.write_reg(h,g)};let A=262144,P=28;if(h>32)throw new m("Reading more than 32 bits back from a SPI flash operation is unsupported");if(r.length>64)throw new m("Writing more than 64 bytes of data with one SPI command is unsupported");let D=8*r.length,C=await this.read_reg(S),O=await this.read_reg(I),R=f;h>0&&(R|=g),D>0&&(R|=y),await u(D,h),await this.write_reg(S,R);let M=7<<P|a;if(await this.write_reg(I,M),0==D)await this.write_reg(T,0);else{if(r.length%4!=0){let a=new Uint8Array(r.length%4);r=this._appendArray(r,a)}let a=T;for(_=0;_<r.length-4;_+=4)M=this._bytearray_to_int(r[_],r[_+1],r[_+2],r[_+3]),await this.write_reg(a,M),a+=4}for(await this.write_reg(v,A),_=0;_<10&&0!=(M=await this.read_reg(v)&A);_++);if(10===_)throw new m("SPI command did not complete in time");let F=await this.read_reg(T);return await this.write_reg(S,C),await this.write_reg(I,O),F}async read_flash_id(){let a=159,r=new Uint8Array(0);return await this.run_spiflash_command(a,r,24)}async erase_flash(){this.info("Erasing flash (this may take a while)...");let a=new Date,r=a.getTime(),h=await this.check_command("erase flash",this.ESP_ERASE_FLASH,void 0,void 0,this.CHIP_ERASE_TIMEOUT);a=new Date;let m=a.getTime();return this.info("Chip erase completed successfully in "+(m-r)/1e3+"s"),h}toHex(a){return Array.prototype.map.call(a,a=>("00"+a.toString(16)).slice(-2)).join("")}async flash_md5sum(a,r){let h=this.timeout_per_mb(this.MD5_TIMEOUT_PER_MB,r),m=this._appendArray(this._int_to_bytearray(a),this._int_to_bytearray(r));m=this._appendArray(m,this._int_to_bytearray(0)),m=this._appendArray(m,this._int_to_bytearray(0));let u=await this.check_command("calculate md5sum",this.ESP_SPI_FLASH_MD5,m,void 0,h);u instanceof Uint8Array&&u.length>16&&(u=u.slice(0,16));let _=this.toHex(u);return _}async run_stub(){let a;this.info("Uploading stub...");let r=atob(this.chip.ROM_TEXT),h=r.split("").map(function(a){return a.charCodeAt(0)}),u=new Uint8Array(h);h=(r=atob(this.chip.ROM_DATA)).split("").map(function(a){return a.charCodeAt(0)});let _=new Uint8Array(h),f=Math.floor((u.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK);for(await this.mem_begin(u.length,f,this.ESP_RAM_BLOCK,this.chip.TEXT_START),a=0;a<f;a++){let r=a*this.ESP_RAM_BLOCK,h=r+this.ESP_RAM_BLOCK;await this.mem_block(u.slice(r,h),a)}for(f=Math.floor((_.length+this.ESP_RAM_BLOCK-1)/this.ESP_RAM_BLOCK),await this.mem_begin(_.length,f,this.ESP_RAM_BLOCK,this.chip.DATA_START),a=0;a<f;a++){let r=a*this.ESP_RAM_BLOCK,h=r+this.ESP_RAM_BLOCK;await this.mem_block(_.slice(r,h),a)}this.info("Running stub..."),await this.mem_finish(this.chip.ENTRY);for(let a=0;a<100;a++){let a=await this.transport.read(1e3,6);if(79===a[0]&&72===a[1]&&65===a[2]&&73===a[3])return this.info("Stub running..."),this.IS_STUB=!0,this.FLASH_WRITE_SIZE=16384,this.chip}throw new m("Failed to start stub. Unexpected response")}async change_baud(){this.info("Changing baudrate to "+this.baudrate);let a=this.IS_STUB?this.transport.baudrate:0,r=this._appendArray(this._int_to_bytearray(this.baudrate),this._int_to_bytearray(a)),h=await this.command(this.ESP_CHANGE_BAUDRATE,r);this.debug(h[0].toString()),this.info("Changed"),await this.transport.disconnect(),await this._sleep(50),await this.transport.connect(this.baudrate);try{await this.transport.rawRead(500)}catch(a){this.debug(a.message)}}async main_fn(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default_reset";await this.detect_chip(a);let r=await this.chip.get_chip_description(this);return this.info("Chip is "+r),this.info("Features: "+await this.chip.get_chip_features(this)),this.info("Crystal is "+await this.chip.get_crystal_freq(this)+"MHz"),this.info("MAC: "+await this.chip.read_mac(this)),await this.chip.read_mac(this),void 0!==this.chip._post_connect&&await this.chip._post_connect(this),await this.run_stub(),this.rom_baudrate!==this.baudrate&&await this.change_baud(),r}parse_flash_size_arg(a){if(void 0===this.chip.FLASH_SIZES[a])throw new m("Flash size "+a+" is not supported by this chip type. Supported sizes: "+this.chip.FLASH_SIZES);return this.chip.FLASH_SIZES[a]}_update_image_flash_params(a,r,h,m,u){if(this.debug("_update_image_flash_params "+h+" "+m+" "+u),a.length<8||r!=this.chip.BOOTLOADER_FLASH_OFFSET)return a;if("keep"===h&&"keep"===m&&"keep"===u)return this.info("Not changing the image"),a;let _=parseInt(a[0]),f=parseInt(a[2]),g=parseInt(a[3]);if(_!==this.ESP_IMAGE_MAGIC)return this.info("Warning: Image file at 0x"+r.toString(16)+" doesn't look like an image file, so not changing any flash settings."),a;if("keep"!==m){let a={qio:0,qout:1,dio:2,dout:3};f=a[m]}let y=15&g;if("keep"!==u){let a={"40m":0,"26m":1,"20m":2,"80m":15};y=a[u]}let w=240&g;"keep"!==h&&(w=this.parse_flash_size_arg(h));let v=f<<8|y+w;return this.info("Flash params set to "+v.toString(16)),parseInt(a[2])!==f<<8&&(a=a.substring(0,2)+(f<<8).toString()+a.substring(3)),parseInt(a[3])!==y+w&&(a=a.substring(0,3)+(y+w).toString()+a.substring(4)),a}async write_flash(a){let r,h,_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keep",f=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"keep",g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"keep",y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=!(arguments.length>5)||void 0===arguments[5]||arguments[5],v=arguments.length>6?arguments[6]:void 0,S=arguments.length>7?arguments[7]:void 0;if(this.debug("EspLoader program"),"keep"!==_){let r=this.flash_size_bytes(_);for(let h=0;h<a.length;h++)if(a[h].data.length+a[h].address>r)throw new m("File ".concat(h+1," doesn't fit in the available flash"))}!0===this.IS_STUB&&!0===y&&await this.erase_flash();for(let y=0;y<a.length;y++){let E;this.debug("Data Length "+a[y].data.length),r=a[y].data;let I=a[y].data.length%4;if(I>0&&(r+="\xff\xff\xff\xff".substring(4-I)),h=a[y].address,this.debug("Image Length "+r.length),0===r.length){this.debug("Warning: File is empty");continue}r=this._update_image_flash_params(r,h,_,f,g);let T=null;S&&(T=S(r),this.debug("Image MD5 "+T));let A=r.length;if(w){let a=this.bstrToUi8(r);r=this.ui8ToBstr((0,u.deflate)(a,{level:9})),E=await this.flash_defl_begin(A,r.length,h)}else E=await this.flash_begin(A,h);let P=0,D=0,C=r.length;v&&v(y,0,C);let O=new Date,R=O.getTime(),M=5e3,F=new u.Inflate({chunkSize:1}),N=0;for(F.onData=function(a){N+=a.byteLength};r.length>0;){this.debug("Write loop "+h+" "+P+" "+E),this.info("Writing at 0x"+(h+N).toString(16)+"... ("+Math.floor(100*(P+1)/E)+"%)");let a=this.bstrToUi8(r.slice(0,this.FLASH_WRITE_SIZE));if(w){let r=N;F.push(a,!1);let h=N-r,m=3e3;this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)>3e3&&(m=this.timeout_per_mb(this.ERASE_WRITE_TIMEOUT_PER_MB,h)),!1===this.IS_STUB&&(M=m),await this.flash_defl_block(a,P,M),this.IS_STUB&&(M=m)}else throw new m("Yet to handle Non Compressed writes");D+=a.length,r=r.slice(this.FLASH_WRITE_SIZE,r.length),P++,v&&v(y,D,C)}this.IS_STUB&&await this.read_reg(this.CHIP_DETECT_MAGIC_REG_ADDR,M),O=new Date;let L=O.getTime()-R;if(w&&this.info("Wrote "+A+" bytes ("+D+" compressed) at 0x"+h.toString(16)+" in "+L/1e3+" seconds."),T){let a=await this.flash_md5sum(h,A);if(new String(a).valueOf()!=new String(T).valueOf())throw this.info("File  md5: "+T),this.info("Flash md5: "+a),new m("MD5 of file does not match data in flash!");this.info("Hash of data verified.")}}this.info("Leaving..."),this.IS_STUB&&(await this.flash_begin(0,0),w?await this.flash_defl_finish():await this.flash_finish())}async flash_id(){this.debug("flash_id");let a=await this.read_flash_id();this.info("Manufacturer: "+(255&a).toString(16));let r=a>>16&255;this.info("Device: "+(a>>8&255).toString(16)+r.toString(16)),this.info("Detected flash size: "+this.DETECTED_FLASH_SIZES[r])}async hard_reset(){await this.transport.setRTS(!0),await this._sleep(100),await this.transport.setRTS(!1)}async soft_reset(){if(this.IS_STUB){if("ESP8266"!=this.chip.CHIP_NAME)throw new m("Soft resetting is currently only supported on ESP8266");await this.command(this.ESP_RUN_USER_CODE,void 0,void 0,!1)}else await this.flash_begin(0,0),await this.flash_finish(!1)}constructor(a,r,h,m=115200,u=!1){this.transport=a,this.baudrate=r,this.terminal=h,this.rom_baudrate=m,this.debugLogging=u,this.ESP_RAM_BLOCK=6144,this.ESP_FLASH_BEGIN=2,this.ESP_FLASH_DATA=3,this.ESP_FLASH_END=4,this.ESP_MEM_BEGIN=5,this.ESP_MEM_END=6,this.ESP_MEM_DATA=7,this.ESP_WRITE_REG=9,this.ESP_READ_REG=10,this.ESP_SPI_ATTACH=13,this.ESP_CHANGE_BAUDRATE=15,this.ESP_FLASH_DEFL_BEGIN=16,this.ESP_FLASH_DEFL_DATA=17,this.ESP_FLASH_DEFL_END=18,this.ESP_SPI_FLASH_MD5=19,this.ESP_ERASE_FLASH=208,this.ESP_ERASE_REGION=209,this.ESP_RUN_USER_CODE=211,this.ESP_IMAGE_MAGIC=233,this.ESP_CHECKSUM_MAGIC=239,this.ROM_INVALID_RECV_MSG=5,this.ERASE_REGION_TIMEOUT_PER_MB=3e4,this.ERASE_WRITE_TIMEOUT_PER_MB=4e4,this.MD5_TIMEOUT_PER_MB=8e3,this.CHIP_ERASE_TIMEOUT=12e4,this.MAX_TIMEOUT=2*this.CHIP_ERASE_TIMEOUT,this.CHIP_DETECT_MAGIC_REG_ADDR=1073745920,this.DETECTED_FLASH_SIZES={18:"256KB",19:"512KB",20:"1MB",21:"2MB",22:"4MB",23:"8MB",24:"16MB"},this.USB_JTAG_SERIAL_PID=4097,this.checksum=function(a){let r;let h=239;for(r=0;r<a.length;r++)h^=a[r];return h},this.timeout_per_mb=function(a,r){let h=a*(r/1e6);return h<3e3?3e3:h},this.flash_size_bytes=function(a){let r=-1;return -1!==a.indexOf("KB")?r=1024*parseInt(a.slice(0,a.indexOf("KB"))):-1!==a.indexOf("MB")&&(r=1048576*parseInt(a.slice(0,a.indexOf("MB")))),r},this.IS_STUB=!1,this.FLASH_WRITE_SIZE=16384,this.terminal&&this.terminal.clean(),this.info("esptool.js"),this.info("Serial port "+this.transport.get_info())}}},3089:function(a,r,h){"use strict";h.d(r,{J:function(){return m}});class m{get_info(){let a=this.device.getInfo();return a.usbVendorId&&a.usbProductId?"WebSerial VendorID 0x".concat(a.usbVendorId.toString(16)," ProductID 0x").concat(a.usbProductId.toString(16)):""}get_pid(){return this.device.getInfo().usbProductId}slip_writer(a){let r=0,h=0,m=0;for(h=0;h<a.length;h++)(192===a[h]||219===a[h])&&r++;let u=new Uint8Array(2+r+a.length);for(h=0,u[0]=192,m=1;h<a.length;h++,m++){if(192===a[h]){u[m++]=219,u[m]=220;continue}if(219===a[h]){u[m++]=219,u[m]=221;continue}u[m]=a[h]}return u[m]=192,u}async write(a){let r=this.slip_writer(a);if(this.device.writable){let a=this.device.writable.getWriter();await a.write(r),a.releaseLock()}}_appendBuffer(a,r){let h=new Uint8Array(a.byteLength+r.byteLength);return h.set(new Uint8Array(a),0),h.set(new Uint8Array(r),a.byteLength),h.buffer}slip_reader(a){let r=0,h=0,m=0,u="init";for(;r<a.length;){if("init"===u&&192==a[r]){h=r+1,u="valid_data",r++;continue}if("valid_data"===u&&192==a[r]){m=r-1,u="packet_complete";break}r++}if("packet_complete"!==u)return this.left_over=a,new Uint8Array(0);this.left_over=a.slice(m+2);let _=new Uint8Array(m-h+1),f=0;for(r=h;r<=m;r++,f++){if(219===a[r]&&220===a[r+1]){_[f]=192,r++;continue}if(219===a[r]&&221===a[r+1]){_[f]=219,r++;continue}_[f]=a[r]}let g=_.slice(0,f);return g}async read(){let a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,m=this.left_over;if(this.left_over=new Uint8Array(0),this.slip_reader_enabled){let a=this.slip_reader(m);if(a.length>0)return a;m=this.left_over,this.left_over=new Uint8Array(0)}if(null==this.device.readable)return this.left_over;let u=this.device.readable.getReader();try{r>0&&(a=setTimeout(function(){u.cancel()},r));do{let{value:a,done:r}=await u.read();if(r)throw this.left_over=m,Error("Timeout");let h=new Uint8Array(this._appendBuffer(m.buffer,a.buffer));m=h}while(m.length<h)}finally{r>0&&clearTimeout(a),u.releaseLock()}return this.slip_reader_enabled?this.slip_reader(m):m}async rawRead(){let a,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(0!=this.left_over.length){let a=this.left_over;return this.left_over=new Uint8Array(0),a}if(!this.device.readable)return this.left_over;let h=this.device.readable.getReader();try{r>0&&(a=setTimeout(function(){h.cancel()},r));let{value:m,done:u}=await h.read();if(u)throw Error("Timeout");return m}finally{r>0&&clearTimeout(a),h.releaseLock()}}async setRTS(a){await this.device.setSignals({requestToSend:a}),await this.setDTR(this._DTR_state)}async setDTR(a){this._DTR_state=a,await this.device.setSignals({dataTerminalReady:a})}async connect(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:115200;await this.device.open({baudRate:a}),this.baudrate=a,this.left_over=new Uint8Array(0)}async sleep(a){return new Promise(r=>setTimeout(r,a))}async waitForUnlock(a){for(;this.device.readable&&this.device.readable.locked||this.device.writable&&this.device.writable.locked;)await this.sleep(a)}async disconnect(){await this.waitForUnlock(400),await this.device.close()}constructor(a){this.device=a,this.slip_reader_enabled=!1,this.left_over=new Uint8Array(0),this.baudrate=0,this._DTR_state=!1}}},35327:function(a,r,h){"use strict";h.d(r,{Z:function(){return tO}});class m{attach(a,r){let h=[{name:this.type,config:{ssid:this.ssid,password:this.password,power_save_mode:this.power_save_mode}}];return h.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}constructor(a,r,h){this.ssid=a,this.password=r,this.power_save_mode=h,this.type="wifi"}}function u(a,r,h){return new m(a,r,h)}class _{attach(a,r){this.topic_prefix=r.esphome.name;let h=[{name:this.type,config:{broker:this.broker,topic_prefix:this.topic_prefix},subsystem:this.getSubsystem()}];return h.forEach((a,h)=>{r[a.name]?r[a.name]={...r[a.name],...a.config}:r[a.name]=a.config}),r}getSubsystem(){return{name:this.name,type:this.type,config:{prefix:this.topic_prefix,frontendEndpoint:"/ws",brokerUrl:this.broker},actions:[],monitors:[{name:"Device status",description:"Gets the status of the mqtt connection",endpoint:"/status",connectionType:"mqtt"}]}}constructor(a,r){this.broker=a,this.topic_prefix=r,this.name=this.type="mqtt"}}function f(a,r){return new _(a,r)}class g{extractNestedComponents(a,r){let h=[{key:"mqtt",nestedKey:"on_message"},{key:"esphome",nestedKey:"on_boot"}];h.forEach(h=>{let{key:m,nestedKey:u}=h;a.config[u]&&(r[m]||(r[m]={}),r[m][u]||(r[m][u]=[]),Array.isArray(r[m][u])?r[m][u].push(...a.config[u]):r[m][u]={...r[m][u],...a.config[u]})})}exctractComponent(a,r){["mqtt","esphome"].includes(a.name)?this.extractNestedComponents(a,r):r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name].push(a.config)):r[a.name]=a.config}attach(a,r,h){var m,u,_,f;let g=[{name:"deep_sleep",config:{id:"ds",sleep_duration:this.sleep_duration+"s",wakeup_pin:this.wakeup_pin,wakeup_pin_mode:"KEEP_AWAKE"}}],y=[{name:"globals",config:{id:"dp_run_duration",type:"int",restore_value:"yes",initial_value:this.run_duration}},{name:"globals",config:{id:"dp_sleep_duration",type:"int",restore_value:"yes",initial_value:this.sleep_duration}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(m=r.mqtt)||void 0===m?void 0:m.topic_prefix)!==""?(null===(u=r.mqtt)||void 0===u?void 0:u.topic_prefix)+"/"+r.esphome.name:r.esphome.name,"/deep_sleep/dp_sleep_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value == 0) {\n  id(ds).prevent_deep_sleep();\n  ESP_LOGD("Deep Sleep", "Deep Sleep disabled");\n} else if (value > 0) {\n  id(ds).allow_deep_sleep();\n  id(dp_sleep_duration) = value;\n  id(ds).set_sleep_duration(value * 1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep sleep duration set to: %d", value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to: %d", id(dp_run_duration));\n} else {\n  ESP_LOGD("Deep Sleep", "Invalid sleep duration value");\n}'}}]}},{name:"mqtt",config:{on_message:[{topic:"".concat((null===(_=r.mqtt)||void 0===_?void 0:_.topic_prefix)!==""?(null===(f=r.mqtt)||void 0===f?void 0:f.topic_prefix)+"/"+r.esphome.name:r.esphome.name,"/deep_sleep/dp_run_duration/command"),then:{lambda:'int value = atoi(x.c_str());\nif (value > 0){\n  id(dp_run_duration) = value;\n  id(ds).set_run_duration(value*1000);\n  ESP_LOGD("Deep Sleep", "Deep Sleep run duration set to: %d",  value);\n  ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to: %d",  id(dp_run_duration));       \n} else {\n  ESP_LOGD("Deep Sleep", "Invalid run duration value");\n}'}}]}},{name:"esphome",config:{on_boot:[{priority:600,then:{lambda:'ESP_LOGD("Deep Sleep", "Global Deep Sleep run duration set to at boot: %d",  id(dp_run_duration));\nid(ds).set_run_duration(id(dp_run_duration)*1000);\nESP_LOGD("Deep Sleep", "Global Deep Sleep sleep duration set to at boot: %d",  id(dp_sleep_duration));\nid(ds).set_sleep_duration(id(dp_sleep_duration)*1000);'}}]}}];return g.forEach((a,h)=>{this.exctractComponent(a,r)}),h.filter(a=>null!==a).map(a=>a.constructor.name).includes("Mqtt")&&y.forEach((a,h)=>{this.exctractComponent(a,r)}),r}constructor(a,r,h,m){this.run_duration=a,this.sleep_duration=r,this.wakeup_pin=h,this.mqttTopicPrefix=""}}function y(a,r,h,m){return new g(a,r,h,m)}class w{attach(a,r){let h=[{name:this.type,config:{platform:this.platform,pin:a,name:this.name,id:this.name,filters:[{delayed_off:"100ms"},{delayed_on:"100ms"}]},subsystem:this.getSubsystem()}];return h.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Button status",description:"Get binary sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(a,r){this.name=a,this.platform=r,this.type="binary_sensor"}}function v(a){return new w(a,"gpio")}let S=h(49431);class E{createComponentsTree(a,r){var h,m={esphome:{name:a},[r.board.core]:r.config.sdkConfig,logger:{}};null===(h=this.components)||void 0===h||h.forEach((a,r)=>{console.log("\uD83D\uDE80 ~ file: Device.ts:62 ~ Device ~ this.components?.forEach ~ component:",a),a&&(m=a.attach(isNaN(parseInt(this.pinTable[r]))?this.pinTable[r]:parseInt(this.pinTable[r]),m,this.components))}),this.componentsTree=m}createSubsystemsTree(a,r){var h;this.subsystemsTree=[],null===(h=this.components)||void 0===h||h.forEach(a=>{if(a)try{this.subsystemsTree.push(a.getSubsystem())}catch(a){}})}getComponentsTree(a,r){let h=r.board.ports;return this.pinTable=[],h.forEach(a=>{["3V3","EN","36","39","CLK"].includes(a.name)||this.pinTable.push(a.name)}),this.createComponentsTree(a,r),this.componentsTree}getSubsystemsTree(a,r){return this.createSubsystemsTree(a,r),this.subsystemsTree}dump(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"yaml";return"yaml"==a?S.dump(this.componentsTree,{lineWidth:-1}):void 0}constructor(a){this.pinTable=[],this.components=a.slice(2),this.componentsTree={},this.subsystemsTree=[]}}function I(a){return new E(a)}class T{attach(a,r){var h=!1;this.effects.forEach(a=>{!0===a&&(h=!0)});let m=[{name:this.type,config:{platform:this.platform,pin:a,name:this.name,id:this.name,variant:this.chipset,num_leds:this.numLeds,type:this.rgb_order,method:{type:"esp32_rmt",channel:this.channel},restore_mode:this.restoreMode,default_transition_length:this.defaultTransitionLength},subsystem:this.getSubsystem()}];if(m.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),!h)return r;{let a=[];return this.effects[0]&&(a=a.concat([{pulse:null},{pulse:{name:"Fast Pulse",transition_length:"0.5s",update_interval:"0.5s"}},{pulse:{name:"Slow Pulse",update_interval:"2s"}}])),this.effects[1]&&(a=a.concat([{random:null},{random:{name:"My Slow Random Effect",transition_length:"30s",update_interval:"30s"}},{random:{name:"My Fast Random Effect",transition_length:"4s",update_interval:"5s"}}])),this.effects[2]&&(a=a.concat([{strobe:null},{strobe:{name:"Strobe Effect With Custom Values",colors:[{state:!0,brightness:"100%",red:"100%",green:"0%",blue:"0%",duration:"500ms"},{state:!1,duration:"250ms"},{state:!0,brightness:"100%",red:"0%",green:"100%",blue:"0%",duration:"500ms"}]}}])),this.effects[3]&&(a=a.concat([{flicker:null},{flicker:{name:"Flicker Effect With Custom Values",alpha:"95%",intensity:"1.5%"}}])),this.effects[4]&&(a=a.concat([{addressable_rainbow:null},{addressable_rainbow:{name:"Rainbow Effect With Custom Values",speed:10,width:50}}])),this.effects[5]&&(a=a.concat([{addressable_color_wipe:null},{addressable_color_wipe:{name:"Color Wipe Effect With Custom Values",add_led_interval:"100ms",reverse:!1,colors:[{red:"100%",green:"100%",blue:"100%",num_leds:1},{red:"0%",green:"0%",blue:"0%",num_leds:1}]}}])),this.effects[6]&&(a=a.concat([{addressable_scan:null},{addressable_scan:{name:"Scan Effect With Custom Values",move_interval:"100ms",scan_width:1}}])),this.effects[7]&&(a=a.concat([{addressable_twinkle:null},{addressable_twinkle:{name:"Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"4ms"}}])),this.effects[8]&&(a=a.concat([{addressable_random_twinkle:null},{addressable_random_twinkle:{name:"Random Twinkle Effect With Custom Values",twinkle_probability:"5%",progress_interval:"32ms"}}])),this.effects[9]&&(a=a.concat([{addressable_fireworks:null},{addressable_fireworks:{name:"Fireworks Effect With Custom Values",update_interval:"32ms",spark_probability:"10%",use_random_color:!1,fade_out_rate:120}}])),this.effects[10]&&(a=a.concat([{addressable_flicker:null},{addressable_flicker:{name:"Adressable flicker Effect With Custom Values",update_interval:"16ms",intensity:"5%"}}])),m[0].config.effects=a,r}}getSubsystem(){return{name:this.name,type:this.type,actions:[{name:"Turn on",description:"Turns on the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:0,b:0},effect:"none",brightness:255}}},{name:"Turn off",description:"Turns off the neopixels",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"OFF",color:{r:0,g:0,b:0},effect:"none",brightness:255}}},{name:"Toggle",description:"Turn on an effect on the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"json",value:{state:"ON",color:{r:255,g:255,b:255},effect:"pulse",brightness:255}}}]}}constructor(a,r,h,m,u,_,f,g,y,w,v,S,E,I,T,A,P,D,C){this.effects=[],this.name=a,this.type="light",this.platform=r,this.rgb_order=m,this.chipset=u,this.numLeds=h,this.restoreMode=_,this.defaultTransitionLength=f,this.channel=g,this.effects=[y,w,v,S,E,I,T,A,P,,D,C],this.mqttMsgs={state:"ON",color:{r:255,g:0,b:0},effect:"My Slow Random Effect",brightness:255}}}function A(a,r,h,m,u,_,f,g,y,w,v,S,E,I,A,P,D){return new T(a,"neopixelbus",r,h,m,u,_,f,g,y,w,v,S,E,I,A,P,D)}class P{attach(a){return{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(a,"\n      id: ").concat(this.name,"\n")}}constructor(a,r){this.name=a,this.platform=r}}function D(a){return new P(a,"gpio")}class C{attach(a,r){let h=[{name:this.type,config:{platform:this.platform,pin:a,name:this.name,id:this.name,restore_mode:this.restoreMode},subsystem:this.getSubsystem()}];return h.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{name:this.name,type:this.type,config:{restoreMode:"ON"},actions:[{name:"Turn on",description:"turns on the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"ON"}},{name:"Turn off",description:"turns off the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"OFF"}},{name:"Toggle",description:"Toggles the gpio",endpoint:"/"+this.type+"/"+this.name+"/command",connectionType:"mqtt",payload:{type:"str",value:"TOGGLE"}}]}}constructor(a,r,h){this.name=a,this.platform=r,this.restoreMode=h,this.type="switch"}}function O(a,r){return new C(a,"gpio",r)}class R{attach(a,r){let h=[{name:this.type,config:{platform:this.platform,pin:a,name:this.name,id:this.name,update_interval:this.updateInterval,attenuation:this.attenuation},subsystem:this.getSubsystem()}];return h.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{name:this.name,type:this.type,monitors:[{name:"Get status",description:"Get sensor status",endpoint:"/"+this.type+"/"+this.name+"/state",connectionType:"mqtt"}]}}constructor(a,r,h,m){this.name=a,this.platform=r,this.type="sensor",this.updateInterval=h,this.attenuation=m||"auto"}}function M(a,r,h){return new R(a,"adc",r,h)}class F{attach(a){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(a,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n")}}constructor(a,r){this.name=a,this.platform=r}}function N(a){return new F(a,"pulse_counter")}class L{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"on_json_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n      - lambda: |-\n          if (x.containsKey("pwmLevel"))  {\n            id(').concat(this.name,').set_level((float)x["pwmLevel"]);\n          }\n')},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(a,"\n      id: ").concat(this.name,"\n      frequency: ").concat(this.frequency,"\n")}]}constructor(a,r,h){this.name=a,this.platform=r,this.frequency=h,this.mqttTopicPrefix=""}}function q(a,r){return new L(a,"ledc",r)}class U{attach(a){return{componentName:"binary_sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(a,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      device_class: motion\n")}}constructor(a,r){this.name=a,this.platform=r}}function B(a){return new U(a,"gpio")}class G{attach(a){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      dout_pin: ").concat(a,"\n      clk_pin: ").concat(this.clkPin,"\n      gain: ").concat(this.gain,"\n      update_interval: ").concat(this.updateInterval,"\n")}}constructor(a,r,h,m,u){this.name=a,this.platform=r,this.clkPin=h,this.updateInterval=u,this.gain=m}}function H(a,r,h,m){return new G(a,"hx711",r,h,m)}class z{attach(a){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      pin: ").concat(a,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      update_interval: ").concat(this.updateInterval,"\n      attenuation: ").concat(this.attenuation,"\n")}}constructor(a,r,h){this.name=a,this.platform=r,this.updateInterval=h,this.attenuation="11db"}}function V(a,r){return new z(a,"adc",r)}class W{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"".concat(this.platform,"_i2c"),payload:"    update_interval: 1s\n    id: noconflict_".concat(this.name,"\n    i2c_id: ").concat(this.i2cBusId,"\n    on_tag:\n        then:\n            - mqtt.publish:\n                topic: ").concat(this.mqttTopicPrefix,"/").concat(this.platform,"_i2c/").concat(this.name,"/state\n                payload: !lambda 'return x;'\n    on_tag_removed:\n        then:\n            - mqtt.publish:\n                topic: ").concat(this.mqttTopicPrefix,"/").concat(this.platform,"_i2c/").concat(this.name,"/state\n                payload: !lambda 'return \"not:\"+x;'\n")},{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")}]}constructor(a,r,h,m){this.name=a,this.platform=r,this.i2cBusId=h,this.sclPin=m,this.mqttTopicPrefix=""}}function Z(a,r){return new W(a,"pn532","bus_a",r)}class K{attach(a){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      trigger_pin: ").concat(a,"\n      echo_pin: ").concat(this.echoPin,"\n      update_interval: ").concat(this.updateInterval,"\n      timeout : ").concat(this.timeout,"\n")}}constructor(a,r,h,m,u){this.name=a,this.platform=r,this.echoPin=h,this.updateInterval=m,this.timeout=u}}function $(a,r,h,m){return new K(a,"ultrasonic",r,h,m)}class X{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/output/").concat(this.name,'/command\n      then:\n        - lambda: |-\n            if (x=="ON")  {\n              id(').concat(this.name,").turn_on();\n            }else{\n              id(").concat(this.name,").turn_off();\n            }\n  ")},{componentName:"i2c",payload:"   sda: 21\n   scl: 22\n   scan: true\n   id: bus_a\n\n"},{componentName:this.platform,payload:"    - id: pca9685_hub1\n      frequency: 100\n\n"},{componentName:"output",payload:"    - platform: ".concat(this.platform,"\n      channel: 11\n      id: ").concat(this.name,"\n      pca9685_id: 'pca9685_hub1'\n\n")}]}constructor(a,r){this.name=a,this.platform=r,this.mqttTopicPrefix=""}}function Y(a){return new X(a,"pca9685")}class J{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{name:"on_json_message",config:{topic:"".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command"),then:{lambda:'if (x.containsKey("file2Play")){\n    id('.concat(this.platform,'file) = (int) x["file2Play"];\n    for(int i = 0; i<10 && !id(').concat(this.name,"busypin).state; i++){\n      id(").concat(this.name,').play_file((int) x["file2Play"]);\n    }\n}\nif(x.containsKey("volume")){\n    id(').concat(this.platform,'vol) = (int) x["volume"];\n    id(').concat(this.name,').set_volume((int) x["volume"]);\n}')}}},{name:"globals",config:{id:"".concat(this.platform,"file"),type:"int",restore_value:"no",initial_value:"0"}},{name:"globals",config:{id:"".concat(this.platform,"vol"),type:"int",restore_value:"no",initial_value:"30"}},{name:"uart",config:{id:"".concat(this.platform,"dfplayer"),tx_pin:a,rx_pin:this.rxPin,baud_rate:9600}},{name:this.platform,config:{uart_id:"".concat(this.platform,"dfplayer"),id:this.name,on_finished_playback:{then:{"logger.log":"Somebody press play!"}}},subsystem:{action:[{name:"Set Volume",description:"Sets de mp3 volume",endpoint:"/command",connectionType:"mqtt",payload:{type:"json",json:{volume:{type:"int",min:0,max:30}}}},{name:"Play file",description:"Plays the specified file",endpoint:"/command",connectionType:"mqtt",value:{type:"json",json:{file2Play:{type:"int",min:0,max:void 0}}}}]}},{name:"binary_sensor",config:{platform:"gpio",pin:this.busyPin,name:"".concat(this.name,"busypin"),id:"".concat(this.name,"busypin"),filters:[{invert:null},{delayed_off:"100ms"},{delayed_on:"100ms"}]}}]}constructor(a,r,h,m){this.name=a,this.platform=r,this.rxPin=h,this.busyPin=m,this.mqttTopicPrefix=""}}function Q(a,r,h){return new J(a,"dfplayer",r,h)}class tt{getWifiPowerMode(){return"light"}attach(a){return[{componentName:"esp32_ble_tracker",payload:"   scan_parameters:\n        interval: 320ms # try with 300ms if you don't have LAN module\n        window: 30ms # try with 300ms if you don't have LAN module\n        continuous: true\n        active: false\n"},{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      mac_address: '").concat(this.macAddress,"'\n      id: ").concat(this.id,'\n      temperature:\n          name: "').concat(this.id,'temperature"\n   \n      moisture:\n          name: "').concat(this.id,'moisture"\n\n      illuminance:\n          name: "').concat(this.id,'illuminance"\n\n      conductivity:\n          name: "').concat(this.id,'soilconductivity"\n\n      battery_level:\n          name: "').concat(this.id,'batterylevel"\n')}]}constructor(a,r,h){this.id=a,this.platform=r,this.macAddress=h}}function te(a,r){return new tt(a,"xiaomi_hhccjcy01",r)}class tn{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"remote_transmitter",payload:"   pin: ".concat(a,"\n   carrier_duty_percent: 50%\n\n")},{componentName:"climate",payload:"  - platform: ".concat(this.platform,'\n    name: "').concat(this.name,'"\n    id: ').concat(this.name,"\n    protocol: ").concat(this.protocol,"\n    horizontal_default: ").concat(this.horizontal_default,"\n    vertical_default: ").concat(this.verical_default,"\n    max_temperature: ").concat(this.max_temperature,"\n    min_temperature: ").concat(this.min_temperature,"\n\n")}]}constructor(a,r,h,m,u,_,f){this.name=a,this.platform=r,this.protocol=h,this.horizontal_default=m,this.verical_default=u,this.max_temperature=_,this.min_temperature=f,this.mqttTopicPrefix=""}}function ti(a,r,h,m,u,_){return new tn(a,"heatpumpir",r,h,m,u,_)}class ta{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"on_message",payload:"    - topic: ".concat(this.mqttTopicPrefix,"/").concat(this.platform,"/").concat(this.name,"/command\n      then:\n      - lambda: |-\n         float value = atoi(x.c_str());\n         if(value >= 0 && value <= 180) id(").concat(this.name,").write(value/180);\n         if(value > 180) id(").concat(this.name,").write(180);\n         if(value < 0) id(").concat(this.name,").write(0);\n")},{componentName:"output",payload:"  - platform: ledc\n    pin: ".concat(a,"\n    id: ").concat(this.name,"ledcOutput\n    frequency: 50 Hz\n")},{componentName:"servo",payload:"  - id: ".concat(this.name,"\n    output: ").concat(this.name,"ledcOutput\n    auto_detach_time: 0s\n    transition_length: 0s\n")}]}constructor(a,r){this.name=a,this.platform=r,this.mqttTopicPrefix=""}}function ts(a){return new ta(a,"servo")}class to{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"".concat(this.platform),payload:"    id: ".concat(this.name,"\n    address: 0x5A\n    touch_debounce: 1\n    release_debounce: 1\n    touch_threshold: 10\n    release_threshold: 7\n")},...this.channels.map((a,r)=>a?{componentName:"binary_sensor",payload:"    - platform: mpr121\n      id: ".concat(this.name+"_"+r,"\n      channel: ").concat(r,"\n      name:  ").concat(this.name+"_"+r,"\n      touch_threshold: 12\n      release_threshold: 6\n")}:null).filter(Boolean)]}constructor(a,r,h,m,u,_,f,g,y,w,v,S,E,I,T,A){this.channels=[],this.name=a,this.platform=r,this.i2cBusId=h,this.sclPin=m,this.mqttTopicPrefix="",this.channels=[u,_,f,g,y,w,v,S,E,I,T,A]}}function tr(a,r,h,m,u,_,f,g,y,w,v,S,E,I){return new to(a,"mpr121","bus_a",r,h,m,u,_,f,g,y,w,v,S,E,I)}class tc{attach(a){return{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      pin: ").concat(a,"\n      model: ").concat(this.model,"\n      update_interval: ").concat(this.updateInterval,"\n      temperature:\n        name: ").concat(this.name,"temp\n      humidity:\n        name: ").concat(this.name,"hum\n")}}constructor(a,r,h,m){this.name=a,this.platform=r,this.model=h,this.updateInterval=m}}function tl(a,r,h){return new tc(a,"dht",r,h)}class th{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}setDeepSleep(a){this.dpEnabled=a}attach(a){var r=[{name:"uart",config:{id:"".concat(this.name,"uartmodbus"),tx_pin:a,rx_pin:this.rxPin,baud_rate:19200,stop_bits:2}},{name:this.platform,config:{id:"".concat(this.name,"modbusid"),uart_id:"".concat(this.name,"uartmodbus")}},{name:"modbus_controller",config:{id:"".concat(this.name,"modbuscontrollerid"),address:1,modbus_id:"".concat(this.name,"modbusid"),setup_priority:-10,update_interval:this.updateInterval}},{name:"sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"load"),name:"".concat(this.name,"load"),unit_of_measurement:"Kg",address:parseInt(this.weightRegister),register_type:"holding",value_type:2==this.weightRegisters2Read?"U_DWORD":"U_WORD",register_count:parseInt(this.weightRegisters2Read)}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags0"),name:"".concat(this.name,"stateflags0"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:0}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags3"),name:"".concat(this.name,"stateflags3"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:3}},{name:"binary_sensor",config:{platform:"modbus_controller",modbus_controller_id:"".concat(this.name,"modbuscontrollerid"),id:"".concat(this.name,"stateflags4"),name:"".concat(this.name,"stateflags4"),address:parseInt(this.stateFlagsRegister),register_type:"holding",bitmask:16}}];let h=[{name:"switch",config:{platform:"gpio",pin:this.enablePin,id:"".concat(this.name,"enablepin"),name:"".concat(this.name,"enablepin")}},{name:"on_boot",config:{priority:100,then:[{"switch.turn_on":"".concat(this.name,"enablepin")},{wait_until:{condition:{"mqtt.connected":null}}},{"component.update":"".concat(this.name,"modbuscontrollerid")},{delay:"1s"},{"deep_sleep.enter":"ds"}]}},{name:"on_shutdown",config:{priority:700,then:[{"switch.turn_off":"".concat(this.name,"enablepin")}]}}];return this.dpEnabled&&(r=r.concat(h)),r}constructor(a,r,h,m,u,_,f,g){this.name=a,this.platform=r,this.rxPin=h,this.enablePin=m,this.updateInterval=u,this.weightRegister=_,this.weightRegisters2Read=f,this.stateFlagsRegister=g,this.mqttTopicPrefix="",this.dpEnabled=!1}}function td(a,r,h,m,u,_,f){return new th(a,"modbus",r,h,m,u,_,f)}class tm{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      name: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n")}]}constructor(a,r,h,m,u,_){this.name=a,this.platform=r,this.address=h,this.updateInterval=m,this.i2cBusId=u,this.sclPin=_,this.mqttTopicPrefix=""}}function tp(a,r,h,m){return new tm(a,"bh1750",h,m,"bus_a",r)}class tu{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-aqi"\n        calculation_type: "CAQI"\n')}]}constructor(a,r,h,m,u,_){this.name=a,this.platform=r,this.address=h,this.updateInterval=m,this.i2cBusId=u,this.sclPin=_,this.mqttTopicPrefix=""}}function t_(a,r,h,m){return new tu(a,"hm3301",h,m,"bus_a",r)}class tf{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform," \n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-ethanol\n      methane:\n        name: ").concat(this.name,"-methane\n      ammonia:\n        name: ").concat(this.name,"-ammonia\n")}]}constructor(a,r,h,m,u,_){this.name=a,this.platform=r,this.address=h,this.updateInterval=m,this.i2cBusId=u,this.sclPin=_,this.mqttTopicPrefix=""}}function tg(a,r,h,m){return new tf(a,"mics_4514",h,m,"bus_a",r)}class ty{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: mpu6050\n      id: ".concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,'\n      accel_x:\n        name: "').concat(this.name,'-accel-x"\n      accel_y:\n        name: "').concat(this.name,'-accel-y"\n      accel_z:\n        name: "').concat(this.name,'-accel-z"\n      gyro_x:\n        name: "').concat(this.name,'-gyro-x"\n      gyro_y:\n        name: "').concat(this.name,'-gyro-y"\n      gyro_z:\n        name: "').concat(this.name,'-gyro-z"\n      temperature:\n        name: "').concat(this.name,'-temperature"\n')}]}constructor(a,r,h,m,u,_){this.name=a,this.platform=r,this.address=h,this.updateInterval=m,this.i2cBusId=u,this.sclPin=_,this.mqttTopicPrefix=""}}function tb(a,r,h,m){return new ty(a,"mpu6050",h,m,"bus_a",r)}class tw{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: bh1750\n      id: ".concat(this.name,"bh1750\n      name: ").concat(this.name,"bh1750\n      address: ").concat(this.bh1750Address,"\n      update_interval: ").concat(this.updateInterval,"\n")},{componentName:"sensor",payload:"    - platform: hm3301 \n      id: ".concat(this.name,"hm3301\n      address: ").concat(this.hm3301Address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-hm3301-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-hm3301-pm2-5"\n      pm_10_0:\n        name: "').concat(this.name,'-hm3301-pm10-0"\n      aqi:\n        name: "').concat(this.name,'-hm3301-aqi"\n        calculation_type: "CAQI"\n')},{componentName:"sensor",payload:"    - platform: mics_4514 \n      id: ".concat(this.name,"sen0377\n      address: ").concat(this.sen0377Address,"\n      update_interval: ").concat(this.updateInterval,"\n      nitrogen_dioxide:\n        name: ").concat(this.name,"-sen0377-nitrogen-dioxide\n      carbon_monoxide:\n        name: ").concat(this.name,"-sen0377-carbon-monoxide\n      hydrogen:\n        name: ").concat(this.name,"-sen0377-hydrogen\n      ethanol:\n        name: ").concat(this.name,"-sen0377-ethanol\n      methane:\n        name: ").concat(this.name,"-sen0377-methane\n      ammonia:\n        name: ").concat(this.name,"-sen0377-ammonia\n")},,{componentName:"sensor",payload:"    - platform: mpu6050\n      id: ".concat(this.name,"mpu6050\n      address: ").concat(this.mpu6050Address,"\n      update_interval: ").concat(this.updateInterval,'\n      accel_x:\n        name: "').concat(this.name,'-mpu6050-accel-x"\n      accel_y:\n        name: "').concat(this.name,'-mpu6050-accel-y"\n      accel_z:\n        name: "').concat(this.name,'-mpu6050-accel-z"\n      gyro_x:\n        name: "').concat(this.name,'-mpu6050-gyro-x"\n      gyro_y:\n        name: "').concat(this.name,'-mpu6050-gyro-y"\n      gyro_z:\n        name: "').concat(this.name,'-mpu6050-gyro-z"\n      temperature:\n        name: "').concat(this.name,'-mpu6050-temperature"\n')}]}constructor(a,r,h,m,u,_,f,g){this.name=a,this.sclPin=r,this.updateInterval=h,this.i2cBusId=m,this.mqttTopicPrefix="",this.bh1750Address=u,this.hm3301Address=_,this.sen0377Address=f,this.mpu6050Address=g}}function tv(a,r,h,m,u,_,f){return new tw(a,r,h,"bus_a",m,u,_,f)}class tS{getPlatform(){return this.platform}setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"i2c",payload:"    sda: ".concat(a,"\n    scl: ").concat(this.sclPin,"\n    #scan: true\n    id: ").concat(this.i2cBusId,"\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform,"\n      id: ").concat(this.name,"\n      address: ").concat(this.address,"\n      update_interval: ").concat(this.updateInterval,'\n      pm_1_0:\n        name: "').concat(this.name,'-pm1-0"\n      pm_2_5:\n        name: "').concat(this.name,'-pm2-5"\n      pm_4_0:\n        name: "').concat(this.name,'-pm4-0"\n      pm_10_0:\n        name: "').concat(this.name,'-pm10-0"\n      temperature:\n        name: "').concat(this.name,'-temperature"\n      humidity:\n        name: "').concat(this.name,'-humidity"\n      nox:\n        name: "').concat(this.name,'-nox"\n      voc:\n        name: "').concat(this.name,'-voc"\n')}]}constructor(a,r,h,m,u,_){this.name=a,this.platform=r,this.address=h,this.updateInterval=m,this.i2cBusId=u,this.sclPin=_,this.mqttTopicPrefix=""}}function tx(a,r,h,m){return new tS(a,"sen5x",h,m,"bus_a",r)}class tE{setMqttTopicPrefix(a){this.mqttTopicPrefix=a}attach(a){return[{componentName:"uart",payload:"  tx_pin: ".concat(a,"\n  rx_pin: ").concat(this.rxPin,"\n  baud_rate: 9600\n")},{componentName:"sensor",payload:"    - platform: ".concat(this.platform,'\n      co2:\n        name: "').concat(this.name,'-co2"\n      temperature:\n        name: "').concat(this.name,'-temperature"\n      update_interval: ').concat(this.updateInterval,"\n")}]}constructor(a,r,h,m){this.name=a,this.platform=r,this.rxPin=h,this.updateInterval=m,this.mqttTopicPrefix=""}}function tI(a,r,h){return new tE(a,"mhz19",r,h)}class tT{attach(a,r){let h=[{name:this.type,config:{id:this.id,sda:a,scl:this.scl,scan:this.scan},subsystem:this.getSubsystem()}];return h.forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{}}constructor(a,r,h){this.type="i2c",this.scl=r,this.scan=h,this.id=a}}function tA(a,r,h){return new tT(a,r,h)}class tP{getOutputComponents(){let a=[];for(var r=0;r<16;r++){let h={name:"output",config:{platform:"pca9685",pca9685_id:this.name,channel:r,id:this.name+"_channel_"+r},subsystem:{}};a.push(h)}return a}attach(a,r){let h=[{name:this.type,config:{id:this.name,...this.external_clock_input?{}:{frequency:this.frequency},external_clock_input:this.external_clock_input,address:this.address,i2c_id:this.i2cBusId},subsystem:this.getSubsystem()}],m=this.getOutputComponents();return(h=h.concat(m)).forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{}}constructor(a,r,h,m,u){this.type="pca9685",this.name=a,this.frequency=r,this.external_clock_input=h,this.address=m,this.i2cBusId=u}}function tD(a,r,h,m,u){return new tP(a,r,h,m,u)}class tC{attach(a,r){return[{name:"ethernet",config:{type:this.type,mdc_pin:this.mdc_pin,mdio_pin:this.mdio_pin,clk_mode:this.clk_mode,phy_addr:this.phy_addr,power_pin:this.power_pin},subsystem:this.getSubsystem()}].forEach((a,h)=>{r[a.name]?(Array.isArray(r[a.name])||(r[a.name]=[r[a.name]]),r[a.name]=[...r[a.name],a.config]):r[a.name]=a.config}),r}getSubsystem(){return{}}constructor(a,r,h,m,u,_){this.type=a,this.mdc_pin=r,this.mdio_pin=h,this.clk_mode=m,this.phy_addr=u,this.power_pin=_}}var tO={wifi:u,mqtt:f,deepSleep:y,device:I,output:D,binarySensor:v,neopixelsBus:A,relay:O,adcSensor:M,capacitiveSoilMoistureSensor:V,pulseCounter:N,ledcOutput:q,pirSensor:B,hx711:H,nfcReader:Z,ultrasonicDistanceSensor:$,isOutput:Y,dfplayer:Q,xiaomiMiFlora:te,climateIR:ti,servo:ts,mpr121:tr,tempHumidity:tl,modbusLoadCell:td,bh1750:tp,hm3301:t_,sen0377:tg,mpu6050:tb,i2cSensorMatrix:tv,sen55:tx,mhz19:tI,i2cBus:tA,pca9685:tD,ethernet:function(a,r,h,m,u,_){return new tC(a,r,h,m,u,_)}}},36076:function(a,r,h){"use strict";h.d(r,{I:function(){return m}});let m={name:"ESPHome",version:"2022.12.8",home_assistant_domain:"esphome",funding_url:"https://esphome.io/guides/supporters.html",builds:[{chipFamily:"ESP32",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32/esphome-web-esp32.bin",offset:0}]},{chipFamily:"ESP32-C3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32c3/esphome-web-esp32c3.bin",offset:0}]},{chipFamily:"ESP32-S2",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s2/esphome-web-esp32s2.bin",offset:0}]},{chipFamily:"ESP32-S3",parts:[{path:"https://firmware.esphome.io/esphome-web-esp32s3/esphome-web-esp32s3.bin",offset:0}]},{chipFamily:"ESP8266",parts:[{path:"https://firmware.esphome.io/esphome-web-esp8266/esphome-web-esp8266.bin",offset:0}]}]}},21621:function(a,r,h){"use strict";var m=h(52322),u=h(39684),_=h(2784),f=h(66306),g=h(8939),y=h(52026),w=h(16247),v=h(79562),S=h(65919),E=h(91838);let I=(a,r)=>{var h,I;let{client:T}=(0,u.Td)(),A=a=>{"mqtt"==a.connectionType&&(T.publish(r+a.endpoint,a.payload.value.toString()),console.log("\uD83D\uDE80 ~ file: subsystem.tsx:12 ~ buttonAction ~ deviceName+action.endpoint, action.payload.value:",r+a.endpoint,a.payload.value))},P=null===(h=a.actions)||void 0===h?void 0:h.map(a=>(0,m.jsx)(f.zx,{onPress:()=>{A(a)},color:"$color10",children:a.name},a.name)),D=null===(I=a.monitors)||void 0===I?void 0:I.map(a=>{let[h,f]=(0,_.useState)(""),{message:w}=(0,u.mU)(r+a.endpoint);return console.log("\uD83D\uDE80 ~ file: subsystem.tsx:32 ~ monitorLabels ~ deviceName+monitor.endpoint:",r+a.endpoint),_.useEffect(()=>{var a;f(null==w?void 0:null===(a=w.message)||void 0===a?void 0:a.toString())},[w]),(0,m.jsx)(g.sL,{children:(0,m.jsx)(y.Text,{marginLeft:4,textAlign:"left",children:(0,m.jsx)(v.A,{text:h})})})});return(0,m.jsx)(S._k,{position:"relative",borderRadius:"10px",mt:"10px",children:(0,m.jsxs)(E.I,{children:[(0,m.jsx)(w.Paragraph,{textAlign:"left",color:"$color10",children:a.name}),(0,m.jsxs)(g.FA,{mb:"10px",mt:"10px",alignSelf:"flex-start",children:[(0,m.jsx)(g.sL,{gap:"$2",children:P}),(0,m.jsx)(g.FA,{alignItems:"center",children:(0,m.jsx)(y.Text,{children:D})})]})]})})};r.Z=I},5436:function(a,r,h){"use strict";h.d(r,{_:function(){return m}});let m=a=>new Promise(r=>setTimeout(r,a))},8638:function(){},76649:function(){}}]);